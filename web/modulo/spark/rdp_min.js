var svManager={getInstance:function(){var w=window.$rdp;if(w&&w.running&&w.running())return w;return null}};svGlobal.getInstance=svManager.getInstance;
function connvertServer(w){var ka=new Object;ka.id=w.id;ka.server=w.id;ka.displayName=w.displayName||w.id;var fa=w.rdp;if(fa){for(var Ya in fa)ka[Ya]=fa[Ya];ka.user=fa.username||"";ka.pwd=fa.password||"";ka.useConsole=fa.console||false;ka.legacyMode=fa.leagacyMode||fa.legacyMode||false;ka.server_bpp=fa.color||16;ka.exe=fa.remoteProgram||"";ka.args=fa.remoteArgs||"";if(ka.exe.length>0)ka.startProgram="app";else if(ka.command&&ka.command.length>0)ka.startProgram="shell";else ka.startProgram="noapp"}return ka}
function Rdp2(w){if(!w){var ka=window.opener;try{if(ka&&ka.__sparkUser&&ka.__sparkUser.server)w=ka.__sparkUser.server;if(!w&&ka.sparkServer)w=ka.sparkServer}catch(sb){}if(!w)w=hi5.browser.cookie2Obj();if(!w||!w.gateway){hi5.notifications.notify({"msg":__svi18n.noauth});return null}}var fa="";var Ya=w.gateway||"";var tb=0;var pa=0;var fb=16;var za=null;if(w.width)tb=parseInt(w.width,10);if(w.height)pa=parseInt(w.height,10);if(w.color)fb=parseInt(w.color,10);if(w.server_bpp)fb=parseInt(w.server_bpp,
10);for(var Ga in w){svGlobal.logger.debug("** p:"+Ga+" v="+w[Ga]);var sa=w[Ga];if("useSSL"==Ga){za=sa=="true"||sa==true;continue}if(typeof sa=="boolean")if(sa)sa="on";else continue;if(""!=fa)fa+="&";fa+=Ga+"="+encodeURIComponent(sa)}if(za===null)za="https:"==location.protocol;Ga=za?"wss://":"ws://";fa=Ga+Ya+"/RDP?"+fa;return new Rdp(fa,tb,pa,fb)}if(!svGlobal.Rdp2)svGlobal.Rdp2=Rdp2;
function Rdp(w,ka,fa,Ya){function tb(){var a=0;var f=0;var e=0;var d=0;var g=0;var c=0;this.on=false;this.verify=function(c){if(c.x==a&&c.y==f&&(c.width==0||c.width==e)&&c.height==d)if(this.on)c.width=0;else{g++;if(g>3)this.on=true}else{g=0;this.on=false;a=c.x;f=c.y;e=c.width;d=c.height}}}function pa(a){return a=="on"||a=="true"}function fb(a){return a=="off"||a=="false"}function za(){var a=n.gateway;if(n.ongetgatewayaddress)a=n.ongetgatewayaddress(a);return a}function Ga(){var a=hi5.storage.get("SV_CONN_SHARE_ID");
if(!a){a=hi5.tool.uuid();hi5.storage.set("SV_CONN_SHARE_ID",a)}return a}function sa(){return u.displayName||u.server||u.symlink||u.id||"undefined"}function sb(a,f){if(n.setTitle){f=f||window;if(n.ontitlechange)a=n.ontitlechange(a);f.document.title=a}}function Qb(){function a(a,e,d,g,h,Ma,y,H){var F=0;var K="Int32Array"in window?new Int32Array(160):Array(160);if(!K.buffer)Ha(K,0,160,0);var x="Int32Array"in window?new Int32Array(40):Array(40);if(!x.buffer)Ha(x,0,40,0);var n=120;for(var Da=0;Da<=3;Da++,
F+=13){f(h[Da],d[Da],F,Ma,x);c(e[Da],g[Da],x,n);Na(C,n,K,Da*40,39)}var P=new Int32Array(8);var ca=D[ba];var z=D[ba^=1];b(a,ca);l(z,ca,P);q(P);p(P,13,K,y,0,H);r(z,ca,P);q(P);p(P,14,K,y,13,H);m(z,ca,P);q(P);p(P,13,K,y,27,H);k(ca,P);q(P);p(P,120,K,y,40,H);var E=0;var u=H;for(var A=H+160;A-- >H;u++){E=t(v,28180);v=y[u]+E;if(v<-32768)v=-32768;else if(v>32767)v=32767;E=v<<1;if(E<-32768)E=-32768;else if(E>32767)E=32767;y[u]=E}}function f(a,f,c,b,h){var Ma=new Int32Array(13);if(!Ma.buffer)Ha(Ma,0,13,0);var p;
p=e(a);d(b,Ma,c,p[0],p[1]);g(f,Ma,h)}function e(a){var f=0;var e=0;if(a>15)f=(a>>3)-1;e=a-(f<<3);if(e==0){f=-4;e=7}else{for(;e<=7;){e=e<<1|1;f--}e-=8}var d=new Array(2);d[0]=f;d[1]=e;return d}function d(a,f,e,d,g){var c;var b;var h;var p;b=x[g];h=y(6,d);p=n(1,y(h,1));var l=0;for(var m=0;m<13;m++){c=(a[e++]<<1)-7;c<<=12;c=t(b,c);c=c+p;if(c<-32768)c=-32768;else if(c>32767)c=32767;f[l++]=E(c,h)}}function g(a,f,e){var d=13;var g=0;var c=0;switch(a){case 3:e[c++]=0;case 2:e[c++]=0;case 1:e[c++]=0;case 0:e[c++]=
f[g++];d--}do{e[c++]=0;e[c++]=0;e[c++]=f[g++]}while(--d>0);for(;++a<4;)e[c++]=0}function c(a,f,e,d){var g;var c;var b;b=a<40||a>120?Da:a;Da=b;g=z[f];for(var h=0;h<=39;h++){c=t(g,C[h-b+d]);c=c+e[h];if(c<-32768)c=-32768;else if(c>32767)c=32767;C[h+d]=c}Na(C,d-80,C,d-120,120)}function b(a,f){var e=0;var d=0;h(a,f,d++,e,0,-32,13107);h(a,f,d++,e,0,-32,13107);h(a,f,d++,e,2048,-16,13107);h(a,f,d++,e,-2560,-16,13107);h(a,f,d++,e,94,-8,19223);h(a,f,d++,e,-1792,-8,17476);h(a,f,d++,e,-341,-4,31454);h(a,f,d++,
e,-1144,-4,29708)}function h(a,f,e,d,g,c,b){d=a[e]+c;if(d<-32768)d=-32768;else if(d>32767)d=32767;d<<=10;d=y(d,g<<1);d=t(b,d);d=d+d;if(d<-32768)d=-32768;else if(d>32767)d=32767;f[e]=d}function l(a,f,d){var e=0;for(var g=0;g<8;g++){e=(a[g]>>2)+(f[g]>>2);if(e<-32768)e=-32768;else if(e>32767)e=32767;e=e+(a[g]>>1);if(e<-32768)e=-32768;else if(e>32767)e=32767;d[g]=e}}function r(a,f,e){var d=0;for(var g=0;g<8;g++){d=(a[g]>>1)+(f[g]>>1);if(d<-32768)d=-32768;else if(d>32767)d=32767;e[g]=d}}function m(a,f,
e){var d=0;for(var g=0;g<8;g++){d=(a[g]>>2)+(f[g]>>2);if(d<-32768)d=-32768;else if(d>32767)d=32767;d=d+(f[g]>>1);if(d<-32768)d=-32768;else if(d>32767)d=32767;e[g]=d}}function k(a,f){for(var d=0;d<8;d++)f[d]=a[d]}function q(a){var f=0;for(var d=0;d<8;d++)if(a[d]<0){f=a[d]==-32768?32767:-a[d];a[d]=-(f<11059?f<<1:f<20070?f+11059:K(f>>2,26112))}else{f=a[d];a[d]=f<11059?f<<1:f<20070?f+11059:K(f>>2,26112)}}function p(a,f,d,e,g,c){var b=0;var h=0;for(var p=0;f!=0;){f--;b=d[g];for(var l=7;l>=0;l--){h=a[l];
p=F[l];p=((h==-32768&&p==-32768?32767:65535&h*p+16384>>15)&65535)<<16>>16;b=y(b,p);h=((h==-32768&&b==-32768?32767:65535&h*b+16384>>15)&65535)<<16>>16;h=F[l]+h;if(h<-32768)h=-32768;else if(h>32767)h=32767;F[l+1]=h}e[c+g++]=F[0]=b}}function t(a,f){if(a==-32768&&f==-32768)return 32767;else{var d=a*f+16384;d=(d>>15&65535)<<16>>16;return d}}function K(a,f){var d=a+f;return d<-32768?-32768:d>32767?32767:d}function y(a,f){var d=a-f;return d<-32768?-32768:d>32767?32767:d}function n(a,f){if(f>=16)return 0;
if(f<=-16)if(a<0)return-1;else return-0;if(f<0)return E(a,-f);return a<<f}function E(a,f){if(f>=16)if(a<0)return-1;else return 0;if(f<=-16)return 0;if(f<0)return a<<-f;return a>>f}var x=[18431,20479,22527,24575,26623,28671,30719,32767];var z=[3277,11469,21299,32767];var C=new Int32Array(280);var D=[new Int32Array(8),new Int32Array(8)];var ba=0;var Da=40;var F=new Int32Array(9);var v=0;var H=new Int32Array(320);H[0]=0;var ca=[.1];this.decode=function(f,d,e){var g=0;var c=0;var b=0;var h=new Int32Array(8);
var p=new Int32Array(4);var l=new Int32Array(4);var m=new Int32Array(4);var r=new Int32Array(4);var k=new Int32Array(52);if(I)I.begin("audioDec");for(;d<e;){b=0;b=f[d++]&255;h[0]=b&63;b=b>>>6;b|=f[d++]<<2&1023;h[1]=b&63;b=b>>>6;b|=f[d++]<<4&4095;h[2]=b&31;b=b>>>5;h[3]=b&31;b=b>>>5;b|=f[d++]<<2&1023;h[4]=b&15;b=b>>>4;h[5]=b&15;b=b>>>4;b|=f[d++]<<2&1023;h[6]=b&7;b=b>>>3;h[7]=b&7;b=b>>>3;b|=f[d++]<<4&4095;p[0]=b&127;b=b>>>7;m[0]=b&3;b=b>>>2;l[0]=b&3;b=b>>>2;b|=f[d++]<<1&511;r[0]=b&63;b=b>>>6;k[0]=b&
7;b=b>>>3;b=f[d++]&255;k[1]=b&7;b=b>>>3;k[2]=b&7;b=b>>>3;b|=f[d++]<<2&1023;k[3]=b&7;b=b>>>3;k[4]=b&7;b=b>>>3;k[5]=b&7;b=b>>>3;b|=f[d++]<<1&511;k[6]=b&7;b=b>>>3;k[7]=b&7;b=b>>>3;k[8]=b&7;b=b>>>3;b=f[d++]&255;k[9]=b&7;b=b>>>3;k[10]=b&7;b=b>>>3;b|=f[d++]<<2&1023;k[11]=b&7;b=b>>>3;k[12]=b&7;b=b>>>3;b|=f[d++]<<4&4095;p[1]=b&127;b=b>>>7;m[1]=b&3;b=b>>>2;l[1]=b&3;b=b>>>2;b|=f[d++]<<1&511;r[1]=b&63;b=b>>>6;k[13]=b&7;b=b>>>3;b=f[d++]&255;k[14]=b&7;b=b>>>3;k[15]=b&7;b=b>>>3;b|=f[d++]<<2&1023;k[16]=b&7;b=b>>>
3;k[17]=b&7;b=b>>>3;k[18]=b&7;b=b>>>3;b|=f[d++]<<1&511;k[19]=b&7;b=b>>>3;k[20]=b&7;b=b>>>3;k[21]=b&7;b=b>>>3;b=f[d++]&255;k[22]=b&7;b=b>>>3;k[23]=b&7;b=b>>>3;b|=f[d++]<<2&1023;k[24]=b&7;b=b>>>3;k[25]=b&7;b=b>>>3;b|=f[d++]<<4&4095;p[2]=b&127;b=b>>>7;m[2]=b&3;b=b>>>2;l[2]=b&3;b=b>>>2;b|=f[d++]<<1&511;r[2]=b&63;b=b>>>6;k[26]=b&7;b=b>>>3;b=f[d++]&255;k[27]=b&7;b=b>>>3;k[28]=b&7;b=b>>>3;b|=f[d++]<<2&1023;k[29]=b&7;b=b>>>3;k[30]=b&7;b=b>>>3;k[31]=b&7;b=b>>>3;b|=f[d++]<<1&511;k[32]=b&7;b=b>>>3;k[33]=b&7;
b=b>>>3;k[34]=b&7;b=b>>>3;b=f[d++]&255;k[35]=b&7;b=b>>>3;k[36]=b&7;b=b>>>3;b|=f[d++]<<2&1023;k[37]=b&7;b=b>>>3;k[38]=b&7;b=b>>>3;b|=f[d++]<<4&4095;p[3]=b&127;b=b>>>7;m[3]=b&3;b=b>>>2;l[3]=b&3;b=b>>>2;b|=f[d++]<<1&511;r[3]=b&63;b=b>>>6;k[39]=b&7;b=b>>>3;b=f[d++]&255;k[40]=b&7;b=b>>>3;k[41]=b&7;b=b>>>3;b|=f[d++]<<2&1023;k[42]=b&7;b=b>>>3;k[43]=b&7;b=b>>>3;k[44]=b&7;b=b>>>3;b|=f[d++]<<1&511;k[45]=b&7;b=b>>>3;k[46]=b&7;b=b>>>3;k[47]=b&7;b=b>>>3;b=f[d++]&255;k[48]=b&7;b=b>>>3;k[49]=b&7;b=b>>>3;b|=f[d++]<<
2&1023;k[50]=b&7;b=b>>>3;k[51]=b&7;b=b>>>3;a(h,p,l,m,r,k,H,0);b=b&15;b|=f[d++]<<4&4095;h[0]=b&63;b=b>>>6;h[1]=b&63;b=b>>>6;b=f[d++]&255;h[2]=b&31;b=b>>>5;b|=f[d++]<<3&2047;h[3]=b&31;b=b>>>5;h[4]=b&15;b=b>>>4;b|=f[d++]<<2&1023;h[5]=b&15;b=b>>>4;h[6]=b&7;b=b>>>3;h[7]=b&7;b=b>>>3;b=f[d++]&255;p[0]=b&127;b=b>>>7;b|=f[d++]<<1&511;m[0]=b&3;b=b>>>2;l[0]=b&3;b=b>>>2;b|=f[d++]<<5&8191;r[0]=b&63;b=b>>>6;k[0]=b&7;b=b>>>3;k[1]=b&7;b=b>>>3;b|=f[d++]<<1&511;k[2]=b&7;b=b>>>3;k[3]=b&7;b=b>>>3;k[4]=b&7;b=b>>>3;b=
f[d++]&255;k[5]=b&7;b=b>>>3;k[6]=b&7;b=b>>>3;b|=f[d++]<<2&1023;k[7]=b&7;b=b>>>3;k[8]=b&7;b=b>>>3;k[9]=b&7;b=b>>>3;b|=f[d++]<<1&511;k[10]=b&7;b=b>>>3;k[11]=b&7;b=b>>>3;k[12]=b&7;b=b>>>3;b=f[d++]&255;p[1]=b&127;b=b>>>7;b|=f[d++]<<1&511;m[1]=b&3;b=b>>>2;l[1]=b&3;b=b>>>2;b|=f[d++]<<5&8191;r[1]=b&63;b=b>>>6;k[13]=b&7;b=b>>>3;k[14]=b&7;b=b>>>3;b|=f[d++]<<1&511;k[15]=b&7;b=b>>>3;k[16]=b&7;b=b>>>3;k[17]=b&7;b=b>>>3;b=f[d++]&255;k[18]=b&7;b=b>>>3;k[19]=b&7;b=b>>>3;b|=f[d++]<<2&1023;k[20]=b&7;b=b>>>3;k[21]=
b&7;b=b>>>3;k[22]=b&7;b=b>>>3;b|=f[d++]<<1&511;k[23]=b&7;b=b>>>3;k[24]=b&7;b=b>>>3;k[25]=b&7;b=b>>>3;b=f[d++]&255;p[2]=b&127;b=b>>>7;b|=f[d++]<<1&511;m[2]=b&3;b=b>>>2;l[2]=b&3;b=b>>>2;b|=f[d++]<<5&8191;r[2]=b&63;b=b>>>6;k[26]=b&7;b=b>>>3;k[27]=b&7;b=b>>>3;b|=f[d++]<<1&511;k[28]=b&7;b=b>>>3;k[29]=b&7;b=b>>>3;k[30]=b&7;b=b>>>3;b=f[d++]&255;k[31]=b&7;b=b>>>3;k[32]=b&7;b=b>>>3;b|=f[d++]<<2&1023;k[33]=b&7;b=b>>>3;k[34]=b&7;b=b>>>3;k[35]=b&7;b=b>>>3;b|=f[d++]<<1&511;k[36]=b&7;b=b>>>3;k[37]=b&7;b=b>>>3;
k[38]=b&7;b=b>>>3;b=f[d++]&255;p[3]=b&127;b=b>>>7;b|=f[d++]<<1&511;m[3]=b&3;b=b>>>2;l[3]=b&3;b=b>>>2;b|=f[d++]<<5&8191;r[3]=b&63;b=b>>>6;k[39]=b&7;b=b>>>3;k[40]=b&7;b=b>>>3;b|=f[d++]<<1&511;k[41]=b&7;b=b>>>3;k[42]=b&7;b=b>>>3;k[43]=b&7;b=b>>>3;b=f[d++]&255;k[44]=b&7;b=b>>>3;k[45]=b&7;b=b>>>3;b|=f[d++]<<2&1023;k[46]=b&7;b=b>>>3;k[47]=b&7;b=b>>>3;k[48]=b&7;b=b>>>3;b|=f[d++]<<1&511;k[49]=b&7;b=b>>>3;k[50]=b&7;b=b>>>3;k[51]=b&7;b=b>>>3;a(h,p,l,m,r,k,H,160);c=g++*320;for(var q=0;q<320;q++)ca[c++]=H[q]/
32768}ca.length=g*320;if(I)I.end("audioDec");return ca}}function Rb(a,f){function e(a,b,f,d,e,g){var c=a+e;var h=b+g;var p=0;var k=0;if(l[0].set)for(;k<d;k++)l[h+k].set(l[b+k].subarray(a,a+f),c);else for(;k<d;k++){var m=l[h+k];var r=l[b+k];for(p=0;p<f;p++)m[c+p]=r[a+p]}}function d(a,b,f,d,e,g){var c=a+e;var h=b+g;var p=0;var k=0;if(l[0].set)for(k=d-1;k>=0;k--)l[h+k].set(l[b+k].subarray(a,a+f),c);else for(k=d-1;k>=0;k--){var m=l[h+k];var r=l[b+k];for(p=0;p<f;p++)m[c+p]=r[a+p]}}function g(a,b,f,d,e,
g){var c=a+e;var h=b+g;var p=0;var k=0;var m=0;var r=0;for(p=f-1;p>=0;p--){m=c+p;r=a+p;for(k=0;k<d;k++)l[h+k][m]=l[b+k][r]}}function c(a,b,f,d,e,g){var c=a+e;var h=b+g;var p=0;var k=0;var m=0;for(var r=0;p<f;p++){m=c+p;r=a+p;for(k=0;k<d;k++)l[h+k][m]=l[b+k][r]}}function b(a,b,f,d,e){if(e.width>0)e.union(a,b,f,d);else{e.x=a;e.y=b;e.width=f;e.height=d}}function h(a,b,f,d){var e;for(x=0;x<z;x++){e=n[x];if(a>=e[0]&&b>=e[1]&&f<=e[2]&&d<=e[3])return E[x]}return null}var l=[];var r=null;var m=new gb(0,0,
0,0);var k="Uint8ClampedArray"in window;var q=0;var p=0;var t=0;var K=0;var y=null;var n;var E;var x=0;var z=0;this.width=a;this.height=f;var C=false;var D=this;var ba={imgData:null,left:0,top:0,width:0,height:0};this.getDirtyArea=function(){return m};this.setImgRect=function(a,b,f,d){q=a;p=b;t=f;K=d};this.parseMonitorDef=function(a){var b=a.split(",");var f=b.length;var d=[];if(f>1){var e=false;for(var g=0;g<f;g++){var c=b[g].split(":");if(c.length==4){d[g]=new Array(5);d[g][0]=parseInt(c[0]);d[g][1]=
parseInt(c[1]);d[g][2]=parseInt(c[2]);d[g][3]=parseInt(c[3]);d[g][4]=d[g][0]==0&&d[g][1]==0?1:0}else{e=true;break}}if(e){svGlobal.logger.warn("invaiid monitorDef:"+a);d.length=0}}return d};this.setMonitorLayout=function(a){var b=a.length;var f=0;n=a;for(E=new Array(b);f<b;f++)E[f]=new gb(0,0,0,0);z=b};this.setMonitorCount=function(a){z=a};this.addImg=function(a){if(t){if(y)URL.revokeObjectURL(y.src);y=a}};this.flushImgs=function(){if(y){URL.revokeObjectURL(y.src);y=null;t=0}};this.getData=function(){return l};
this.pause=function(a){C=a};this.release=function(){m=null;hi5.Arrays.release(E);D.flushImgs();D=null;r=null;l=null;ba.imgData=null;ba=null};this.isPaused=function(){return C};this.setContext=function(b){if(b==r)return;if(!r&&b&&!b.createImageData(1,1).data.buffer)k=false;r=b;if(r!=null)ba.imgData=r.createImageData(a,f)};this.getContext=function(){return r};this.resize=function(b,d){if(l.length==d&&l[0].length==b)return;for(var e=0;e<d;e++)l[e]=new Uint32Array(b);D.width=a=b;D.height=f=d;if(r!=null)ba.imgData=
r.createImageData(a,f)};D.resize(a,f);this.getBuffer=function(){return l};this.setRGB=function(a,b,f){l[b][a]=f|4278190080};this.getRGB=function(a,b){return l[b][a]};this.setRGBs=function(a,b,d,e,g,c,h){var p=c;var k=0;var m=0;var r=a+d;var q=b+e;if(q>f)q=f;if(g.subarray)for(var t=b;t<q;t++,p+=h)l[t].set(g.subarray(p,p+d),a);else{var y;for(t=b;t<q;t++,p+=h){m=p;y=l[t];for(k=a;k<r;k++)y[k]=g[m++]}}};this.moveArea=function(a,b,f,h,p,k){if(k>0)d(a,b,f,h,p,k);else if(k<0)e(a,b,f,h,p,k);else if(p>0)g(a,
b,f,h,p,k);else c(a,b,f,h,p,k)};this.getRGBs=function(a,b,f,d){var e=f*d;var g=new Uint32Array(e);var c=a+f;var h=b+d;var p=0;var k=0;for(i=b;i<h;i++){g.set(l[i].subarray(a,c),p);p+=f}return g};this.repaint=function(b,d,e,g){var c=ba.imgData.data;var h=0;var p=0;var m=0|0;var r=0;var q=0;var t=0|0;var y=0|0;if(I)I.begin("paint");if(b<0){e+=b;b=0}if(d<0){g+=d;d=0}if(b+e>a)e=a-b;if(d+g>f)g=f-d;h=b+e;p=d+g;if(k){var K=new Uint32Array(c.buffer);for(q=d;q<p;q++){K.set(l[q].subarray(b,h),m);m+=a}}else{y=
(a-e)*4|0;for(q=d;q<p;q++){for(r=b;r<h;r++){t=l[q][r];c[m++]=t&255;c[m++]=t>>8&255;c[m++]=t>>16&255;c[m++]=255}m+=y}}ba.left=b;ba.top=d;ba.width=e;ba.height=g;if(I)I.end("paint");return ba};this.postPaint=function(a,f,d,e){if(!z)b(a,f,d,e,m);else{var g=h(a,f,a+d-1,f+e-1);if(g)b(a,f,d,e,g)}};this.draw=function(a,b,f,d){if(r&&!C){if(y&&y.complete){r.drawImage(y,q,p,t,K);URL.revokeObjectURL(y.src);y=null}if(!z){if(m.width){D.repaint(m.x,m.y,m.width,m.height);m.width=0;return ba}}else{var e=h(a,b,f,d);
if(e.width){D.repaint(e.x,e.y,e.width,e.height);e.width=0;return ba}}}return null};this.fillRect=function(a,b,f,d,e){var g=a+f;var c=b+d;if(l[0].fill){var h;for(var p=b;p<c;p++)l[p].fill(e,a,g)}else for(p=b;p<c;p++)for(h=a;h<g;h++)l[p][h]=e};this.drawLine=function(a,b,f,d,e){var g=0;var c=0;if(b==d){if(a>f){c=a;a=f;f=c}var h=l[b];f++;if(h.fill)h.fill(e,a,f);else for(g=a;g<f;g++)h[g]=e}else if(a==f){if(b>d){c=b;b=d;d=c}d++;for(g=b;g<d;g++)l[g][a]=e}else{var p=Math.abs(f-a);var k=Math.abs(d-b);var m=
a;var r=b;var q=0;var t=0;var y=0;var K=0;var x=0;var n=0;var P=0;var D=0;if(f>=a){q=1;t=1}else{q=-1;t=-1}if(d>=b){y=1;K=1}else{y=-1;K=-1}if(p>=k){q=0;K=0;n=p;x=p/2|0;P=k;D=p}else{t=0;y=0;n=k;x=k/2|0;P=p;D=k}if(D<1)return;D++;for(var C=0;C<D;C++){l[r][m]=e;x+=P;if(x>=n){x-=n;m+=q;r+=y}m+=t;r+=K}}}}function Za(a){return a&~3}function Sb(){if(da&&!hi5.browser.isiOS){M=(u.waWidth||screen.width)|0;Y=(u.waHeight||screen.height)|0}else{M=Za(M);Y=Za(Y)}if(u.minWidth&&M<u.minWidth)M=u.minWidth|0;if(u.minHeight&&
Y<u.minHeight)Y=u.minHeight|0;u.waWidth=u.waWidth||M;u.waHeight=u.waHeight||Y}function hb(a,f){if(A)A.resize(a,f);else A=new Rb(a,f);return A}function Tb(a){var f=a>>8&248|a>>13&7;var e=a>>3&252|a>>9&3;var d=a<<3&248|a>>2&7;return 4278190080|d<<16|e<<8|f}function Tc(a){return 4278190080|Z.paletteRdp[2][a]<<16|Z.paletteRdp[1][a]<<8|Z.paletteRdp[0][a]}function Uc(a){return 4278190080|a}function Vc(a){return 4278190080|a}function zb(a,f,e,d,g,c){var b=0;var h=0;var l=0;var r=0;var m=0;var k=0;var q=
0;var p=0;var t=0;var K=0;var y=f;for(var n=c;h<d;){c=n+e*d*4-(h+1)*e*4;k=0;K=c;b=0;if(t==0)for(;b<e;){l=a[f++];m=l&15;r=l>>4&15;p=m<<4|r;if(p<=47&&p>=16){m=p;r=0}for(;r>0;){k=a[f++];g[c]=k;c+=4;b++;r--}for(;m>0;){g[c]=k;c+=4;b++;m--}}else for(;b<e;){l=a[f++];m=l&15;r=l>>4&15;p=m<<4|r;if(p<=47&&p>=16){m=p;r=0}for(;r>0;){q=a[f++];if((q&1)!=0){q=q>>1;q=q+1;k=-q}else{q=q>>1;k=q}q=g[t+b*4]+k;g[c]=q;c+=4;b++;r--}for(;m>0;){q=g[t+b*4]+k;g[c]=q;c+=4;b++;m--}}h++;t=K}return f-y}function Wc(a,f,e,d,g,c){var b=
0;var h=0;var l=0;var r=0;var m=0;var k=0;var q=0;var p=0;var t=f;for(var K=c;h<d;){c=K+e*d*4-(h+1)*e*4;p=c;b=0;if(q==0)for(;b<e;){l=a[f++];m=l&15;r=l>>4&15;k=m<<4|r;if(k<=47&&k>=16){m=k;r=0}for(;r>0;){f++;g[c]=255;c+=4;b++;r--}for(;m>0;){g[c]=255;c+=4;b++;m--}}else for(;b<e;){l=a[f++];m=l&15;r=l>>4&15;k=m<<4|r;if(k<=47&&k>=16){m=k;r=0}for(;r>0;){f++;g[c]=255;c+=4;b++;r--}for(;m>0;){g[c]=255;c+=4;b++;m--}}h++;q=p}return f-t}function Ab(a,f,e){if(!f)f=a.length;if(!e)e=0;var d=Math.floor(f/4);var g=
new Uint32Array(d);var c=0;for(var b=0;b<d;b++){c=(b<<2)+e;g[b]=(a[c+3]&255)<<24|a[c+2]&255|(a[c+1]&255)<<8|(a[c+0]&255)<<16}return g}function Bb(a,f,e,d,g,c){var b;var h;for(h=0;h<d;h++)for(b=0;b<e;b++)g[c+((d-h-1)*e+b)*4]=a[f+(h*e+b)]}function Xc(a,f,e,d,g){var c=d[g];var b=0;var h=g+1;var l=a*f;var r=new Uint32Array(l*4);var m=c&16;var k=c&32;if(I)I.begin("decodeInt32");if(k==0){b=Wc(d,h,a,f,r,3);h+=b}else{var q=0;for(var p=0;p<l;p++){q=p<<2;r[q+3]=255}}if(m!=0){b=zb(d,h,a,f,r,2);h+=b;b=zb(d,h,
a,f,r,1);h+=b;b=zb(d,h,a,f,r,0)}else{b=Bb(d,h,a,f,r,2);h+=l;b=Bb(d,h,a,f,r,1);h+=l;b=Bb(d,h,a,f,r,0)}if(I)I.end("decodeInt32");return Ab(r)}function Yc(a,f,e,d,g){var c=-1;var b=-1;var h=g;var l=0;var r=h+e;var m=0;var k=0;var q=0;var p=a;var t=-1;var K=0;var y=0;var n=0;var E=0;var x=0;var z=0;var C=4294967295;var D=false;var ba=false;var u=false;for(var F=new Uint32Array(a*f);h<r;){K=0;y=d[h++];m=y>>4;switch(m){case 12:case 13:case 14:m-=6;k=y&15;q=16;break;case 15:m=y&15;if(m<9){k=d[h++];k|=d[h++]<<
8}else k=m<11?8:1;q=0;break;default:m>>=1;k=y&31;q=32}if(q!=0){u=m==2||m==7;if(k==0)if(u)k=d[h++]+1;else k=d[h++]+q;else if(u)k<<=3}switch(m){case 0:if(t==m&&!(p==a&&c==-1))D=true;break;case 8:n=4278190080|d[h++]<<16|d[h++]<<8|d[h++];case 3:E=4278190080|d[h++]<<16|d[h++]<<8|d[h++];break;case 6:case 7:C=4278190080|d[h++]<<16|d[h++]<<8|d[h++];m-=5;break;case 9:z=3;m=2;K=3;break;case 10:z=5;m=2;K=5}t=m;for(x=0;k>0;){if(p>=a){p=0;f--;c=b;b=l+f*a}switch(m){case 0:if(D){if(c==-1)F[b+p]=C;else F[b+p]=F[c+
p]^C|4278190080;D=false;k--;p++}if(c==-1){for(;(k&~7)!=0&&p+8<a;)for(var v=0;v<8;v++){F[b+p]=4278190080;k--;p++}for(;k>0&&p<a;){F[b+p]=4278190080;k--;p++}}else{for(;(k&~7)!=0&&p+8<a;)for(v=0;v<8;v++){F[b+p]=F[c+p];k--;p++}for(;k>0&&p<a;){F[b+p]=F[c+p];k--;p++}}break;case 1:if(c==-1){for(;(k&~7)!=0&&p+8<a;)for(v=0;v<8;v++){F[b+p]=C;k--;p++}for(;k>0&&p<a;){F[b+p]=C;k--;p++}}else{for(;(k&~7)!=0&&p+8<a;)for(v=0;v<8;v++){F[b+p]=F[c+p]^C|4278190080;k--;p++}for(;k>0&&p<a;){F[b+p]=F[c+p]^C|4278190080;k--;
p++}}break;case 2:if(c==-1){for(;(k&~7)!=0&&p+8<a;)for(v=0;v<8;v++){x<<=1;x=x&255;if(x==0){z=K!=0?K&255:d[h++];x=1}if((z&x)!=0)F[b+p]=C;else F[b+p]=4278190080;k--;p++}for(;k>0&&p<a;){x<<=1;x=x&255;if(x==0){z=K!=0?K&255:d[h++];x=1}if((z&x)!=0)F[b+p]=C;else F[b+p]=4278190080;k--;p++}}else{for(;(k&~7)!=0&&p+8<a;)for(v=0;v<8;v++){x<<=1;x=x&255;if(x==0){z=K!=0?K&255:d[h++];x=1}if((z&x)!=0)F[b+p]=F[c+p]^C|4278190080;else F[b+p]=F[c+p];k--;p++}for(;k>0&&p<a;){x<<=1;x=x&255;if(x==0){z=K!=0?K&255:d[h++];x=
1}if((z&x)!=0)F[b+p]=F[c+p]^C|4278190080;else F[b+p]=F[c+p];k--;p++}}break;case 3:for(;(k&~7)!=0&&p+8<a;)for(v=0;v<8;v++){F[b+p]=E;k--;p++}for(;k>0&&p<a;){F[b+p]=E;k--;p++}break;case 4:for(;(k&~7)!=0&&p+8<a;)for(v=0;v<8;v++){F[b+p]=4278190080|d[h++]<<16|d[h++]<<8|d[h++];k--;p++}for(;k>0&&p<a;){F[b+p]=4278190080|d[h++]<<16|d[h++]<<8|d[h++];k--;p++}break;case 8:for(;(k&~7)!=0&&p+8<a;)for(v=0;v<8;v++){if(ba){F[b+p]=E;ba=false}else{F[b+p]=n;ba=true;k++}k--;p++}for(;k>0&&p<a;){if(ba){F[b+p]=E;ba=false}else{F[b+
p]=n;ba=true;k++}k--;p++}break;case 13:for(;(k&~7)!=0&&p+8<a;)for(v=0;v<8;v++){F[b+p]=4294967295;k--;p++}for(;k>0&&p<a;){F[b+p]=4294967295;k--;p++}break;case 14:for(;(k&~7)!=0&&p+8<a;)for(v=0;v<8;v++){F[b+p]=4278190080;k--;p++}for(;k>0&&p<a;){F[b+p]=4278190080;k--;p++}}}}return F}function Ub(a,f,e,d,g){var c=-1;var b=-1;var h=g;var l=0;var r=h+e;var m=0;var k=0;var q=0;var p=a;var t=-1;var K=0;var y=0;var n=0;var E=0;var x=0;var z=0;var C=4294967295;var D=0;var ba=false;var u=false;var F=false;var v=
new Uint32Array(a*f);if(I)I.begin("decodeInt16");for(;h<r;){K=0;y=d[h++];m=y>>4;switch(m){case 12:case 13:case 14:m-=6;k=y&15;q=16;break;case 15:m=y&15;if(m<9){k=d[h++];k|=d[h++]<<8}else k=m<11?8:1;q=0;break;default:m>>=1;k=y&31;q=32}if(q!=0){F=m==2||m==7;if(k==0)if(F)k=d[h++]+1;else k=d[h++]+q;else if(F)k<<=3}switch(m){case 0:if(t==m&&!(p==a&&c==-1))ba=true;break;case 8:D=d[h++]|d[h++]<<8;n=4278190080|(D>>8&248|D>>13&7)|(D>>3&252|D>>9&3)<<8|(D<<3&248|D>>2&7)<<16;case 3:D=d[h++]|d[h++]<<8;E=4278190080|
(D>>8&248|D>>13&7)|(D>>3&252|D>>9&3)<<8|(D<<3&248|D>>2&7)<<16;break;case 6:case 7:D=d[h++]|d[h++]<<8;C=4278190080|(D>>8&248|D>>13&7)|(D>>3&252|D>>9&3)<<8|(D<<3&248|D>>2&7)<<16;m-=5;break;case 9:z=3;m=2;K=3;break;case 10:z=5;m=2;K=5}t=m;for(x=0;k>0;){if(p>=a){p=0;f--;c=b;b=l+f*a}switch(m){case 0:if(ba){if(c==-1)v[b+p]=C;else v[b+p]=v[c+p]^C|4278190080;ba=false;k--;p++}if(c==-1){for(;(k&~7)!=0&&p+8<a;)for(var H=0;H<8;H++){v[b+p]=4278190080;k--;p++}for(;k>0&&p<a;){v[b+p]=4278190080;k--;p++}}else{for(;(k&
~7)!=0&&p+8<a;)for(H=0;H<8;H++){v[b+p]=v[c+p];k--;p++}for(;k>0&&p<a;){v[b+p]=v[c+p];k--;p++}}break;case 1:if(c==-1){for(;(k&~7)!=0&&p+8<a;)for(H=0;H<8;H++){v[b+p]=C;k--;p++}for(;k>0&&p<a;){v[b+p]=C;k--;p++}}else{for(;(k&~7)!=0&&p+8<a;)for(H=0;H<8;H++){v[b+p]=v[c+p]^C|4278190080;k--;p++}for(;k>0&&p<a;){v[b+p]=v[c+p]^C|4278190080;k--;p++}}break;case 2:if(c==-1){for(;(k&~7)!=0&&p+8<a;)for(H=0;H<8;H++){x<<=1;x=x&255;if(x==0){z=K!=0?K&255:d[h++];x=1}if((z&x)!=0)v[b+p]=C;else v[b+p]=4278190080;k--;p++}for(;k>
0&&p<a;){x<<=1;x=x&255;if(x==0){z=K!=0?K&255:d[h++];x=1}if((z&x)!=0)v[b+p]=C;else v[b+p]=4278190080;k--;p++}}else{for(;(k&~7)!=0&&p+8<a;)for(H=0;H<8;H++){x<<=1;x=x&255;if(x==0){z=K!=0?K&255:d[h++];x=1}if((z&x)!=0)v[b+p]=v[c+p]^C|4278190080;else v[b+p]=v[c+p];k--;p++}for(;k>0&&p<a;){x<<=1;x=x&255;if(x==0){z=K!=0?K&255:d[h++];x=1}if((z&x)!=0)v[b+p]=v[c+p]^C|4278190080;else v[b+p]=v[c+p];k--;p++}}break;case 3:for(;(k&~7)!=0&&p+8<a;)for(H=0;H<8;H++){v[b+p]=E;k--;p++}for(;k>0&&p<a;){v[b+p]=E;k--;p++}break;
case 4:for(;(k&~7)!=0&&p+8<a;)for(H=0;H<8;H++){D=d[h++]|d[h++]<<8;v[b+p]=4278190080|(D>>8&248|D>>13&7)|(D>>3&252|D>>9&3)<<8|(D<<3&248|D>>2&7)<<16;k--;p++}for(;k>0&&p<a;){D=d[h++]|d[h++]<<8;v[b+p]=4278190080|(D>>8&248|D>>13&7)|(D>>3&252|D>>9&3)<<8|(D<<3&248|D>>2&7)<<16;k--;p++}break;case 8:for(;(k&~7)!=0&&p+8<a;)for(H=0;H<8;H++){if(u){v[b+p]=E;u=false}else{v[b+p]=n;u=true;k++}k--;p++}for(;k>0&&p<a;){if(u){v[b+p]=E;u=false}else{v[b+p]=n;u=true;k++}k--;p++}break;case 13:for(;(k&~7)!=0&&p+8<a;)for(H=
0;H<8;H++){v[b+p]=4294967295;k--;p++}for(;k>0&&p<a;){v[b+p]=4294967295;k--;p++}break;case 14:for(;(k&~7)!=0&&p+8<a;)for(H=0;H<8;H++){v[b+p]=4278190080;k--;p++}for(;k>0&&p<a;){v[b+p]=4278190080;k--;p++}break;default:k--;p++}}}if(I)I.end("decodeInt16");return v}function ib(a){switch(a){case 16:ta=Tb;$a=Ub;break;case 8:ta=Tc;break;case 24:ta=Vc;$a=Yc;break;case 32:ta=Uc;$a=Xc;break;case 15:if(!u.invitation)n.showMessage("15 bit color is not supported anymore.");return false;default:return false}Ia=a;
ab=(a+7)/8>>0;return true}function jb(a,f){M=a;Y=f;V=0,X=0,T=M-1,W=Y-1;svGlobal.logger.warn("resolution changed, w:"+a+" h:"+f);if(n.onresolutionchange)n.onresolutionchange(a,f)}function J(a){Q.send(a)}function Zc(a){var f=a.substring(0,2);var e=a.substring(2);if(Ja&&(f=="80"||f=="81"||f=="82"||f=="83")){var d=e.split("\t");var g=new Uint8Array(7);var c=0;var b=0;var h=0;b=parseInt(d[0]);h=parseInt(d[1]);var l=parseInt(f,16);switch(l){case 128:c=("0"==d[2]?4096:8192)|32768;break;case 129:c="0"==d[2]?
4096:8192;break;case 130:c=2048;break;case 131:c="0"==d[2]?640|32768:896|32768}g[0]=1<<5;g[1]=c&255;g[2]=c>>8;g[3]=b&255;g[4]=b>>8;g[5]=h&255;g[6]=h>>8;Ja.add(new RecordingObj(g,0,7,60))}else;}function $c(a,f){if(f==1)return a;else if(f<1){console.error("rate must be smaller than the original rate");return}var e=Math.round(a.length/f);var d=new Float32Array(e);var g=0;for(var c=0;g<d.length;){var b=Math.round((g+1)*f);var h=0;var l=0;for(var r=c;r<b&&r<a.length;r++){h+=a[r];l++}d[g]=h/l;g++;c=b}return d}
function Ua(a,f,e,d,g,c){this.data=a;this.left=d;this.top=g;this.width=f;this.height=e;this.bitsperpixel=c;this.bytesperpixel=Math.floor((c+7)/8)}function Vb(){var a=new Array;this.putFont=function(f,e,d){if(!a[f])a[f]=new Array;a[f][e]=d};this.getFont=function(f,e){return a[f]?a[f][e]:null};this.toPDU=function(){var f;var e;var d=0;var g=4;var c=0;var b;var h;var l=4;for(d=0,len=a.length;d<len;d++){h=a[d];if(h&&h.length){size=h.length;for(c=0;c<size;c++){b=h[c];if(b)l+=15+b.fontData.length}}}if(l<
5)return null;f=new Uint8Array(l);e=new RdpBuffer(f,0,l);f[0]=29;f[2]=1;f[3]=5;e.skipPosition(4);for(d=0,len=a.length;d<len;d++){h=a[d];if(h&&h.length){size=h.length;for(c=0;c<size;c++){b=h[c];if(b){e.setByte(d);e.setLittleEndian16(c);e.setLittleEndian16(b.offset);e.setLittleEndian16(b.baseLine);e.setLittleEndian16(b.width);e.setLittleEndian16(b.height);e.setLittleEndian32(b.fontData.length);e.setBytes(b.fontData)}}}}return f};this.fromStream=function(a){for(;a.has(15);){var e=a.getByte();var d=a.getLittleEndian16();
var g=a.getLittleEndian16();var c=a.getLittleEndian16();var b=a.getLittleEndian16();var h=a.getLittleEndian16();var l=a.getLittleEndian32();var r=a.getBytes(l);this.putFont(e,d,new Wb(g,c,b,h,r))}}}function Xb(){var a=new Array;var f=new Array;this.putBitmap=function(e,d,g){if(d==32767){if(f[e]){f[e].data=null;f[e]=null}f[e]=g;return}var c=a[e];if(c){if(c[d]){c[d].data=null;c[d]=null}}else a[e]=c=new Array;c[d]=g};this.getBitmap=function(e,d){if(d==32767)return f[e];return a[e]?a[e][d]:null};this.forEach=
function(f){var d=a.length;for(var g=0;g<d;g++)f(a[g],g,a)}}function Yb(a){var f=__svi18n.errorCode[a];if(!f)f="error "+a;if(n.onerror)n.onerror({name:a,message:f});if(n.displayMsg)hi5.notifications.notify({"msg":f});if(svGlobal.log>0&&console.error)console.error(f)}function ad(a){var f=__svi18n.info[a];if(!f)return;if(n.displayMsg)hi5.notifications.notify({"msg":f});svGlobal.logger.info(f)}function bd(){this.xOrigin=0;this.yOrigin=0;this.style=0;this.pattern=new Array(8);this.toStream=function(a){a.setByte(this.xOrigin);
a.setByte(this.yOrigin);a.setByte(this.style);a.setBytes(this.pattern)};this.fromStream=function(a){this.xOrigin=a.getByte();this.yOrigin=a.getByte();this.style=a.getByte();this.pattern=a.getBytes(8)};this.byteLength=function(){return 11}}function cd(){this.left=0;this.right=0;this.top=0;this.bottom=0;this.toStream=function(a){a.setLittleEndian16(this.left);a.setLittleEndian16(this.right);a.setLittleEndian16(this.top);a.setLittleEndian16(this.bottom)};this.fromStream=function(a){this.left=a.getLittleEndian16();
this.right=a.getLittleEndian16();this.top=a.getLittleEndian16();this.bottom=a.getLittleEndian16()};this.byteLength=function(){return 8}}function dd(){this.left=0;this.right=0;this.top=0;this.bottom=0;this.offset=0;this.action=0;this.toStream=function(a){a.setLittleEndian16(this.left);a.setLittleEndian16(this.right);a.setLittleEndian16(this.top);a.setLittleEndian16(this.bottom);a.setLittleEndian32(this.offset);a.setByte(this.action)};this.fromStream=function(a){this.left=a.getLittleEndian16();this.right=
a.getLittleEndian16();this.top=a.getLittleEndian16();this.bottom=a.getLittleEndian16();this.offset=a.getLittleEndian32();this.action=a.getByte()};this.byteLength=function(){return 13}}function ed(){this.x=0;this.y=0;this.cx=0;this.cy=0;this.opcode=0;this.toStream=function(a){a.setLittleEndian16(this.x);a.setLittleEndian16(this.y);a.setLittleEndian16(this.cx);a.setLittleEndian16(this.cy);a.setByte(this.opcode)};this.fromStream=function(a){this.x=a.getLittleEndian16();this.y=a.getLittleEndian16();this.cx=
a.getLittleEndian16();this.cy=a.getLittleEndian16();this.opcode=a.getByte()};this.byteLength=function(){return 9}}function Wb(a,f,e,d,g){this.offset=a;this.baseLine=f;this.width=e;this.height=d;this.fontData=g}function fd(){this.mixmode=0;this.startX=0;this.startY=0;this.endX=0;this.endY=0;this.backgroundColor=0;this.opcode=0;this.pen=new gd;this.toStream=function(a){a.setLittleEndian16(this.mixmode);a.setLittleEndian16(this.startX);a.setLittleEndian16(this.startY);a.setLittleEndian16(this.endX);
a.setLittleEndian16(this.endY);a.setLittleEndian32(this.backgroundColor);a.setByte(this.opcode);this.pen.toStream(a)};this.fromStream=function(a){this.mixmode=a.getLittleEndian16();this.startX=a.getLittleEndian16();this.startY=a.getLittleEndian16();this.endX=a.getLittleEndian16();this.endY=a.getLittleEndian16();this.backgroundColor=a.getLittleEndian32();this.opcode=a.getByte();this.pen.fromStream(a)};this.byteLength=function(){return 15+this.pen.byteLength()}}function hd(){this.x=0;this.y=0;this.cx=
0;this.cy=0;this.opcode=0;this.srcX=0;this.srcY=0;this.colorTable=0;this.cacheID=0;this.cacheIDX=0;this.toStream=function(a){a.setLittleEndian16(this.x);a.setLittleEndian16(this.y);a.setLittleEndian16(this.cx);a.setLittleEndian16(this.cy);a.setByte(this.opcode);a.setLittleEndian16(this.srcX);a.setLittleEndian16(this.srcY);a.setByte(this.cacheID);a.setByte(this.colorTable);a.setLittleEndian16(this.cacheIDX)};this.fromStream=function(a){this.x=a.getLittleEndian16();this.y=a.getLittleEndian16();this.cx=
a.getLittleEndian16();this.cy=a.getLittleEndian16();this.opcode=a.getByte();this.srcX=a.getLittleEndian16();this.srcY=a.getLittleEndian16();this.cacheID=a.getByte();this.colorTable=a.getByte();this.cacheIDX=a.getLittleEndian16()};this.byteLength=function(){return 17}}function yf(a,f,e,d,g){this.bits=a;this.size=f;this.red=e;this.green=d;this.blue=g}function id(){this.x=0;this.y=0;this.cx=0;this.cy=0;this.opcode=0;this.backgroundColor=0;this.foregroundColor=0;this.brush=new bd;this.toStream=function(a){a.setLittleEndian16(this.x);
a.setLittleEndian16(this.y);a.setLittleEndian16(this.cx);a.setLittleEndian16(this.cy);a.setByte(this.opcode);a.setLittleEndian32(this.backgroundColor);a.setLittleEndian32(this.foregroundColor);this.brush.toStream(a)};this.fromStream=function(a){this.x=a.getLittleEndian16();this.y=a.getLittleEndian16();this.cx=a.getLittleEndian16();this.cy=a.getLittleEndian16();this.opcode=a.getByte();this.backgroundColor=a.getLittleEndian32();this.foregroundColor=a.getLittleEndian32();this.brush.fromStream(a)};this.byteLength=
function(){return 17+this.brush.byteLength()}}function gd(){this.style=0;this.width=0;this.color=0;this.toStream=function(a){a.setByte(this.style);a.setByte(this.width);a.setLittleEndian32(this.color)};this.fromStream=function(a){this.style=a.getByte();this.width=a.getByte();this.color=a.getLittleEndian32()};this.byteLength=function(){return 6}}function jd(){this.x=0;this.y=0;this.flags=0;this.foregroundColor=0;this.lines=0;this.opcode=0;this.dataSize=0;this.data=[];this.toStream=function(a){a.setLittleEndian16(this.x);
a.setLittleEndian16(this.y);a.setByte(this.opcode);a.setLittleEndian32(this.foregroundColor);a.setByte(this.lines);a.setByte(this.dataSize);if(this.dataSize)a.setBytes(this.data)};this.fromStream=function(a){this.x=a.getLittleEndian16();this.y=a.getLittleEndian16();this.opcode=a.getByte();this.foregroundColor=a.getLittleEndian32();this.lines=a.getByte();this.dataSize=a.getByte();if(this.dataSize)this.data=a.getBytes(this.dataSize)};this.byteLength=function(){return 11+this.dataSize}}function kd(){this.x=
0;this.y=0;this.cx=0;this.cy=0;this.color=0;this.toStream=function(a){a.setLittleEndian16(this.x);a.setLittleEndian16(this.y);a.setLittleEndian16(this.cx);a.setLittleEndian16(this.cy);a.setLittleEndian32(this.color)};this.fromStream=function(a){this.x=a.getLittleEndian16();this.y=a.getLittleEndian16();this.cx=a.getLittleEndian16();this.cy=a.getLittleEndian16();this.color=a.getLittleEndian32()};this.byteLength=function(){return 12}}function ld(){this.x=0;this.y=0;this.cx=0;this.cy=0;this.opcode=0;
this.srcX=0;this.srcY=0;this.toStream=function(a){a.setLittleEndian16(this.x);a.setLittleEndian16(this.y);a.setLittleEndian16(this.cx);a.setLittleEndian16(this.cy);a.setByte(this.opcode);a.setLittleEndian16(this.srcX);a.setLittleEndian16(this.srcY)};this.fromStream=function(a){this.x=a.getLittleEndian16();this.y=a.getLittleEndian16();this.cx=a.getLittleEndian16();this.cy=a.getLittleEndian16();this.opcode=a.getByte();this.srcX=a.getLittleEndian16();this.srcY=a.getLittleEndian16()};this.byteLength=
function(){return 13}}function md(){this.flags=0;this.mixmode=0;this.foregroundColor=0;this.backgroundColor=0;this.x=0;this.y=0;this.unknown=0;this.font=0;this.clipLeft=0;this.clipTop=0;this.clipRight=0;this.clipBottom=0;this.boxLeft=0;this.boxTop=0;this.boxRight=0;this.boxBottom=0;this.opcode=0;this.length=0;this.text=null;this.toStream=function(a){a.setByte(this.font);a.setByte(this.flags);a.setByte(this.opcode);a.setByte(this.mixmode);a.setLittleEndian32(this.foregroundColor);a.setLittleEndian32(this.backgroundColor);
a.setLittleEndian16(this.clipLeft);a.setLittleEndian16(this.clipTop);a.setLittleEndian16(this.clipRight);a.setLittleEndian16(this.clipBottom);a.setLittleEndian16(this.boxLeft);a.setLittleEndian16(this.boxTop);a.setLittleEndian16(this.boxRight);a.setLittleEndian16(this.boxBottom);a.setLittleEndian16(this.x);a.setLittleEndian16(this.y);a.setByte(this.length);if(this.length)a.setBytes(this.text)};this.fromStream=function(a){this.font=a.getByte();this.flags=a.getByte();this.opcode=a.getByte();this.mixmode=
a.getByte();this.foregroundColor=a.getLittleEndian32();this.backgroundColor=a.getLittleEndian32();this.clipLeft=a.getLittleEndian16();this.clipTop=a.getLittleEndian16();this.clipRight=a.getLittleEndian16();this.clipBottom=a.getLittleEndian16();this.boxLeft=a.getLittleEndian16();this.boxTop=a.getLittleEndian16();this.boxRight=a.getLittleEndian16();this.boxBottom=a.getLittleEndian16();this.x=a.getLittleEndian16();this.y=a.getLittleEndian16();this.length=a.getByte();if(this.length)this.text=a.getBytes(this.length)};
this.byteLength=function(){return 33+this.length}}function Cb(){this.orderType=0;this.bounds=new cd;this.destBlt=new ed;this.patBlt=new id;this.screenBlt=new ld;this.line=new fd;this.rectangle=new kd;this.deskSave=new dd;this.memBlt=new hd;this.polyLine=new jd;this.text2=new md;this._line=new hi5.graphic.Line;this.paletteRdp=null;this.toPDU=function(){var a=4+this.bounds.byteLength()+this.destBlt.byteLength()+this.patBlt.byteLength()+this.screenBlt.byteLength()+this.line.byteLength()+this.rectangle.byteLength()+
this.deskSave.byteLength()+this.memBlt.byteLength()+this.polyLine.byteLength()+this.text2.byteLength()+14+10;var f=new Uint8Array(a);f[0]=29;f[2]=1;f[3]=3;var e=new RdpBuffer(f,0,a);e.skipPosition(4);this.bounds.toStream(e);this.destBlt.toStream(e);this.patBlt.toStream(e);this.screenBlt.toStream(e);this.line.toStream(e);this.rectangle.toStream(e);this.deskSave.toStream(e);this.memBlt.toStream(e);this.polyLine.toStream(e);this.text2.toStream(e);e.setLittleEndian16(V);e.setLittleEndian16(X);e.setLittleEndian16(T);
e.setLittleEndian16(W);e.setLittleEndian32(Ea);e.setByte(this.orderType);e.setByte(Ia);aa.toStream(e);return f};this.fromStream=function(a){this.bounds.fromStream(a);this.destBlt.fromStream(a);this.patBlt.fromStream(a);this.screenBlt.fromStream(a);this.line.fromStream(a);this.rectangle.fromStream(a);this.deskSave.fromStream(a);this.memBlt.fromStream(a);this.polyLine.fromStream(a);this.text2.fromStream(a);V=a.getLittleEndian16();X=a.getLittleEndian16();T=a.getLittleEndian16();W=a.getLittleEndian16();
Ea=a.getLittleEndian32();this.orderType=a.getByte();ib(a.getByte());aa.fromStream(a)}}function nd(){function a(a,f,g,c,b,h){this.x=a;this.y=f;this.cx=g;this.cy=c;this.offset=b;this.data=h}var f=[];this.save=function(e,d,g,c,b,h){var l=new a(e,d,g,c,b,h);var r=0;for(var m=f.length;r<m;r++)if(!f[r]){f[r]=l;return}f.push(l)};this.restore=function(a,d,g,c,b){var h;var l=0;for(var r=f.length;l<r;l++){h=f[l];if(h&&h.x==a&&h.y==d&&h.cx==g&&h.cy==c)if(h.offset==b){var m=h.data;f[l]=null;return m}else svGlobal.logger.warn("TODO: offset")}return null};
this.toPDU=function(){var a=0;var d=2;var g=0;var c=f.length;for(var b;g<c;g++)if(f[g]){a++;d+=f[g].data.length+6}if(!a||!d)return null;var h=new Uint32Array(d);var l=2;h[0]=151060509;h[1]=a;for(g=0;g<c;g++){b=f[g];if(b){h[l++]=b.x;h[l++]=b.y;h[l++]=b.cx;h[l++]=b.cy;h[l++]=b.offset;h[l++]=b.data.length;h.set(b.data,l);l+=b.data.length}}return h};this.fromStream=function(a){var f=new Uint32Array(a.getData().buffer,a.getPosition());var g=1;var c=f[0];var b=0;var h=0;var l=0;var r=0;var m=0;var k=0;
var q;for(var p=0;p<c;p++){b=f[g++];h=f[g++];l=f[g++];r=f[g++];m=f[g++];k=f[g++];q=new Uint32Array(k);k=g+k;q.set(f.subarray(g,k));g=k;this.save(b,h,l,r,m,q)}}}function Zb(){ga=false;Oa=false;$b();Z=new Cb;Ea=0;ra=new Array;Fa=new Xb;Va=new Vb;if(ua)ua.reset()}function od(){var a=B.getFocused();var f=a?a.getWindow():window;return"&waWidth="+u.waWidth+"&waHeight="+u.waHeight+"&dpWidth="+f.innerWidth+"&dpHeight="+f.innerHeight}function pd(a,f){function e(a){f(false,a.target.responseText)}function d(a){f(true)}
var g=f?true:false;var c=new XMLHttpRequest;if(g){c.addEventListener("load",e);c.addEventListener("error",d);c.addEventListener("abort",d)}c.open("GET",a,g);c.setRequestHeader("Content-Type","text/plain;charset=UTF-8");c.send(null);return g?"":c.responseText}function qd(a){if(!kb)return"";return pd(n.modifyURL(za()+"/CLIP?s="+kb+"&t="+Date.now()),a)}function rd(){function a(a){if(!f(a))return false;var d=a["ownerWinid"]<1&&!b.mainWin;if(!d)return d;var e=a["style"];if((e&4194304)!=0)return true;if((e&
2147483648)!=0&&((e&8388608)==0||(e&12582912)==0))return false;var g=(a.extStyle&128)!=0;d=d&&!g;if(d&&((e&2147483648)!=0&&(e&2156396544)==0))d=false;return d}function f(a){return a.winWidth&&a.winHeight&&a.showState&&a.winHeight>45&&a.winWidth>45}function e(a){for(;a.ownerWinid>0;){var f=b.getWinById(a.ownerWinid);if(f&&f.isVisible())a=f;else break}return a}function d(a){var f="";for(var d=a;d;){if(d.titleInfo)f=d.titleInfo;d=b.getWinById(d.ownerWinid)}return f}var g=[];var c=0;var b=this;this.mainWin=
null;this.appId="";this.onchange=function(f){if(!f.isVisible()&&f==b.mainWin)b.mainWin=null;else if(f.isVisible()&&!b.mainWin)if(a(f)){b.mainWin=f;if(n.windowState)f.exeCommand(61488)}};this.addWin=function(f){var d=g.length;var e=false;for(var m=0;m<d;m++)if(f.id==g[m].id){g[m]=f;e=true;break}if(!e)g.push(f);if(g.length==1)c=Date.now();if(n.windowState>0){var k=a(f);svGlobal.logger.info("is main win:"+k+" id:"+f.id);if(k&&!b.mainWin){b.mainWin=f;if(n.windowState)b.getOtherApps(B.zOrders,function(a){if(a.length>
0&&n.onexistingapp)n.onexistingapp(a)},5E3)}}};this.isMain=a;this.popWins=function(a){var f=b.getWinById(a);var d=[];if(f){a=f.ownerWinid>0?f.ownerWinid:f.id;var e=g.length;for(var c=e-1;c>=0;c--)if(g[c].ownerWinid==a||g[c].id==a){d.push(g[c]);g.splice(c,1)}}return d};this.hasApp=function(a){if(b.appId==a)return true;var f=0;for(var d=g.length;f<d;f++)if(g[f].appId==a)return true;return false};this.isNew=function(){return Date.now()-c<3E4};this.getAll=function(){return g};this.hasWin=function(a){return g.indexOf(a)>=
0};this.close=function(){var a=0;for(var b=g.length;a<b;a++)g[a].close()};this.clear=function(){g.length=0};this.delWin=function(a){var b=0;for(var f=g.length;b<f;b++)if(g[b].id==a){g.splice(b,1);return b}return-1};this.isRunning=function(){var a;var b=g.length;if(b<1)return false;var f=0;for(b=g.length;f<b;f++){a=g[f];if(a.isVisible())return true}return false};this.getWinById=function(a){var b;var f=g.length;if(f<1)return null;for(var d=0;d<f;d++){b=g[d];if(b.id==a)return b}return null};this.getTopWin=
function(a){var f=null;var d;var e=a.length;for(d=0;d<e;d++){f=b.getWinById(a[d]);if(f&&f.isVisible())break;else f=null}if(!f){svGlobal.logger.warn("No win found");e=g.length;for(d=e-1;d>=0;d--){f=g[d];if(f.isVisible())break;else f=null}}return f};this.getMain=function(a){var f=b.getTopWin(a);if(f)return e(f);return null};this.getOtherApps=function(a,f,c){var m=g.length;if(m==0||!g[m-1])return;var k=g[m-1].appId;if(c||!k){setTimeout(function(){b.getOtherApps(a,f)},c||3E3);return}var q=[];var p=b.getTopWin(a);
if(p){var t=p.ownerWinid>0?p.ownerWinid:p.id;var K=[];var y=0;for(m=g.length;y<m;y++){if(g[y].ownerWinid==t||g[y].id==t||!g[y].isVisible())continue;K.push(g[y])}for(y=0,m=K.length;y<m;y++){if(K[y].ownerWinid==t||K[y].id==t)continue;q.push({title:d(K[y]),win:e(K[y])});t=K[y].ownerWinid>0?K[y].ownerWinid:K[y].id}}f(q)}}function ac(a,f){Oa=false;svGlobal.logger.info("reconnecting...");J("8E0"+a+"\t"+f)}function sd(a){var f={};var e=0;var d=a;this.enabled=false;hi5.EventControl(this);var g=this;var c=
null;this.release=function(){g=null;a=null;d=null;f=null};this.read=function(b,d,c){function r(f){if(f.target.readyState==FileReader.DONE){var p=new Uint8Array(f.target.result);a.send(b,d,c,p,m.preferPaste);e+=c;g.fireEvent("progress",[e])}}var m=f[f[b]];if(typeof m=="undefined")return;var k=m.size;var q=m.name;if(k<1){n.showMessage(__svi18n.file.zero+q,null,3E3);return}var p=m.slice(d,d+c);var t=new FileReader;t.onloadend=r;t.readAsArrayBuffer(p)};this.mkdirs=function(b){if(!g.enabled)return;if(b.charAt(b.length-
1)!="/")b+="/";b=encodeURIComponent(b);a.start(b,0)};this.addFiles=function(b,d){var e=b.length;if(!e||!g.enabled)return;var c=d&&!!(wa&65536);for(var m=0;m<e;m++){var k=b[m];if(d)k.preferPaste=true;var q=k.fullPath||k.name;if(n.beforeupload)if(n.beforeupload(k,q,c))return;g.fireEvent("beforeupload",[k,q,c]);q=encodeURIComponent(q);f[q]=k}a.start(b,d);g.fireEvent("uploadstarted",[c])};this.removeFile=function(a){d.remove(a)};this.confirmId=function(a,d,g){f[a]=d;if(g)e+=parseInt(g)};this.close=function(a){var d=
true;if(a){var c=f[a];if(c){d=f[c].preferPaste;delete f[a];delete f[c];var r=decodeURIComponent(c);if(n.onfileuploaded)n.onfileuploaded(r,d);g.fireEvent("fileuploaded",[r,d&&!!(wa&65536)])}for(var m in f)return}else f={};e=0;g.fireEvent("uploaded",[d&&!!(wa&65536)]);if(n.onuploaded)n.onuploaded(d&&!!(wa&65536))};this.cancelAll=function(){d.cancelAll();if(n.onuploadingCancelled)n.onuploadingCancelled();g.fireEvent("uploadingCancelled");g.close()};this.list=function(a,f){c=f;d.list(a)};this.notifyFiles=
function(a){if(c)c(a);g.fireEvent("files")};this.download=function(){d.download()}}function td(){function a(a,e){var d=e.length;var g=new Uint8Array(2+d*2);g[0]=58;g[1]=a;var c=0;var b=2;for(var h=0;h<d;h++){c=e.charCodeAt(h);g[b++]=c&255;g[b++]=c>>8&255}J(g.buffer)}this.start=function(a,e){var d=a.length;var g=d*20+2;var c=0;var b=new Uint8Array(8);var h=2;var l="";var r=0;var m=0;var k=0;for(var q=0;c<d;c++)g+=(encodeURIComponent(a[c].fullPath||a[c].name).length+1)*2;var p=new Uint8Array(g);p[0]=
58;p[1]=0;if(e)p[1]|=128;for(c=0;c<d;c++){q=a[c].size;p[h++]=q&255;p[h++]=q>>8&255;p[h++]=q>>16&255;p[h++]=q>>24&255;h+=4;hi5.NumUtils.toBytes(a[c].lastModified||a[c].lastModifiedDate.getTime(),b);p.set(b,h);h+=12;l=encodeURIComponent(a[c].fullPath||a[c].name);r=l.length;for(m=0;m<r;m++){k=l.charCodeAt(m);p[h++]=k&255;p[h++]=k>>8&255}h+=2}J(p.buffer)};this.send=function(a,e,d,g,c){var b=new Uint8Array(22+d);b[0]=58;b[1]=3;if(c)b[1]|=128;var h=2;b[h++]=a&255;b[h++]=a>>8&255;b[h++]=a>>16&255;b[h++]=
a>>24&255;b[h++]=e&255;b[h++]=e>>8&255;b[h++]=e>>16&255;b[h++]=e>>24&255;h+=4;b[h++]=d&255;b[h++]=d>>8&255;b[h++]=d>>16&255;b[h++]=d>>24&255;h+=4;b.set(g,h);J(b.buffer)};this.remove=function(f){a(6,f)};this.list=function(f){a(5,f)};this.cancelAll=function(){a(7,"")};this.download=function(){a(8|128,"")}}function bc(a){if(!qa)qa=new sd(new td);a.setFileHandler(qa)}function cc(a,f,e){var d=false;this.exe=a;this.args=f||"";this._dir=e||"";var g=this;this.close=function(){if(!d&&ga){d=true;J("8C5"+g.exe+
"\t"+g.args+"\t"+n.sessionInfo.appInfo.session)}}}function Db(a){var f=this;if(!a)a=143;this.send=function(e){var d=!!e.buffer;var g=d?e:e.getData();var c=a==64;var b=d?g.length:e.getEnd()||g.length;if(b<g.length)if(d)g=g.subarray(0,b);else g=g.slice(0,b);var h=c?5:9;var l=h+b;var r=new Uint8Array(l);r[0]=a;if(c){r[1]=f.id;r[2]=f.id>>8;r[3]=f.id>>16;r[4]=f.id>>24}else{var m=f.name;var k=Math.min(m.length,8);for(var q=0;q<k;q++)r[1+q]=m.charCodeAt(q)}r.set(g,h);J(r.buffer)};this.name="";this.flags=
0;this.id=0;this.count=0}function ud(){var a=window.opener;if(a)try{if(a.__sparkUser&&a.__sparkUser.session)return a.__sparkUser;else if(a.opener&&a.opener.__sparkUser.session)return a.opener.__sparkUser}catch(f){}return null}function dc(){var a="";if(u&&pa(u.connectif)&&u.symlink&&"sessionStorage"in window){a="SV_"+u.symlink;if(u.domain)a+=u.domain;if(u.user)a+=u.user}return a}function vd(){var a=dc();var f="";if(a){f=sessionStorage[a]||"";if(f)f="&preSymJoin="+f}return f}function wd(a,f){var e=
0;var d=B.length;var g=new Array(d);var c=new Array(d);var b=0;var h=0;var l=0;var r=0;var m=0;var k=0;var q="";var p;if(a){c=A.parseMonitorDef(a);for(d=c.length;e<d;e++){p=c[e];if(p[0]<l)l=p[0];if(p[1]<r)r=p[1];if(p[2]>m)m=p[2];if(p[3]>k)k=p[3]}if(l<0)b=-l;if(r<0)h=-r;if(f<0)p=[l,r,m,k];else p=c[f];u.width=p[2]-p[0]+1;u.height=p[3]-p[1]+1;var t=B[0];t.setMonitor(p[0],p[1],p[2],p[3]);if(b||h){p=t.getMousePosition();p.left+=b;p.right+=b;p.top+=h;p.bottom+=h;for(e=0;e<d;e++){p=c[e];p[0]+=b;p[1]+=h;
p[2]+=b;p[3]+=h}}A.setMonitorLayout(c);if(f<0)A.setMonitorCount(0);n.reconnectOnResize=false;return"&monitorDef="+a+"&width="+u.width+"&height="+u.height}if(d>1&&!da){for(var K;e<d;e++){K=B[e];p=K.getMousePosition();if(p.left<l)l=p.left;if(p.top<r)r=p.top;if(p.right>m)m=p.right;if(p.bottom>k)k=p.bottom;g[e]=p;if(q)q+=",";q+=p.left+":"+p.top+":"+p.right+":"+p.bottom}if(l<0)b=-l;if(r<0)h=-r;for(e=0;e<d;e++){p=B[e].getMousePosition();if(b||h){p.left+=b;p.right+=b;p.top+=h;p.bottom+=h}c[e]=[p.left,p.top,
p.right,p.bottom,p.left==b&&p.top==h?1:0]}A.setMonitorLayout(c);n.reconnectOnResize=false}if(q){svGlobal.logger.warn("MonitorDef:"+q);u.width=m-l+1;u.height=k-r+1;q="&monitorDef="+q+"&width="+u.width+"&height="+u.height}return q}function ec(){function a(a){Ja=new RecordingManager;var b=a.user.length>0?a.server+"_"+a.user:a.server;var f={name:b,width:M,height:Y,color:Ia,namesuffix:".rdpv",filetag:"RDPV",duration:0};Ja.setHeader(f)}if(ga)return;Oa=false;if(bb){Q=bb;ja.init(false,true,false,0)}else{var f=
w+"&width="+M+"&height="+Y+"&server_bpp="+Ia+"&audio="+ma.available+vd()+wd(u.monitorDef,u.monitor);if(w.indexOf("waWidth")<0)f+=od();var e=new Date;f+="&tzOffset="+e.getTimezoneOffset()+"&time="+e.getTime();var d="";var g="";var c="";for(c in Pa){var b=Pa[c];if("flags"in b){if(d){d+=",";g+=","}d+=b.name;g+=b.flags}}if(d){f+="&channelName="+d;f+="&channelFlags="+g}d="";for(c in Qa){b=Qa[c];if("flags"in b){if(d)d+=",";d+=b.name}}if(d)f+="&gwChannelName="+d;var h=ud();if(h){var l=h.account;var r=h.session;
if(l)f+="&account="+l;if(r)f+="&session="+r}var m=hi5.browser.isTouch&&(window.innerWidth>=1024||window.innerHeight>=768);u.audioRecord=pa(u.audioRecord)&&hi5.audio.recordable;ja.init(m,!!u.remotefx,u.audioRecord,u.soundPref);if(u.audioRecord)f+="&audioRecord=on";if(ja.count>0)f+="&dvcChannels="+ja.names.join(",");if(hi5.browser.binaryWS())f+="&binary=on";if(N.existingFile)f+="&existingFile="+N.existingFile;f+="&isTouch="+m+"&gatewayAddr="+encodeURIComponent(za());f=n.modifyURL(f);if(N.copyTextOnly&&
pa(u.mapClipboard))f+="&copyTextOnly=on";w=f;f=n.mode==0&&N.wsPost?w.substring(0,w.indexOf("?"))+"?_METHOD=post":w;if(n.oncreatewebsocket)Q=n.oncreatewebsocket(f);else Q=new WebSocket(f,"rdp");if("binaryType"in Q)Q.binaryType="arraybuffer"}svGlobal.logger.info(w);Q.onopen=function(a){ga=true;if(n.onopen)n.onopen();J("87"+navigator.userAgent);if(N.joinCloseMode)n.setJoinCloseMode(N.joinCloseMode)};if(u["recording"]!=undefined&&u["recording"]=="on")a(u);Q.onmessage=xd;Q.onclose=Ra;Q.onerror=yd;var k=
B[B.length-1];if(k)if(da){if(k)k.remoteApp=new cc(u["exe"],u["args"],"")}else sb(sa(),k.getWindow());if(u.invitation){var q=null;if(k)q=k.initChat(u.expert);lb=new n.GatewayChannel;lb.name="C_H_A_T";lb.process=function(a){var b=a.getUnicodeString(a.getEnd()-a.getPosition(),true);if(q)q.add(b,u.novice)};if(q)q.onchat=function(a){if(ga){var b=new Array(a.length*2);var f=new hi5.DataBuffer(b,0,b.length);f.setUnicodeString(a);f.markEnd();lb.send(f)}};n.addGatewayChannel(lb)}}function yd(a){svGlobal.logger.warn(a)}
function mb(a){var f=zd(a);ea.attach(f,0,f.length);return ea}function xd(a){var f;var e=a.data;if(typeof e!="string"){var d=new Uint8Array(e);if(Ja!=null)Ja.add(new RecordingObj(d,0,e.byteLength,-1));ea.attach(d,0,e.byteLength);f=ea.getLittleEndian16();switch(f){case 28:fc(ea);break;case 29:Ad(ea);break;case 48:gc(ea);if(ha)ha.check();break;case 49:hc(ea);if(ha)ha.check();break;case 55:Bd(ea);if(ha)ha.check();break;case 56:ic(ea.getUnicodeString(ea.getEnd()-ea.getPosition(),false));break;case 60:jc(ea);
break;case 62:kc(ea.getUnicodeString(ea.getEnd()-ea.getPosition(),false));break;case 63:lc(ea);if(ha)ha.check();break;case 64:Cd(ea);if(ha)ha.check();break;case 65:Dd(ea);break;case 146:Ed(ea);break;default:if(n.onunknownmessage)n.onunknownmessage(f,ea);else svGlobal.logger.warn("@TODO:"+f+"\n")}}else{f=parseInt(e.substring(0,2),16);var g=e.substring(2);switch(f){case 0:Fd();break;case 15:Gd(g);break;case 26:Hd(g);break;case 27:Id(g);break;case 28:fc(mb(g));break;case 48:gc(mb(g));break;case 49:hc(mb(g));
break;case 50:Jd(g);break;case 51:Kd(g);break;case 54:Ld(g);break;case 55:Md(g);break;case 56:ic(g);break;case 57:Nd(g);break;case 58:Od(g);break;case 59:Pd(g);break;case 60:jc(mb(g));break;case 61:Qd(g);break;case 62:kc(g);break;case 63:lc(mb(g));break;default:if(n.onunknownmessage)n.onunknownmessage(f,g);else svGlobal.logger.warn("@TODO:"+e+"\n")}}}function Dd(a){var f=a.getPosition();var e=a.getByte();var d=a.getByte();seqNoLow=a.getByte();seqNoHigh=a.getByte();reqType=a.getLittleEndian16,out=
null,payloadLen=0,payload=null,baseRTT=0,bandwidth=0,averageRTT=0;if(d!=0){svGlobal.logger.warn("invalid msg channel data");return}switch(reqType){case 1:case 4097:out=new Uint8Array(7);out[0]=65;out.set(a.getData().subarray(f,f+4),1);out[5]=0;out[6]=0;J(out.buffer);break;case 20:case 276:case 4116:break;case 2:if(e==8){payloadLen=a.getLittleEndian16();payload=a.getByte(payloadLen)}else svGlobal.logger.warn("Invalid payload");break;case 43:if(e==8){payloadLen=a.getLittleEndian16();payload=a.getByte(payloadLen)}else svGlobal.logger.warn("Invalid payload");
break;case 1065:case 1577:break;case 2112:baseRTT=a.getLittleEndian32();averageRTT=a.getLittleEndian32();break;case 2176:bandwidth=a.getLittleEndian32();averageRTT=a.getLittleEndian32();break;case 2240:baseRTT=a.getLittleEndian32();bandwidth=a.getLittleEndian32();averageRTT=a.getLittleEndian32();break;default:svGlobal.logger.warn("Invalid msg channel type:"+reqType)}}function zf(a,f){var e=a.length+8;var d=new Uint8Array(e);var g=new RdpBuffer(d,0,e);d[0]=29;d[2]=1;d[3]=f;g.skipPosition(4);g.setLittleEndian32(a.length);
g.setAscllString(a);return d}function mc(){xa=true;if(n){if(N.pingInterval)n.startPing(N.pingInterval);if(n.onready)n.onready()}}function Ad(a){var f=a.getByte();var e=0;var d=0;var g=0;var c=0;var b;var h;if(f==0){svGlobal.logger.info("Send history...");h=new Uint8Array(4);h[0]=29;h[2]=1;h[3]=1;Q.send(h.buffer);if(I)I.begin("his_mppc");h=ua.toPDU();if(h)Q.send(h.buffer);if(I)I.end("his_mppc");if(I)I.begin("his_order");Q.send(Z.toPDU().buffer);if(I)I.end("his_order");if(I)I.begin("his_bitmap");Fa.forEach(function(a,
f,p){if(!a)return;g=0,c=0;for(e=0,d=a.length;e<d;e++)if(a[e].data){g++;c+=a[e].data.length}if(!g||!c)return;h=new Uint32Array(c+g*8+2);h[0]=67174429;h[1]=g;var k=2;for(e=0;e<d;e++){b=a[e];if(b.data){h[k++]=f;h[k++]=e;h[k++]=b.left;h[k++]=b.top;h[k++]=b.width;h[k++]=b.height;h[k++]=b.bitsperpixel;h[k++]=b.data.length;h.set(b.data,k);k+=b.data.length}}Q.send(h.buffer)});if(I)I.end("his_bitmap");if(I)I.begin("his_font");h=Va.toPDU();if(h)Q.send(h.buffer);if(I)I.end("his_font");h=cb.toPDU();if(h)Q.send(h.buffer);
c=4;for(e=0,d=ra.length;e<d;e++)if(ra[e])c+=ra[e].length+6;if(c>4){h=new Uint8Array(c);h[0]=29;h[2]=1;h[3]=7;offset=4;for(e=0,d=ra.length;e<d;e++)if(ra[e]&&ra[e].length){h[offset++]=e;h[offset++]=e>>8;c=ra[e].length;h[offset++]=c;h[offset++]=c>>8;h[offset++]=c>>16;h[offset++]=c>>24;h.set(ra[e],offset);offset+=c}Q.send(h.buffer)}h=nb.toPDU();if(h)Q.send(h.buffer);h=new Uint8Array(5);h[0]=29;h[2]=1;h[3]=0;h[4]=1;Q.send(h.buffer)}else{f=a.getByte();switch(f){case 0:svGlobal.logger.info("Received history");
if(a.has(1)&&a.getByte()==1)if(n.sessionInfo.suppressOutput){n.suppressOutput(true);n.suppressOutput(false)}else n.refreshOutput(0,0,M-1,Y-1);mc();break;case 1:break;case 2:if(I)I.begin("his_mppc_dec");ua.fromStream(a);if(I)I.end("his_mppc_dec");break;case 3:if(I)I.begin("his_order_dec");Z.fromStream(a);if(I)I.end("his_order_dec");break;case 4:if(I)I.begin("his_bitmap_dec");g=a.getLittleEndian32();for(e=0;e<g;e++){var l=a.getLittleEndian32();var r=a.getLittleEndian32();var m=a.getLittleEndian32();
var k=a.getLittleEndian32();var q=a.getLittleEndian32();var p=a.getLittleEndian32();var t=a.getLittleEndian32();d=a.getLittleEndian32();h=new Uint32Array(a.getData().buffer,a.getPosition(),d);var K=new Uint32Array(d);K.set(h);a.skipPosition(d*4);Fa.putBitmap(l,r,new Ua(K,q,p,m,k,t))}if(I)I.end("his_bitmap_dec");break;case 5:Va.fromStream(a);break;case 6:cb.fromStream(a);break;case 7:for(;a.has(6);){e=a.getLittleEndian16();d=a.getLittleEndian32();if(d){nc(e,a.getData().subarray(a.getPosition(),a.getPosition()+
d));a.skipPosition(d)}}break;case 9:nb.fromStream(a)}}if(ha)ha.check(15555)}function Ed(a){var f=a.getByte();switch(f){case 0:var e=new Uint8Array(2);e[0]=146;e[1]=1;Q.send(e.buffer);break;case 1:break;case 5:var d=a.getByte();var g=a.getLittleEndian32();if(d==0)if(!(g&4)){wa^=65536;B.execute("setFeature",[wa])}}}function fc(a){var f=a.getAscllString(8);var e=Qa[f];if(e!=null)e.process(a);else svGlobal.logger.warn("Channel "+f+" not found")}function Fd(){var a=w.substring(w.indexOf("?")+1);J("00"+
a);J("87"+navigator.userAgent)}function Nd(a){var f=a.split("\t");svGlobal.logger.debug(a);var e=B.getWinById(parseInt(f[0]));if(e){if(!B.hasApp(f[1])){var d=B.getOwnerSurface(e);if(d&&d.railWin)d.railWin.appId=f[1];if(n.onremoteappstart)n.onremoteappstart({"id":f[1]})}e.appId=f[1]}}function Rd(a,f){var e=0;var d=false;this.width=a;this.interval=f;var g=0;this.start=function(){if(d)return;d=true;e=setInterval(function(){var f=B.getFocused();if(f&&ga){var b=f.getThumbnail(a);if(b&&b.length!=g){J("8E7"+
b);g=b.length}}},f)};this.stop=function(){clearInterval(e)}}function Sd(a,f){if(Ba&&(Ba.width!=a||Ba.interval!=f)){Ba.stop();Ba=null}if(!Ba)Ba=new Rd(a,f);Ba.start()}function oc(){if(Ba){Ba.stop();Ba=null}}function Gd(a){if(!n)return;Ka=false;Eb=false;db=n.reconnectTimes;Z=new Cb;if(n&&n.mode==0)mc();var f="";for(f in Pa){var e=Pa[f];if(e&&e.onopen)e.onopen()}for(f in Qa){e=Qa[f];if(e&&e.onopen)e.onopen()}if(a){var d=JSON.parse(a);if(d.capability&&n)n.sessionInfo.suppressOutput=d.capability.suppressOutput}}
function lc(a){var f=a.getAscllString(8);var e=Pa[f];if(e&&e.process)e.process(a)}function Cd(a){var f=a.getByte();var e=a.getLittleEndian32();switch(f){case 1:var d=a.getAscllString();if(ja[d]){ja[d].id=e;svGlobal.logger.info("DVC create, name:"+d+" id:"+e);ja[e]=ja[d];if(ja[e].onopen)ja[e].onopen()}break;case 3:if(ja[e])ja[e].process(a);break;case 4:if(ja[e]&&ja[e].onclose)ja[e].onclose();svGlobal.logger.info("close DVC, id:"+e)}}function kc(a){var f=parseInt(a.substring(0,1),16);var e;var d;var g=
a.substring(1);var c=false;var b=n.sessionInfo.appInfo;switch(f){case 0:d=JSON.parse(g);Zb();ga=true;var h=d.width;var l=d.height;if(h==M&&l==Y)break;jb(h,l);B.setSize(h,l,da?"hidden":null);A=hb(h,l);break;case 1:d=JSON.parse(g);n.sessionInfo.joinedSessions.push(d.numericId);b.sessions[d.numericId]=d.name||d.__ip;if(!b.joined||N.alertJoin){if(n.onsessionjoin)c=n.onsessionjoin(d);if(!c)n.showMessage(__svi18n.info.joinsession.applyArgs([d.numericId,d.__ip,d.name]))}break;case 2:d=JSON.parse(g);n.sessionInfo.joinedSessions.removeElm(d.numericId);
delete b.sessions[d.numericId];if(!b.joined||N.alertJoin){if(n.onsessionexit)c=n.onsessionexit(d);if(!c)n.showMessage(__svi18n.info.exitsession.applyArgs([d.numericId,d.__ip,d.name]))}break;case 3:d=JSON.parse(g);if(b.joinMode!=d.mode){b.joinMode=d.mode;var r=hi5.$("joinSelect");if(r)r.value=d.mode}if(b.hasControl)return;b.hasControl=true;B.setReadOnly(false,d.mode==2);e=hi5.$("requestControl");if(e)e.disabled=true;if(n.ongivecontrol)c=n.ongivecontrol();if(c)break;n.showMessage(__svi18n.info.givecontrol,
null,5E3);break;case 4:d=JSON.parse(g);B.setReadOnly(true,d.mode==2);b.hasControl=false;e=hi5.$("requestControl");if(e)e.disabled=false;if(n.ontakebackcontrol)c=n.ontakebackcontrol();if(c)break;n.showMessage(__svi18n.info.nocontrol,null,5E3);break;case 5:var m=function(){n.refuseControl(d.numericId);this.destroy()};var k=function(){n.giveControl(d.numericId);this.destroy();if(A.isPaused())n.pauseSession(n.sessionInfo.appInfo.numericId,false)};d=JSON.parse(g);if(n.onrequirecontrol)c=n.onrequirecontrol(d);
if(c)break;var q=__svi18n.info.title.applyArgs([d.name,d.numericId,d.__ip]);var p=__svi18n.info.recontrol;if(A.isPaused)p+="<br><br>"+(__svi18n.info.autoresume||"");hi5.notifications.notify({"title":q,"msg":p,"cbYes":k,"cbNo":m});break;case 6:B.execute("setTouchRemoting",[true]);break;case 7:d=JSON.parse(g);if(d.width&&d.height){A=hb(d.width,d.height);jb(d.width,d.height);B.setSize(d.width,d.height)}if(d.color){ib(d.color);svGlobal.logger.warn("Color depth changed to:"+d.color)}break;case 8:d=JSON.parse(g);
Eb=true;if(n.onrequestcredential&&n.onrequestcredential(d,Sa.reconnect))return;if(n.onautherror&&n.onautherror(d,Sa.reconnect))return;var t=B.getFocused();t.requestCredential(d,Sa.reconnect);break;case 9:d=JSON.parse(g);if(d.interval>0&&d.width>0)Sd(d.width,d.interval);else oc();break;case 11:var K=function(){n.allowJoin(d.numericId,false);this.destroy()};var y=function(){n.allowJoin(d.numericId,true);this.destroy()};d=JSON.parse(g);if(n.onrequirejoin)c=n.onrequirejoin(d);if(c)break;q=__svi18n.info.title.applyArgs([d.name,
d.numericId,d.__ip]);hi5.notifications.notify({"title":q,"msg":__svi18n.info.reqjoin,"cbYes":y,"cbNo":K})}}function Qd(a){var f=JSON.parse(a);switch(f.type){case 0:jb(f.width,f.height);A=hb(M,Y);ib(f.color);var e=f.server;if(e&&n)n.server=f.server;pc=f.length;var d=B.getFocused();da=f.isRail==true;if(d){d.setSize(M,Y,da?"hidden":null);d.setAutoScale(!da);if(e)sb(sa(),d.getWindow());e=f.keyboard;if(typeof e!="undefined"&&e==0)d.setUnicode(true);e=f.mapDisk;if(e){Fb=true;bc(d)}}if(n.onopened)n.onopened(f);
break;case 1:var g=f.duration;if(n.onprogress)n.onprogress(g,pc);break;case 2:if(f.status==2){Zb();ga=true}else{var c=f.status==0;if(c!=A.isPaused()){if(n.onsessionpause&&n.onsessionpause(c,f))break;A.pause(c);if(!c)B.repaint(0,0,A.width-1,A.height-1);if(f.warn)n.showMessage(c?__svi18n.info.sessionPaused:__svi18n.info.sessionResumed)}}}}function jc(a){var f=a.getByte();switch(f){case 32:Td(a)}}function Td(a){if(A.isPaused())return;var f=a.getLittleEndian16();var e=a.getLittleEndian16();var d=a.getLittleEndian16();
var g=undefined;var c=undefined;if(!N.noCursorName){g=a.getLittleEndian32();if(n.sessionInfo.appInfo)c=n.sessionInfo.appInfo.sessions[g]}B.getFocused().moveCursor(e,d,true,c,g)}function Pd(a){var f=hi5.Base64.dec(a,0);var e=new RdpBuffer(f,0,f.length);wa=e.getLittleEndian32();if(ya||!(wa&16)&&!(wa&65536)){Fb=false;qa=null}else if(wa&128)qa=null;if(wa&64)n.showMessage(__svi18n.info.recording);B.execute("setFeature",[wa])}function ic(a){var f=JSON.parse(a);var e=f;kb=f.session;if(!e.server)e.server=
sa();var d=hi5.$("joinSelect");if(d)d.value=e.joinMode;d=hi5.$("requestControl");if(d)d.disabled=e.hasControl;if(f.joined)B.execute("setAutoScale",[true]);else{n.mode=0;if(pa(u.connectif))B.setSize(M,Y);if(N.disableJoinedAppResize)n.windowState=0}var g=N.page&&N.page.join||"join.html";var c=za();g=c+"/"+g+"?id="+(f.joined||f.numericId);var b=f.webAddress;if(b&&b.length>0&&b.toLowerCase()!=c.toLowerCase()){var h=b.indexOf("://");n.protocol=b.substring(0,h)=="http"?"ws":"wss";n.gateway=b;g+="&gateway="+
encodeURIComponent(b)}g=n.modifyURL(g);e.joinLink=g;n.sessionInfo.appInfo=e;if("isApp"in e&&da!==e.isApp){da=e.isApp;Sb();B.setSize(M,Y,da?"hidden":null);A=hb(M,Y);if(!Oa)B.execute("setAutoScale",[true])}if(f.ver&&f.ver!=svGlobal.version)svGlobal.logger.warn("Client:"+svGlobal.version+" server:"+f.ver);if(n.onsessionstart)n.onsessionstart(n.sessionInfo)}function Od(a){if(!qa)return;var f=parseInt(a.charAt(0),10);a=a.substring(1);if(f==5){qa.notifyFiles(JSON.parse(a));return}var e=a.split("\t");switch(f){case 1:qa.confirmId(e[0],
e[1],e[2]);break;case 2:qa.read(e[0],parseInt(e[1],10),parseInt(e[2],10));break;case 4:qa.close(e[0]);break;case 9:var d='<a href="'+e[0]+'" download="'+e[1]+'" target="_blank">'+__svi18n.info.fileReady+"</a>";B.getFocused().showMessage({msg:d,title:__svi18n.info.download})}}function Md(a){var f=parseInt(a.substring(0,1),16);var e=a.substring(1);switch(f){case 0:Ud(e);break;case 1:Vd(e);break;case 2:qc();case 3:}}function Bd(a){var f=a.getByte();switch(f){case 0:Wd(a);break;case 1:Xd(a);break;case 2:qc();
case 3:}}function qc(){}function Vd(a){function f(a){var b=0;a=a*l;for(m=0;m<l;m++)b|=(c[a+m]&255)<<m*8;if(b>k){b-=p;b/=-q}else b/=k;return b}function e(a){return function(){J("8A"+a)}}if(!ma.available||A.isPaused())return;var d=a.indexOf("\t");var g=a.substring(0,d);var c=hi5.Base64.dec(a,d+1);var b=aa.tag!=1;if(b){if(!eb)eb=new Qb;c=eb.decode(c,0,c.length)}var h=aa.bitsPerSample;var l=h>>3;var r=Math.floor(c.length/l);var m=0;var k=Math.pow(2,h-1)-1;var q=-k-1;var p=Math.pow(2,h);var t=0;var n=
aa.channels;var y=Math.floor(r/n);var P=ma.getBuffer(y);var E=P.getChannelData(0);var x=P.getChannelData(1);for(t=0;t<y;){var z=t*2;var C=f(z);if(n==1){E[t]=C;x[t]=C}else{E[t]=C;x[t]=f(z+1)}t++}var D=ma.playBuffer(P);setTimeout(e(g),(D-ma.delay)*1E3)}function Xd(a){function f(a){return function(){J("8A"+a)}}var e=a.getByte();var d=a.getLittleEndian16();var g=Date.now();a.skipPosition(8);var c=Gb(a,e,d,0);c=(c-ma.delay)*1E3;if(!ya){d+=Date.now()-g+c;setTimeout(f(e+","+d),c)}}function Gb(a,f,e,d){if(!ma.available||
A.isPaused())return;var g=a.getPosition();var c=a.getData();var b=d||a.getEnd()-g;if(aa.tag==41222){var h=ma.getContext();if(h)h.decodeAudioData(c.buffer.slice(g),function(a){var b=ma.playBuffer(a);if(!ya)setTimeout(sendLater(ad),(b-ma.delay)*1E3)},function(a){svGlobal.logger.warn(a)});return}var l=aa.tag!=1;if(l){if(!eb)eb=new Qb;c=eb.decode(c,g,b);g=0;b=c.length}var r=aa.bitsPerSample;var m=r>>3;var k=Math.floor(b/m);var q=0;var p=0;var t=0;if(!l){q=Math.pow(2,r-1)-1;p=-q-1;t=Math.pow(2,r)}var n=
g;var y=0;var P=0;var E=aa.channels;var x=Math.floor(k/E);var z=ma.getBuffer(x);var C=z.getChannelData(0);var D=z.getChannelData(1);y=0;if(l)for(;y<x;){if(E==1)D[y]=C[y]=c[n++];else{C[y]=c[n++];D[y]=c[n++]}y++}else for(;y<x;){P=c[n++]|c[n++]<<8;if(P>q){P-=t;P/=-p}else P/=q;if(E==1){C[y]=P;D[y]=P}else{C[y]=P;P=c[n++]|c[n++]<<8;if(P>q){P-=t;P/=-p}else P/=q;D[y]=P}y++}var u=ma.playBuffer(z);return u}function Ud(a){var f=a.split("\t");aa.tag=parseInt(f[0],10);aa.channels=parseInt(f[1],10);aa.bitsPerSample=
parseInt(f[2],10);aa.samplePerSec=parseInt(f[3],10);svGlobal.logger.debug("Audio Format, tag="+aa.tag+" channels="+aa.channels+" bitsPerSample="+aa.bitsPerSample+" samplePerSec="+aa.samplePerSec)}function Wd(a){aa.tag=a.getLittleEndian16();aa.channels=a.getLittleEndian16();aa.samplePerSec=a.getLittleEndian32();a.skipPosition(6);aa.bitsPerSample=a.getLittleEndian16();svGlobal.logger.info("Audio Format, tag="+aa.tag+" channels="+aa.channels+" bitsPerSample="+aa.bitsPerSample+" samplePerSec="+aa.samplePerSec)}
function Yd(a){var f=null;this.available=false;this.delay=a;this.supportWebAudio=false;if(u.playSound==0||n.mode>0){f=hi5.audio.getAudioContext();if(f){this.available=true;this.supportWebAudio=true}}this.getContext=function(){return f};this.getBuffer=function(a){return f.createBuffer(2,a,aa.samplePerSec)};var e=0;var d=null;var g=null;this.setVolume=function(a){if(a==1)d=null;else{if(!d)d=f.createGain();d.gain.value=a}};this.playBuffer=function(c){g=f.createBufferSource();g.buffer=c;if(d){g.connect(d);
d.connect(f.destination)}else g.connect(f.destination);var b=f.currentTime;var h=e>0?e:b+a;if(h<b)h=b;e=h+c.duration;if(g.start)g.start(h);else g.noteOn(h);return e-b};this.iOSFix=function(){if(f&&hi5.browser.isTouch&&hi5.browser.isSafari){var a=this.getBuffer(1024);var b=f.createBufferSource();b.buffer=a;b.connect(f.destination);if(b.start)b.start(0);else b.noteOn(0)}};this.close=function(){if(f){if(d)d.disconnect();if(g)g.disconnect();hi5.audio.releaseAudioContext()}}}function Ld(a){var f=a.split("\t");
a=za()+f[0];a=n.modifyURL(a);svGlobal.logger.info("Downloading file:"+a+" name:"+f[1]+" driver:"+f[2]);if(n.onprintingready)if(n.onprintingready({"link":a,"printerName":f[1],"pinterDriver":f[2]}))return;var e=B.getFocused();if(e)e.showPDF(a)}function Kd(a){B.setReadOnly(a=="1")}function Jd(a){var f=parseInt(a.substring(0,1),10);a=a.substring(1);switch(f){case 1:Zd(a);break;case 2:$d(a);break;case 5:ae(a)}}function ae(a){var f=B.getFocused();if(f&&a!="0")f.setIgnorePaste(true)}function $d(a){var f=
B.getFocused();if(f)if(!f.processClipReq(a))if((N.clipWarnAlways||!rc)&&u&&!u["leagacyMode"]){n.showMessage(__svi18n.info.menucopy,null,5E3);rc=true}}function be(a){if(!n.openLink||a.length>2E3)return false;var f=a.indexOf(";");if(f>0)a=a.substring(f+1);var e=a;a=a.toLowerCase();var d=a.indexOf("http://")==0||a.indexOf("https://")==0||a.indexOf("ftp://")==0||a.indexOf("mailto:")==0||a.indexOf("tel:")==0||a.indexOf("callto:")==0;if(!d)if(a.indexOf("www.")==0){d=true;a="http://"+a}else if(a.indexOf("ftp.")==
0){d=true;a="ftp://"+a}if(d){if(a.indexOf("\r")>0||a.indexOf("\n")>0)return false;if(n.onurlredirection&&n.onurlredirection(d))return true;var g=B.getFocused();if(!g)return false;g.processLink(e);return true}return false}function Zd(a){if(n.onservercopy&&n.onservercopy(a))return;if(!be(a))B.copyToClip(a);setTimeout(function(){J("883")},999)}function gc(a){var f=a.getLittleEndian16();var e=a.getByte();var d=a.getByte();var g=a.getLittleEndian16();var c=null;if((d&32)!=0){g-=18;var b=ua.dec(a.getData(),
a.getPosition(),g,d);c=ua.getData()}else c=a;switch(e){case 2:ce(c);break;case 20:break;case 31:Ka=false;break;case 27:de(c);break;case 34:break;case 38:ee(c);Ka=false;break;case 40:Sa.sendKeyboardSynchronize(pa(u.scrollLock),pa(u.numLock),pa(u.capsLock));Ka=false;break;case 47:fe(c);break;case 50:c.skipPosition(4);break;case 54:ge(c);break;case 55:he(c);break;default:svGlobal.logger.warn("Unimplemented Data PDU type "+e)}}function he(a){var f=a.getLittleEndian32();var e=0;var d=0;var g=0;var c=0;
var b=0;var h=0;var l=0;var r=0;for(var m=0;m<f;m++){e=a.getLittleEndian32();d=a.getLittleEndian32();g=a.getLittleEndian32();c=a.getLittleEndian32();a.skipPosition(4);b=Math.min(e,b);h=Math.max(h,g);l=Math.min(d,l);r=Math.max(r,c)}e=h-b+1;d=r-l+1;svGlobal.logger.warn("monitor, count:"+f+" w:"+e+" h:"+d);jb(e,d)}function ge(a){var f=a.getLittleEndian32().toString(16).toUpperCase();var e=__svi18n.serverStatus[f];if(n.displayMsg)svGlobal.logger.info(e)}function Ca(){var a=n.sessionInfo.appInfo;if(a&&
!a.joined&&Oa){svGlobal.logger.info("Recovering");ac(M,Y)}}function ce(a){var f=a.getLittleEndian16();switch(f){case 0:a.skipPosition(2);var e=a.getLittleEndian16();a.skipPosition(2);sc(a,e);break;case 1:tc(a);break;case 2:uc(a);break;case 3:break;default:svGlobal.logger.warn("Unimplemented Update type "+f);Ca()}}function de(a){var f=0;var e=0;var d=0;f=a.getLittleEndian16();a.skipPosition(2);switch(f){case 3:e=a.getLittleEndian16();d=a.getLittleEndian16();if(A.isPaused())break;B.getFocused().moveCursor(e,
d,true);break;case 6:vc(a);break;case 7:wc(a);break;case 1:ie(a);break;case 8:xc(a);default:}}function ie(a){var f=a.getLittleEndian16();switch(f){case 0:yc();break;default:svGlobal.logger.warn("XXX system pointer message "+f)}}function je(a,f){var e;var d;var g=n.sessionInfo;switch(f){case 0:a.skipPosition(4);g.domain=a.getUnicodeString(52,true);a.skipPosition(4);g.userName=a.getUnicodeString(512,true);g.sessionId=a.getLittleEndian32();break;case 1:g.version=a.getLittleEndian16();a.skipPosition(4);
g.sessionId=a.getLittleEndian32();e=a.getLittleEndian32();d=a.getLittleEndian32();a.skipPosition(558);g.domain=a.getUnicodeString(e,true);g.userName=a.getUnicodeString(d,true);case 2:}return g}function zc(){if(!Oa){setTimeout(function(){if(ga)J("884")},999);if(n.onloggedin)n.onloggedin()}Oa=true;if(da)B.execute("setAutoScale",[false]);if(qa)qa.enabled=true;if(ub&&!da){A.setContext(B.getFocused().context);B.repaint(0,0,A.width-1,A.height-1)}}function ee(a){var f=a.getLittleEndian32();if(f<3){je(a,
f);zc();return}if(f!=3)return;a.skipPosition(2);var e=a.getLittleEndian32();a.skipPosition(4);if(e==2)return;var d=a.getLittleEndian32();a.skipPosition(4);var g=new Object;g.logId=a.getLittleEndian32();g.time=Date.now();n.sessionInfo.sessionId=g.logId;zc();var c=a.getBytes(16);var b=new Array(16);for(var h=0;h<16;h++)b[h]=c[h]&255;g.random=b;var l="8D"+g.logId+"\t"+hi5.Base64.enc(b);if(n.sessionInfo.userName){l+="\t"+n.sessionInfo.userName;if(n.sessionInfo.domain)l+="\t"+n.sessionInfo.domain}if(!ya)J(l)}
function fe(a){Ka=true;var f=a.getLittleEndian32();svGlobal.logger.info("Disconnect:"+f);var e=f==11&&da;if(e)B.close();var d=f<1||e;if(d)return;if(!ya&&ga)J("85"+f);Yb(f.toString(16).toUpperCase())}function ke(){var a=0;var f=0;var e=[0];var d=new RdpBuffer(e,0,0);this.addFragement=function(d,c){Na(d.getData(),d.getPosition(),e,f,c);f+=c;a+=c};this.clearFragements=function(){d.setPosition(0);d.markEnd(a);a=0;f=0;return d}}function hc(a){var f=a.getByte();var e=f&15;var d=f>>4&3;var g=f>>6&3;var c;
var b=0;if(g==2)b=a.getByte();c=a.getLittleEndian16();var h=null;if((b&32)!=0){var l=ua.dec(a.getData(),a.getPosition(),c,b);h=ua.getData();c=ua.getDecompressedLength()}else h=a;if(d!=0)switch(d){case 2:case 3:vb.addFragement(h,c);return;case 1:vb.addFragement(h,c);h=vb.clearFragements()}if(I)I.begin("decodeFastPath");switch(e){case 0:var r=h.getLittleEndian16();sc(h,r);break;case 1:h.skipPosition(2);tc(h);break;case 2:h.skipPosition(2);uc(h);break;case 3:break;case 4:le(h);break;case 5:yc(h);break;
case 6:break;case 8:break;case 9:vc(h);break;case 10:wc(h);break;case 11:xc(h);break;default:svGlobal.logger.warn("XXX RDP5 opcode "+e);Ca()}if(I)I.end("decodeFastPath")}function le(a){var f=a.getEnd();var e;var d;var g;for(var c;a.getPosition()<f;){var b=a.getLittleEndian16();switch(b){case 1:case 6:e=a.getLittleEndian16();d=a.getLittleEndian16();g=a.getLittleEndian16();c=a.getBigEndian16();me(a,e,d,g,c);break;case 4:ne(a);break;default:svGlobal.logger.warn("Invalid surface cmd:"+b)}}}function ne(a){var f=
a.getLittleEndian16();var e=a.getLittleEndian32();if(f==1)J("91"+e)}function wb(a,f,e,d,g,c){var b;var h=d*c;for(var l=0;l<g;l++){b=f+(g-l-1)*h;Na(a,b,e,l*h,h)}}function oe(){var a=new Uint32Array(10240);var f=0;var e=new Uint8Array(10240);var d=0;var g=new Uint8Array(10240);var c=0;var b=new Uint8Array(10240);var h=0;var l=new Uint8Array(0);var r=0;this.getData=function(){return a};this.getDataSize=function(){return f};this.resetData=function(b){if(a.length<b)a=new Uint32Array(b);f=b;return a};this.resetLumaPlane=
function(a){if(e.length<a)e=new Uint8Array(a);d=a;return e};this.getLumaPlanceSize=function(){return d};this.resetOrangeChromaPlane=function(a){if(g.length<a)g=new Uint8Array(a);c=a;return g};this.getOrangeChromaPlane=function(){return c};this.resetGreenChromaPlane=function(a){if(b.length<a)b=new Uint8Array(a);h=a;return b};this.getGreenChromaPlane=function(){return h};this.resetAlphaPlane=function(a){if(l.length<a)l=new Uint8Array(a);r=a;return l};this.getAlphaPlane=function(){return r}}function pe(){function a(a,
f,b,e,l,r,m,k,q){var p=0;var t=0;var n=0;var y=0;var P=0;var E=0;var x=0;var z=0;var C=0;var D=0;var u=0;var A=0;var F=d(l,8);var v=m-1;for(t=0;t<r;t++){if(k>0){n=t*F;y=(t>>1)*(F>>1);P=(t>>1)*(F>>1)}else{n=t*l;y=t*l;P=t*l}for(p=0;p<l;p++){E=a[n]&255;x=(f[y]&255)<<v<<24>>24;z=b[P]<<v<<24>>24;C=E+x-z;D=E+z;u=E-x-z;u=u<0?0:u>255?255:u;D=D<0?0:D>255?255:D;C=C<0?0:C>255?255:C;q[A++]=4278190080|u<<16|D<<8|C;n++;y+=k>0?p%2:1;P+=k>0?p%2:1}}}function f(a,f,b,d,l){if(b==0)Ha(d,0,l,255);else if(b<l)e(a,f,d,
l);else Na(a,f,d,0,l)}function e(a,f,b,d){var e=0;var r=0;var m=0;r=d;for(var k=0;r>4;){m=a[f++];if(r==5){b[k++]=m;r--}else if(m==a[f]){f++;if((a[f]&255)<255){e=a[f++]&255;e+=2}else{f++;e=(a[f+3]&255)<<24|(a[f+2]&255)<<16|(a[f+1]&255)<<8|a[f]&255;f+=4}Ha(b,k,k+e,m);k+=e;r-=e}else{b[k++]=m;r--}}for(var q=0;q<4;q++)b[k++]=a[f++]}function d(a,f){return a+(~(a&f-1)+1&f-1)}this.process=function(e,c,b,h,l){var r=e.getLittleEndian32();var m=e.getLittleEndian32();var k=e.getLittleEndian32();e.skipPosition(4);
var q=e.getByte();var p=e.getByte();e.skipPosition(2);var t=e.getData();var n=e.getPosition();var y=b*h;var P=y*4;var E=l.resetData(y);var x=d(b,8);var z=d(h,2);P=x*z;var C=l.resetLumaPlane(P);var D=l.resetOrangeChromaPlane(P);var u=l.resetGreenChromaPlane(P);var A=b*h;var F=p>0?x*h:A;var v=p>0?(x>>1)*(z>>1):A;var H=p>0?v:A;f(t,n,r,C,F);n+=r;f(t,n,m,D,v);n+=m;f(t,n,k,u,H);n+=k;a(C,D,u,null,b,h,q,p,E);e.skipPosition(r+m+k)}}function Ac(a,f,e){var d=a;var g=e;var c=0;var b=8;var h=f;this.attach=function(a,
f,e){d=a;g=e;c=0;b=8;h=f};this.getBits=function(a){var f=a;var e=0;for(var k=0;c<g&&f>0;){e=f;if(e>b)e=b;if(k!=0)k<<=e;k|=d[c+h]>>b-e&(1<<e)-1;b-=e;f-=e;if(b==0){b=8;c++}}return k};this.putBits=function(a,f){var e=a;var k=f;for(var q=0;c<g&&k>0;){q=k;if(q>b)q=b;d[c+h]|=(e>>k-q&(1<<q)-1)<<b-q;b-=q;k-=q;if(b==0){b=8;c++}}};this.eos=function(){return c>g};this.left=function(){return c>=g?0:(g-c-1)*8+b};this.getProcessBytes=function(){return b<8?c+1:c}}function Bc(){this.quantIdxY=0;this.quantIdxCb=0;
this.quantIdxCr=0;this.YLen=0;this.CbLen=0;this.CrLen=0;this.x=0;this.y=0;this.data=new Uint32Array(4096);var a=this;this.readHeaderfromStream=function(f){f.skipPosition(6);a.quantIdxY=f.getByte();a.quantIdxCb=f.getByte();a.quantIdxCr=f.getByte();a.x=f.getLittleEndian16()*64;a.y=f.getLittleEndian16()*64;a.YLen=f.getLittleEndian16();a.CbLen=f.getLittleEndian16();a.CrLen=f.getLittleEndian16()}}function qe(){function a(a,b,f,d){for(var e=0;e<4096;e++)d[e]=4278190080|f[e]<<16|b[e]<<8|a[e]}function f(a,
b,f){var d=0;var e=0;var g=0;var c=0;var h=0;var l=0;var n=0;for(n=0;n<4096;n++){d=a[n];e=b[n];g=f[n];d=d+4096<<16;c=d+g*91947;h=d-e*22544-g*46792;l=d+e*115998;c=c>>21;h=h>>21;l=l>>21;a[n]=c<0?0:c>255?255:c;b[n]=h<0?0:h>255?255:h;f[n]=l<0?0:l>255?255:l}}function e(a,b,f,e,g,t,n){l(a.et,e,g,t,n,4096,a.bitStream);h(n,4032,64);c(n,b);d(n,a.dwtBuffer)}function d(a,b){g(a,3840,b,8);g(a,3072,b,16);g(a,0,b,32)}function g(a,b,f,d){var e=0;var g=0;var c=0;var h=0;var l=0;var n=0;var x=0;var z=0;var C=0;var D=
0;var u=0;var A=0;var F=0;D=d<<1;C=b+d*d*3;n=b;h=0;x=b+d*d;z=b+d*d*2;l=d*d*2;for(A=0;A<d;A++){f[h]=a[C]-(a[n]+a[n]+1>>1)<<16>>16;f[l]=a[x]-(a[z]+a[z]+1>>1)<<16>>16;for(F=1;F<d;F++){u=F<<1;f[h+u]=a[C+F]-(a[n+F-1]+a[n+F]+1>>1)<<16>>16;f[l+u]=a[x+F]-(a[z+F-1]+a[z+F]+1>>1)<<16>>16}for(F=0;F<d-1;F++){u=F<<1;f[h+u+1]=(a[n+F]<<1)+(f[h+u]+f[h+u+2]>>1)<<16>>16;f[l+u+1]=(a[z+F]<<1)+(f[l+u]+f[l+u+2]>>1)<<16>>16}u=F<<1;f[h+u+1]=(a[n+F]<<1)+f[h+u]<<16>>16;f[l+u+1]=(a[z+F]<<1)+f[l+u]<<16>>16;C+=d;n+=d;h+=D;x+=
d;z+=d;l+=D}for(u=0;u<D;u++){for(F=0;F<d;F++){A=F<<1;e=b+A*D+u;g=F*D+u;c=g+d*D;a[e]=f[g]-((F>0?f[c-D]:f[c])+f[c]+1>>1)<<16>>16}for(F=0;F<d;F++){A=F<<1;e=b+A*D+u;g=F*D+u;c=g+d*D;a[e+D]=(f[c]<<1)+(a[e]+a[e+(F<d-1?2*D:0)]>>1)<<16>>16}}}function c(a,f){b(a,0,4096,5);b(a,0,1024,f[8]-6);b(a,1024,1024,f[7]-6);b(a,2048,1024,f[9]-6);b(a,3072,256,f[5]-6);b(a,3328,256,f[4]-6);b(a,3584,256,f[6]-6);b(a,3840,64,f[2]-6);b(a,3904,64,f[1]-6);b(a,3968,64,f[3]-6);b(a,4032,64,f[0]-6)}function b(a,b,f,d){if(d==0)return;
for(var e=b;f>0;e++,f--)a[e]<<=d}function h(a,b,f){var d;var e;for(d=b,e=b+1;f>1;d++,e++,f--)a[e]+=a[d]}function l(a,b,f,d,e,g,c){var h=1;var l=h<<3;var n=1;var x=n<<3;var u=0;var C=e;var D=0;var A=0;var w=0;if(c==null)c=new Ac(b,f,d);else c.attach(b,f,d);for(;!c.eos()&&g>0;){var F;if(h!=0){var v;for(var H;!c.eos();){u=c.getBits(1);if(u!=0)break;var ca=1<<h;var B=ca;if(B>g)B=g;if(B>0){Ha(C,D,D+B,0);D+=B}g-=ca;l+=4;if(l>80)l=80;if(l<0)l=0;h=l>>3}F=c.getBits(h);ca=F;B=ca;if(B>g)B=g;if(B>0){Ha(C,D,D+
B,0);D+=B}g-=ca;H=c.getBits(1);A=0;w=0;do{u=c.getBits(1);if(u==1)A++;else break}while(true);w=c.getBits(n);w|=A<<n;if(A==0){x+=-2;if(x>80)x=80;if(x<0)x=0;n=x>>3}else if(A!=1){x+=A;if(x>80)x=80;if(x<0)x=0;n=x>>3}v=w+1;if(g>0)C[D++]=H!=0?-v:v;g--;l+=-6;if(l>80)l=80;if(l<0)l=0;h=l>>3}else{var la;var I;var La;A=0;w=0;do{u=c.getBits(1);if(u==1)A++;else break}while(true);w=c.getBits(n);w|=A<<n;if(A==0){x+=-2;if(x>80)x=80;if(x<0)x=0;n=x>>3}else if(A!=1){x+=A;if(x>80)x=80;if(x<0)x=0;n=x>>3}v=w;if(a!=1){var va=
v;for(la=0;va!=0;){va>>=1;la++}I=c.getBits(la);La=v-I;if(I!=0&&La!=0){l+=-2*3;if(l>80)l=80;if(l<0)l=0;h=l>>3}else if(I==0&&La==0){l+=2*3;if(l>80)l=80;if(l<0)l=0;h=l>>3}if(g>0)C[D++]=(I&1)!=0?-1*(I+1>>1):I>>1;g--;if(g>0)C[D++]=(La&1)!=0?-1*(La+1>>1):La>>1;g--}else if(v==0){if(g>0)C[D++]=0;g--;l+=3;if(l>80)l=80;if(l<0)l=0;h=l>>3}else{if(g>0)C[D++]=(v&1)!=0?-1*(v+1>>1):v>>1;g--;l+=-3;if(l>80)l=80;if(l<0)l=0;h=l>>3}}}return D}this.decodeRgb=function(b,d,g,c,h,l,n,y,u,E){e(b,g,h,d.getData(),d.getPosition(),
c,b.yrBuffer);d.skipPosition(c);e(b,g,n,d.getData(),d.getPosition(),l,b.cbgBuffer);d.skipPosition(l);e(b,g,u,d.getData(),d.getPosition(),y,b.crbBuffer);d.skipPosition(y);f(b.yrBuffer,b.cbgBuffer,b.crbBuffer);a(b.yrBuffer,b.cbgBuffer,b.crbBuffer,E)}}function re(){var a=[new gb];var f=[new Bc];var e=0;var d=0;this.resetRects=function(f){if(a.length<f){var d=a.length;a.length=f;for(var b=d;b<f;b++)a[b]=new gb}e=f;return a};this.resetTiles=function(a){if(f.length<a){var e=f.length;f.length=a;for(var b=
e;b<a;b++)f[b]=new Bc}d=a;return f};this.getRectSize=function(){return e};this.getTileSize=function(){return d};this.getRects=function(){return a};this.getTiles=function(){return f}}function se(){this.ctxId=0;this.tileSize=64;this.flags=0;this.cct=0;this.xft=0;this.et=0;this.qt=0;this.yrBuffer=new Int32Array(4096);this.cbgBuffer=new Int32Array(4096);this.crbBuffer=new Int32Array(4096);this.dwtBuffer=new Int32Array(32*32*2*2);var a=this;this.setProperties=function(f){a.flags=f&7;a.cct=f>>3&3;a.xft=
f>>5&15;a.et=f>>9&15};this.bitStream=new Ac}function te(){function a(a,b){a.skipPosition(6);var f=a.getLittleEndian16();b.cct=f>>>4&3;b.xft=f>>>6&15;b.et=f>>>10&15;b.qt=f>>>14&3;var d=a.getByte();a.skipPosition(1);var e=a.getLittleEndian16();a.skipPosition(4);var g=new Array(d*10);var c=0;var h;var m;for(m=0;m<d;m++){h=a.getByte();g[c++]=h&15;g[c++]=h>>>4;h=a.getByte();g[c++]=h&15;g[c++]=h>>>4;h=a.getByte();g[c++]=h&15;g[c++]=h>>>4;h=a.getByte();g[c++]=h&15;g[c++]=h>>>4;h=a.getByte();g[c++]=h&15;
g[c++]=h>>>4}var r=l.resetTiles(e);for(m=0;m<e;m++){var n=r[m];n.readHeaderfromStream(a);k(b,a,g,n.YLen,n.quantIdxY*10,n.CbLen,n.quantIdxCb*10,n.CrLen,n.quantIdxCr*10,n.data)}}function f(a){a.skipPosition(2);a.skipPosition(1);var b=a.getLittleEndian16();var f=l.resetRects(b);for(var d=0;d<b;d++){var e=f[d];e.x=a.getLittleEndian16();e.y=a.getLittleEndian16();e.width=a.getLittleEndian16();e.height=a.getLittleEndian16()}a.skipPosition(4)}function e(a){a.skipPosition(2)}function d(a){a.skipPosition(10)}
function g(a){a.skipPosition(2);m.ctxId=a.getByte();m.tileSize=a.getLittleEndian16();m.setProperties(a.getLittleEndian16())}function c(a){var b=a.getByte();for(var f=0;f<b;f++){var d=a.getByte();var e=a.getLittleEndian16();var g=a.getLittleEndian16();svGlobal.logger.info("Channel, id:"+d+" width:"+e+" height:"+g)}}function b(a){a.skipPosition(4)}function h(a){var b=a.getLittleEndian32();var f=a.getLittleEndian16()}var l=new re;var r=new qe;var m=new se;this.decode=function(k,p){var r=0;var n=0;var y=
0;for(var u=k.getPosition()+p;k.getPosition()<u;){r=k.getLittleEndian16();n=k.getLittleEndian32();if(n==0)break;y=k.getPosition()-6+n;switch(r){case 52416:h(k);break;case 52417:b(k);break;case 52418:c(k);break;case 52419:g(k);break;case 52420:d(k);break;case 52421:e(k);break;case 52422:f(k);break;case 52423:a(k,m);break;default:svGlobal.logger.warn("unknown blockType 0x%X"+r)}k.setPosition(y)}return l};var k=r.decodeRgb;this.getResult=function(){return l}}function me(a,f,e,d,g){var c=a.getByte();
a.skipPosition(2);var b=a.getByte();var h=a.getLittleEndian16();var l=a.getLittleEndian16();var r=a.getLittleEndian32();var m;var k=a.getPosition()+r;switch(b){case 0:var q=Ab(a.getData(),r,a.getPosition());m=new Uint32Array(q.length);wb(q,0,m,h,l,1);A.setRGBs(f,e,h,l,m,0,h);A.postPaint(f,e,h,l);break;case 1:Hb(a,c,h,l,Wa);var p=Wa.getData();var t=Wa.getDataSize();m=new Uint32Array(t);wb(p,0,m,h,l,1);A.setRGBs(f,e,h,l,m,0,h);A.postPaint(f,e,h,l);break;case 3:var n=Cc.decode(a,r);var y=n.getRects();
var u=n.getTiles();var E=n.getTileSize();var x=n.getRectSize();var z=x?new gb(0,0,0,0):null;var C=0;for(var D=0;D<E;D++){var B=u[D];if(x)for(var w=0;w<x;w++){var F=y[w];F.intersection(B.x,B.y,64,64,z);if(z.isEmpty())continue;C=(z.y-B.y)*64+(z.x-B.x);z.x+=f;z.y+=e;A.setRGBs(z.x,z.y,z.width,z.height,B.data,C,64);A.postPaint(z.x,z.y,z.width,z.height)}else{A.setRGBs(B.x,B.y,64,64,B.data,0,64);A.postPaint(B.x,B.y,64,64)}}}a.setPosition(k)}function wc(a){Dc(a.getLittleEndian16())}function vc(a){Ec(a,24)}
function xc(a){var f=a.getLittleEndian16();Ec(a,f)}function ue(a,f,e,d,g,c,b,h){this.x=a;this.y=f;this.width=e;this.height=d;this.mask=g;this.pixel=c;this.bpp=b;this.cache_idx=h}function Ec(a,f){if(ve)return;var e=0;var d=0;var g=0;var c=0;var b=0;var h=0;var l=0;b=a.getLittleEndian16();e=a.getLittleEndian16();d=a.getLittleEndian16();g=a.getLittleEndian16();c=a.getLittleEndian16();h=a.getLittleEndian16();l=a.getLittleEndian16();var r=a.getBytes(l);var m=a.getBytes(h);if(e<0||e>=g-1)e=0;if(d<0)d=0;
else if(d>=c)d=c-1;var k=true;for(var q=0;q<l;q++)if(r[q]!=0){k=false;break}we(new ue(e,d,g,c,m,r,f,b),k);Dc(b)}function xe(a,f,e,d,g,c){if(g!=1)f=d-f-1;var b=(f*e+a)*g;var h=b/8>>0;var l=c[h]&255;switch(g){case 1:l=l&128>>b%8;return l==0?0:4294967295;case 8:return l==0?0:4294967295;case 15:l=(c[h+1]&255)<<8|l;var r=new Array(4);Fc(l,15,r,0);return r[0]<<16|r[1]<<8|r[2];case 16:l=(c[h+1]&255)<<8|l;r=new Array(4);Fc(l,16,r,0);return r[0]<<16|r[1]<<8|r[2];case 24:return(c[h+2]&255)<<16|(c[h+1]&255)<<
8|l;case 32:return(c[h+3]&255)<<24|(c[h+2]&255)<<16|(c[h+1]&255)<<8|l}svGlobal.logger.warn("invalid bpp value for Xor Mask.");return 0}function ye(a,f,e,d,g,c){if(g!=1)f=d-f-1;e=((e+7)/8|0)*8;var b=f*e+a;var h=b/8>>0;var l=c[h]&128>>b%8;return l==0?1:0}function ze(a,f,e,d,g,c){var b=new Array(a*f);b[0]=0;var h=0;var l=true;var r=e.length;for(var m=0;m<r;m++)if(e[m]!=0){l=false;break}var k=0;var q;for(m=0;m<f;m++)for(q=0;q<a;q++){b[h]=xe(q,m,a,f,g,d);if(!l){k=ye(q,m,a,f,g,e);if(k==0&&b[h]!=0){b[h]=
~b[h];b[h]|=4278190080}else if(k==1||b[h]!=0)b[h]|=4278190080;if(g==32&&b[h]==-1&&k==0)b[h]=0}h++}return b}function Ib(a,f,e,d,g,c,b,h,l){function r(){var a=0|0;if(f){var b=0;for(var d=f.length;b<d;b++)if(f[b]!=0)a+=b%g+(b/g|0)}return a}function m(a){switch(a){case 507:return"text";case 2046:case 4359:return"default";default:return""}}this.cache_idx=a;this.rawData=f;this.none=!f;this.hotX=e;this.hotY=d;this.width=g;this.height=c;this.xorSize=h;this.andSize=l;this.result="";this.distance=0;this.bpp=
b;this.system="";this.init=function(){if(!this.distance)this.distance=r();if(!this.system)this.system=m(this.distance)};var k="";if(!this.system&&f){var q=40;var p=g*c*4;var t=22+q+p+h+l;var n=new Uint8Array(t);var y=new RdpBuffer(n,0,t);y.setLittleEndian16(0);y.setLittleEndian16(2);y.setLittleEndian16(1);y.setByte(g);y.setByte(c);y.setByte(0);y.setByte(0);y.setLittleEndian16(e);y.setLittleEndian16(d);y.setLittleEndian32(q+p+h+l);y.setLittleEndian32(22);y.setLittleEndian32(q);y.setLittleEndian32(g);
y.setLittleEndian32(c*2);y.setLittleEndian16(1);y.setLittleEndian16(32);y.setLittleEndian32(0);y.setLittleEndian32(h+l);y.setLittleEndian32(0);y.setLittleEndian32(0);y.setLittleEndian32(0);y.setLittleEndian32(0);var u;var A;for(u=c-1;u>=0;u--)for(A=0;A<g;A++){var x=f[g*u+A];y.setByte(x&255);y.setByte(x>>8&255);y.setByte(x>>16&255);y.setByte(x>>24&255)}if(hi5.browser.isIE);else k="data:image/x-icon;base64,"+hi5.Base64.enc(y.getData())}this.url=k}function we(a,f){var e=a.x;var d=a.y;var g=a.width;var c=
a.height;var b=a.mask;var h=a.pixel;var l=a.bpp;var r=a.cache_idx;if(f){cb.set(r,new Ib(r,null,0,0,0,0,0,0,0));return}var m=ze(g,c,b,h,l,e);var k=new Ib(r,m,e,d,g,c,l,h.length,b.length);k.init();cb.set(r,k)}function Dc(a){if(A.isPaused())return;var f=cb.get(a);if(f)B.setCursor(f);else svGlobal.logger.warn("invalid cursor"+a)}function yc(){B.setCursor({"system":"none","none":false,"result":"none"})}function uc(a){var f=0;var e=null;var d=null;var g=null;var c=0;a.skipPosition(2);f=a.getLittleEndian16();
a.skipPosition(2);e=new Array(f);d=new Array(f);g=new Array(f);var b=a.getBytes(f*3);for(var h=0;h<f;h++){e[h]=b[c];d[h]=b[c+1];g[h]=b[c+2];c+=3}if(f!=256)return;Ae(8,f,e,d,g)}function Ae(a,f,e,d,g){if(!Z.paletteRdp)Z.paletteRdp=new Array(3);Z.paletteRdp[0]=e;Z.paletteRdp[1]=d;Z.paletteRdp[2]=g}function sc(a,f){var e=0;var d=0;for(var g=0;e<f;){d=a.getByte();g=d&3;switch(g){case 1:Be(a,d);break;case 2:Ce(a,d);break;case 3:De(a);if(Ta)Ta.on=false;break;default:Ca()}e++}if(Ta)Ta.verify(A.getDirtyArea())}
function Ee(a,f,e){var d=0;var g=0;if((f&64)!=0)e--;if((f&128)!=0)if(e<2)e=0;else e-=2;for(var c=0;c<e;c++){g=a.getByte();d|=g<<c*8}return d}function Be(a,f){var e=0;var d=0;var g=false;if((f&8)!=0)Z.orderType=a.getByte();d=Fe[Z.orderType];e=Ee(a,f,d);if((f&4)!=0){if((f&32)==0)Ge(a,Z.bounds);He(Z.bounds)}g=(f&16)!=0;if(Ta&&Z.orderType!=13)Ta.on=false;switch(Z.orderType){case 0:Ie(a,Z.destBlt,e,g);break;case 1:Je(a,Z.patBlt,e,g);break;case 2:Ke(a,Z.screenBlt,e,g);break;case 9:Le(a,Z.line,e,g);break;
case 10:Me(a,Z.rectangle,e,g);break;case 11:Ne(a,Z.deskSave,e,g);break;case 13:Oe(a,Z.memBlt,e,g);break;case 22:Pe(a,Z.polyLine,e,g);break;case 27:Qe(a,Z.text2,e,g);break;default:svGlobal.logger.warn("XXX Order type "+Z.orderType);Ca()}if((f&4)!=0)$b()}function Ce(a,f){var e=f>>2;switch(e){case 11:Re(a);break;case 13:Se(a);break;default:svGlobal.logger.warn("Alt Sec order:"+e);Ca()}}function Se(a){var f=a.getLittleEndian32()}function Re(a){var f=a.getLittleEndian16();var e=a.getLittleEndian32();var d=
a.getPosition()+(f-7);if((e&16777216)!=0)Te(e,a);else if((e&33554432)!=0)svGlobal.logger.info("XXX Alt Sec window Notify="+e);else if((e&67108864)!=0)Ue(e,a);else{svGlobal.logger.info("XXX Alt Sec window order flgas="+e);Ca()}a.setPosition(d)}function Te(a,f){var e=f.getLittleEndian32();if((a&1073741824)!=0)Ve(e,f);else if((a&2147483648)!=0)svGlobal.logger.info("XXX rail cache icon, winId="+e);else if((a&536870912)!=0)We(e);else Xe(f,a,e)}function Ve(a,f){svGlobal.logger.info("XXX rail icon, winId="+
a)}function Ye(a){this.id=a;this.appId="";var f=this;this.resizable=function(){return(f.style&262144)!=0||(f.style&65536)!=0||(f.style&16777216)!=0||f.showState==3};this.setShowState=function(a){f.showState=a};this.parent=function(){return B.getWinById(f.ownerWinid)};this.resize=function(a,d,g,c){if(N.disableJoinedAppResize&&n.mode==2)return;J("8C1"+f.id+"\t"+a+"\t"+d+"\t"+g+"\t"+c)};this.exeCommand=function(f){J("8C4"+a+"\t"+f)};this.activate=function(f){J("8C3"+a+"\t"+f)};this.close=function(){f.exeCommand(61536)};
this.getAppId=function(){J("8C0"+a)};this.isVisible=function(){return f.winWidth&&f.winHeight&&f.showState&&f.winHeight>45&&f.winWidth>45};this.getAppId()}function Ue(a,f){svGlobal.logger.info("*** -- Alt Sec window Desktop="+a);if((a&1)!=0){svGlobal.logger.info("Desktop non monitored flags="+a);return}if((a&32)!=0){var e=f.getLittleEndian32();svGlobal.logger.info("Desktop monitored flags="+a+" winId="+e);B.setTitle(e);if(!A.getContext()){var d=B.getFocused();if(d)A.setContext(d.context)}}else return;
if((a&16)!=0){var g=f.getByte();if(g>0){var c=B.zOrders;c.length=g;for(var b=0;b<g;b++){c[b]=f.getLittleEndian32();svGlobal.logger.info("---zorders:"+c[b])}}}}function We(a){svGlobal.logger.info("***** delete winId="+a);B.delWin(a)}function Xe(a,f,e){if(!da)da=true;var d=(f&268435456)==0;svGlobal.logger.info("\n\n=========== winId="+e+" existed="+d);var g=B.getWinById(e);if(g)d=true;else g=new Ye(e);if(!g){svGlobal.logger.warn("XXX, No win with id:"+e);return}if((f&2)!=0){g["ownerWinid"]=a.getLittleEndian32();
svGlobal.logger.info("***** ownerWinid="+g["ownerWinid"])}var c=false;if((f&8)!=0){c=true;g["style"]=a.getLittleEndian32();g["extStyle"]=a.getLittleEndian32();svGlobal.logger.info("***** winId="+e+" style="+g["style"]+" extStyle="+g["extStyle"]);svGlobal.logger.info("*****--- WS_POPUP="+((g["style"]&2147483648)!=0));svGlobal.logger.info("*****--- WS_DLGFRAME="+((g["style"]&4194304)!=0));svGlobal.logger.info("*****--- DS_MODALFRAME="+((g["style"]&128)!=0));svGlobal.logger.info("*****--- WS_EX_DLGMODALFRAME="+
((g["extStyle"]&1)!=0));svGlobal.logger.info("*****--- WS_EX_TOOLWINDOW="+((g["extStyle"]&128)!=0));svGlobal.logger.info("*****--- WS_BORDER="+((g["style"]&8388608)!=0));svGlobal.logger.info("*****--- WS_CAPTION="+((g["style"]&12582912)!=0));svGlobal.logger.info("*****--- WS_OVERLAPPED="+((g["style"]&0)!=0));svGlobal.logger.info("*****--- WS_OVERLAPPEDWINDOW="+((g["style"]&13565952)!=0));svGlobal.logger.info("*****--- WS_POPUPWINDOW="+((g["style"]&2156396544)!=0));svGlobal.logger.info("*****--- WS_SIZEBOX="+
((g["style"]&262144)!=0));svGlobal.logger.info("*****--- WS_CHILD="+((g["style"]&1073741824)!=0));svGlobal.logger.info("*****--- WS_SIZEBOX="+((g["style"]&262144)!=0));svGlobal.logger.info("*****--- WS_EX_MDICHILD="+((g["extStyle"]&64)!=0));svGlobal.logger.info("*****--- WS_EX_LAYERED="+((g["extStyle"]&524288)!=0))}if((f&16)!=0){g.setShowState(a.getByte());svGlobal.logger.info("***** winId="+e+" showState="+g["showState"]);var b=g["showState"];if(b==2)if(N.noMinimize!=false)setTimeout(function(){g.exeCommand(61728)},
50)}var h=(f&4)!=0;if(h){var l=a.getLittleEndian16();g["titleInfo"]=a.getUnicodeString(l,false);svGlobal.logger.info("***** winId="+e+" title="+g["titleInfo"])}if((f&16384)!=0){g["clientOffsetX"]=a.getLittleEndian32();g["clientOffsetY"]=a.getLittleEndian32();svGlobal.logger.info("***** winId="+e+" coffX"+g["clientOffsetX"]+" coffY="+g["clientOffsetY"])}if((f&65536)!=0){g["clientAreaWidth"]=a.getLittleEndian32();g["clientAreaHeight"]=a.getLittleEndian32();svGlobal.logger.info("***** winId="+e+" cw"+
g["clientAreaWidth"]+" ch="+g["clientAreaHeight"])}if((f&131072)!=0)g["rpContent"]=a.getLittleEndian32();if((f&262144)!=0)g["rootParentHandle"]=a.getLittleEndian32();if((f&2048)!=0){var r=a.getLittleEndian32();var m=a.getLittleEndian32();g["winOffsetX"]=r;g["winOffsetY"]=m;svGlobal.logger.info("***** winId="+e+" offX"+g["winOffsetX"]+" offY="+g["winOffsetY"])}if((f&32768)!=0){g["winClientDeltaX"]=a.getLittleEndian32();g["winClientDeltaY"]=a.getLittleEndian32();svGlobal.logger.info("***** winId="+
e+" dX"+g["winClientDeltaX"]+" dY="+g["winClientDeltaY"])}if((f&1024)!=0){g["winWidth"]=a.getLittleEndian32();g["winHeight"]=a.getLittleEndian32();svGlobal.logger.info("***** winId="+e+" w"+g["winWidth"]+" h="+g["winHeight"])}if((f&256)!=0){var k=a.getLittleEndian16();if(k>0)a.skipPosition(k*8)}if((f&4096)!=0){g["visibleOffsetX"]=a.getLittleEndian32();g["visibleOffsetY"]=a.getLittleEndian32()}if((f&512)!=0){var q=a.getLittleEndian16();g["numVisibilityRects"]=q;if(q>0)a.skipPosition(q*8)}if(!d)B.addWin(g);
else B.onWinChange(g);if(h)B.setTitle(e)}function De(a){var f;var e;var d;var g;f=a.getLittleEndian16();d=a.getLittleEndian16();e=a.getByte();g=a.getPosition()+f+7;if(!a.has(f+7)){Ca();return}switch(e){case 0:Ze(a);break;case 1:svGlobal.logger.info("TODO: color cache");break;case 2:$e(a,d);break;case 3:af(a);break;case 4:Gc(a,d,false);break;case 5:Gc(a,d,true);break;case 7:svGlobal.logger.info("CacheBrush...=");break;case 8:bf(a,d);break;default:svGlobal.logger.warn("invalid second Order, type="+
e);Ca()}a.setPosition(g)}function bf(a,f){var e=f&7;f=(f&65408)>>7;var d=a.getLittleEndian16();a.skipPosition(8);var g=a.getByte();a.skipPosition(2);var c=a.getByte();var b=a.getLittleEndian16();var h=a.getLittleEndian16();var l=a.getLittleEndian32();var r=null;if(c==1){Hb(a,g,b,h,Wa);var m=Wa.getData();var k=Wa.getDataSize();r=new Uint32Array(k);wb(m,0,r,b,h,1);Fa.putBitmap(e,d,new Ua(r,b,h,0,0,32))}else if(c==0){var q=Ab(a.getData(),l,a.getPosition());r=new Uint32Array(q.length);wb(q,0,r,b,h,1);
Fa.putBitmap(e,d,new Ua(r,b,h,0,0,32))}else svGlobal.logger.warn("XXX invalid codec id:"+c);a.skipPosition(l)}function Ze(a){var f=a.getByte();a.skipPosition(1);var e=a.getByte();var d=a.getByte();var g=a.getByte();var c=Math.floor((g+7)/8);var b=a.getLittleEndian16();var h=a.getLittleEndian16();var l=a.getPosition();a.skipPosition(b);var r=new Array(e*d*c);r[0]=0;var m=0;var k=e*c;for(var q=0;q<d;q++){m=l+(d-q-1)*k;a.copyToByteArray(r,q*k,m,k)}Fa.putBitmap(f,h,new Ua(Jb(r,c),e,d,0,0,c*8))}function $e(a,
f){var e=a.getByte();var d=a.getByte();var g=a.getByte();var c=a.getByte();var b=a.getByte();var h=Math.floor((b+7)/8);var l=a.getLittleEndian16();var r=a.getLittleEndian16();var m=0;if((f&1024)!=0)m=l;else{a.skipPosition(2);m=a.getLittleEndian16();a.skipPosition(2);a.skipPosition(2)}var k;if(h!=1)k=$a(g,c,m,a.getData(),a.getPosition());else k=Kb(g,c,m,a.getData(),a.getPosition());a.skipPosition(m);Fa.putBitmap(e,r,new Ua(k,g,c,0,0,b))}function Gc(a,f,e){var d;var g;var c;var b;var h;var l;var r;
var m=0;c=f&7;l=((f&120)>>3)-2;f=(f&65408)>>7;if((f&2)!=0)a.skipPosition(8);if((f&1)!=0){b=ob.readVar2Bytes(a);h=b}else{b=ob.readVar2Bytes(a);h=ob.readVar2Bytes(a)}m=ob.readVar4Bytes(a);r=ob.readVar2Bytes(a);var k=e&&(f&8)==0;if(k)a.skipPosition(8);if(e){var q;if(l!=1)q=$a(b,h,m,a.getData(),a.getPosition());else q=Kb(b,h,m,a.getData(),a.getPosition());a.skipPosition(m);if(!q){svGlobal.logger.warn("Failed to decompress bitmap data");return}d=new Ua(q,b,h,0,0,l*8)}else{var p=new Array(b*h*l);p[0]=0;
var t=a.getPosition();var n=0;var y=b*l;for(g=0;g<h;g++){n=t+(h-g-1)*y;a.copyToByteArray(p,g*y,n,y)}d=new Ua(Jb(p,l),b,h,0,0,l*8)}Fa.putBitmap(c,r,d);if((f&2)!=0)svGlobal.logger.warn("XXX:TODO, persistent")}function af(a){var f=null;var e=0;var d=0;var g=0;var c=0;var b=0;var h=0;var l=0;var r=0;e=a.getByte();d=a.getByte();for(var m=0;m<d;m++){g=a.getLittleEndian16();c=a.getLittleEndian16();b=a.getLittleEndian16();h=a.getLittleEndian16();l=a.getLittleEndian16();r=l*Math.floor((h+7)/8)+3&~3;f=new Wb(c,
b,h,l,a.getBytes(r));Va.putFont(e,g,f)}}function O(a,f,e){var d=0;if(e){d=a.getByte()<<24>>24;f+=d;return f}else{f=a.getLittleEndian16()<<16>>16;return f}}function Ge(a,f){var e=a.getByte();if((e&1)!=0)f.left=O(a,f.left,false);else if((e&16)!=0)f.left=O(a,f.left,true);if((e&2)!=0)f.top=O(a,f.top,false);else if((e&32)!=0)f.top=O(a,f.top,true);if((e&4)!=0)f.right=O(a,f.right,false);else if((e&64)!=0)f.right=O(a,f.right,true);if((e&8)!=0)f.bottom=O(a,f.bottom,false);else if((e&128)!=0)f.bottom=O(a,f.bottom,
true)}function Je(a,f,e,d){if((e&1)!=0)f.x=O(a,f.x,d);if((e&2)!=0)f.y=O(a,f.y,d);if((e&4)!=0)f.cx=O(a,f.cx,d);if((e&8)!=0)f.cy=O(a,f.cy,d);if((e&16)!=0){f.opcode=a.getByte();f.opcode=f.opcode&3|(f.opcode&48)>>2}if((e&32)!=0)f.backgroundColor=Xa(a);if((e&64)!=0)f.foregroundColor=Xa(a);cf(a,f.brush,e>>7);var g=f.x;var c=f.y;if(g>T||c>W)return;var b=f.cx;var h=f.cy;var l=f.opcode;var r=f.backgroundColor;var m=f.foregroundColor;var k=f.brush.xOrigin;var q=f.brush.yOrigin;var p=f.brush.style;var t=f.brush.pattern;
df(l,g,c,b,h,m,r,k,q,p,t)}function Ie(a,f,e,d){if((e&1)!=0)f.x=O(a,f.x,d);if((e&2)!=0)f.y=O(a,f.y,d);if((e&4)!=0)f.cx=O(a,f.cx,d);if((e&8)!=0)f.cy=O(a,f.cy,d);if((e&16)!=0)f.opcode=a.getByte()&15;var g=f.x;var c=f.y;var b=f.cx;var h=f.cy;var l=f.opcode;if(g>M||c>Y)return;var r=g+b-1;if(r>T)r=T;if(g<V)g=V;b=r-g+1;var m=c+h-1;if(m>W)m=W;if(c<X)c=X;h=m-c+1;if(b<1||h<1)return;pb(l,A,M,g,c,b,h,null,0,0,0);A.postPaint(g,c,b,h)}function Ke(a,f,e,d){if((e&1)!=0)f.x=O(a,f.x,d);if((e&2)!=0)f.y=O(a,f.y,d);if((e&
4)!=0)f.cx=O(a,f.cx,d);if((e&8)!=0)f.cy=O(a,f.cy,d);if((e&16)!=0)f.opcode=a.getByte()&15;if((e&32)!=0)f.srcX=O(a,f.srcX,d);if((e&64)!=0)f.srcY=O(a,f.srcY,d);var g=f.x;var c=f.y;if(g>T||c>W)return;var b=f.cx;var h=f.cy;var l=f.opcode;var r=f.srcX;var m=f.srcY;var k=g+b-1;if(k>T)k=T;if(g<V)g=V;b=k-g+1;var q=c+h-1;if(q>W)q=W;if(c<X)c=X;h=q-c+1;r+=g-f.x;m+=c-f.y;if(b<1||h<1)return;if(l==12)A.moveArea(r,m,b,h,g-r,c-m);else pb(l,A,b,g,c,b,h,null,b,r,m);A.postPaint(g,c,b,h)}function Xa(a){var f=0;var e=
0;e=a.getByte();f=e;e=a.getByte();f|=e<<8;e=a.getByte();f|=e<<16;return f}function ef(a,f,e){if((e&1)!=0)f.style=a.getByte();if((e&2)!=0)f.width=a.getByte();if((e&4)!=0)f.color=Xa(a);return true}function Le(a,f,e,d){if((e&1)!=0)f.mixmode=a.getLittleEndian16();if((e&2)!=0)f.startX=O(a,f.startX,d);if((e&4)!=0)f.startY=O(a,f.startY,d);if((e&8)!=0)f.endX=O(a,f.endX,d);if((e&16)!=0)f.endY=O(a,f.endY,d);if((e&32)!=0)f.backgroundColor=Xa(a);if((e&64)!=0)f.opcode=a.getByte();ef(a,f.pen,e>>7);var g=f.startX;
var c=f.startY;var b=f.endX;var h=f.endY;var l=f.pen.color;var r=f.opcode-1;if(c==h){if(g>b){var m=g;g=b;b=m}if(g<V)g=V;if(b>T)b=T}else if(g==b){if(c>h){m=c;c=h;h=m}if(c<X)c=X;if(c>W)c=W}Hc(g,c,b,h,l,r)}function Me(a,f,e,d){if((e&1)!=0)f.x=O(a,f.x,d);if((e&2)!=0)f.y=O(a,f.y,d);if((e&4)!=0)f.cx=O(a,f.cx,d);if((e&8)!=0)f.cy=O(a,f.cy,d);if((e&16)!=0)Ea=Ea&4294967040|a.getByte();if((e&32)!=0)Ea=Ea&4294902015|a.getByte()<<8;if((e&64)!=0)Ea=Ea&4278255615|a.getByte()<<16;f.color=Ea;Lb(f.x,f.y,f.cx,f.cy,
f.color,true)}function Ne(a,f,e,d){if((e&1)!=0)f.offset=a.getLittleEndian32();if((e&2)!=0)f.left=O(a,f.left,d);if((e&4)!=0)f.top=O(a,f.top,d);if((e&8)!=0)f.right=O(a,f.right,d);if((e&16)!=0)f.bottom=O(a,f.bottom,d);if((e&32)!=0)f.action=a.getByte();ff(f)}function Oe(a,f,e,d){if((e&1)!=0){f.cacheID=a.getByte();f.colorTable=a.getByte()}if((e&2)!=0)f.x=O(a,f.x,d);if((e&4)!=0)f.y=O(a,f.y,d);if((e&8)!=0)f.cx=O(a,f.cx,d);if((e&16)!=0)f.cy=O(a,f.cy,d);if((e&32)!=0)f.opcode=a.getByte()&15;if((e&64)!=0)f.srcX=
O(a,f.srcX,d);if((e&128)!=0)f.srcY=O(a,f.srcY,d);if((e&256)!=0)f.cacheIDX=a.getLittleEndian16();if(Ta&&Ta.on)return;var g=f.x;var c=f.y;if(g>T||c>W)return;var b=f.cx;var h=f.cy;var l=f.srcX;var r=f.srcY;var m=g+b-1;if(m>T)m=T;if(g<V)g=V;b=m-g+1;var k=c+h-1;if(k>W)k=W;if(c<X)c=X;h=k-c+1;l+=g-f.x;r+=c-f.y;var q=Fa.getBitmap(f.cacheID,f.cacheIDX);if(!q){svGlobal.logger.warn("Failed to get bitmap from cache, id:"+f.cacheID+" idx="+f.cacheIDX);return}var p=q.width;var t=q.height;if(b>p)b=p;if(h>t)h=t;
if(f.opcode==12){A.setRGBs(g,c,b,h,q.data,r*p+l,p);A.postPaint(g,c,b,h)}else{pb(f.opcode,A,M,g,c,b,h,q.data,p,l,r);A.postPaint(g,c,b,h)}}function cf(a,f,e){if((e&1)!=0)f.xOrigin=a.getByte();if((e&2)!=0)f.yOrigin=a.getByte();if((e&4)!=0)f.style=a.getByte();var d=f.pattern;if((e&8)!=0)d[0]=a.getByte();if((e&16)!=0)for(var g=1;g<8;g++)d[g]=a.getByte();f.pattern=d}function Pe(a,f,e,d){if((e&1)!=0)f.x=O(a,f.x,d);if((e&2)!=0)f.y=O(a,f.y,d);if((e&4)!=0)f.opcode=a.getByte();if((e&16)!=0)f.foregroundColor=
Xa(a);if((e&32)!=0)f.lines=a.getByte();if((e&64)!=0){var g=a.getByte();f.dataSize=g;f.data=a.getBytes(g)}gf(f)}function Qe(a,f,e,d){if((e&1)!=0)f.font=a.getByte();if((e&2)!=0)f.flags=a.getByte();if((e&4)!=0)f.opcode=a.getByte();if((e&8)!=0)f.mixmode=a.getByte();if((e&16)!=0)f.foregroundColor=Xa(a);if((e&32)!=0)f.backgroundColor=Xa(a);if((e&64)!=0)f.clipLeft=a.getLittleEndian16();if((e&128)!=0)f.clipTop=a.getLittleEndian16();if((e&256)!=0)f.clipRight=a.getLittleEndian16();if((e&512)!=0)f.clipBottom=
a.getLittleEndian16();if((e&1024)!=0)f.boxLeft=a.getLittleEndian16();if((e&2048)!=0)f.boxTop=a.getLittleEndian16();if((e&4096)!=0)f.boxRight=a.getLittleEndian16();if((e&8192)!=0)f.boxBottom=a.getLittleEndian16();if((e&16384)!=0)a.skipPosition(1);if((e&32768)!=0)a.skipPosition(1);if((e&65536)!=0)a.skipPosition(1);if((e&131072)!=0)a.skipPosition(1);if((e&262144)!=0)a.skipPosition(7);if((e&524288)!=0)f.x=a.getLittleEndian16();if((e&1048576)!=0)f.y=a.getLittleEndian16();if((e&2097152)!=0){var g=a.getByte();
f.length=g;f.text=a.getBytes(g)}var c=f.font;var b=f.flags;var h=f.mixmode;var l=f.foregroundColor;var r=f.backgroundColor;var m=f.clipLeft;var k=f.clipTop;var q=f.clipRight;var p=f.clipBottom;var t=f.boxLeft;var n=f.boxTop;var y=f.boxRight;var u=f.boxBottom;var E=f.x;var x=f.y;var z=f.length;var C=f.text;var D=q-m;var B=p-k;var w=y-t;var F=u-n;var v=null;var H=0;var ca=0;if(t+w>M)w=M-t;if(w>1)Lb(t,n,w,F,r,false);else if(h==1)Lb(m,k,D,B,r,false);var I=z;for(var la=0;la<z;)switch(C[ca+la]){case 255:var N=
C[ca+la+2];if(N>I-ca){la=z=0;break}var La=C.slice?C.slice(ca,ca+N):C.subarray(ca,ca+N);nc(C[ca+la+1],La);la+=3;z-=la;ca=la;la=0;break;case 254:var va=hf(C[ca+la+1]);if(va)if(va[1]==0&&(b&32)==0)if((b&4)!=0)x+=C[ca+la+2];else E+=C[ca+la+2];if(la+2<z)la+=3;else la+=2;z-=la;ca=la;la=0;if(!va)break;var Ma=va.length;for(var Aa=0;Aa<Ma;Aa++){v=Va.getFont(c,va[Aa]);if((b&32)==0){H=va[++Aa];if((H&128)!=0)if((b&4)!=0){x+=va[Aa+1]|va[Aa+2]<<8;Aa+=2}else{E+=va[Aa+1]|va[Aa+2]<<8;Aa+=2}else if((b&4)!=0)x+=H;else E+=
H}if(v){Ic(h,E+v.offset&65535,x+v.baseLine&65535,v.width,v.height,v.fontData,r,l,ab,Ia);if((b&32)!=0)E+=v.width}}break;default:v=Va.getFont(c,C[ca+la]);if((b&32)==0){H=C[ca+ ++la];if((H&128)!=0)if((b&4)!=0){x+=C[ca+la+1]|C[ca+la+2]<<8;la+=2}else{E+=C[ca+la+1]|C[ca+la+2]<<8;la+=2}else if((b&4)!=0)x+=H;else E+=H}if(v){Ic(h,E+v.offset&65535,x+v.baseLine&65535,v.width,v.height,v.fontData,r,l,ab,Ia);if((b&32)!=0)E+=v.width}la++}if(w>1){if(F>0)A.postPaint(t,n,w,F)}else if(D>0&&B>0)A.postPaint(m,k,D,B)}
function tc(a){var f=0;var e=0;var d=0;var g=0;var c=0;var b=0;var h=0;var l=0;var r=0;var m=0;var k=0;var n=0;var p=a.getLittleEndian16();for(var t=0;t<p;t++){if(!a.has(18)){Ca();return}f=a.getLittleEndian16();e=a.getLittleEndian16();d=a.getLittleEndian16();g=a.getLittleEndian16();c=a.getLittleEndian16();b=a.getLittleEndian16();r=a.getLittleEndian16();m=a.getLittleEndian16();k=a.getLittleEndian16();if(!a.has(k)){Ca();return}h=d-f+1;l=g-e+1;if(Ia!=r){svGlobal.logger.warn("Server limited colour depth to "+
r+" bits");if(!Mb)ib(r);else if(Mb>1){Ca();return}Mb++}if(m==0){var u=c*ab;var y=b*u;var A=new Uint8Array(y);var E=a.getPosition();for(var x=0;x<b;x++){Na(a.getData(),E,A,(b-x-1)*u,u);E+=u}a.skipPosition(y);Jc(A,f,e,c,b,h,l,ab);continue}if((m&1024)!=0)n=k;else{a.skipPosition(2);n=a.getLittleEndian16();a.skipPosition(4)}jf(a.getData(),n,a.getPosition(),c,b,f,e,h,l,ab);a.skipPosition(n)}}function Hd(a){var f=JSON.parse(a);if(n.onnotify)n.onnotify(f);if(!f.name){if(svGlobal.log>0)console.erro("No error code for message:"+
a);return}svGlobal.logger.info("msg="+a);if(f.type&&n.onerror)n.onerror(f);var e=__svi18n.errorCode["S"+f.name]||"";e+=f.message;n.showMessage(e,null);Ka=true}function Id(a){B.drawLicense(a)}function Af(a){var f=a.split("\t");var e=parseInt(f[0],10);var d=parseInt(f[1],10);kf(e,d,false)}function kf(a,f,e){}function He(a){V=a.left;if(V<0)V=0;X=a.top;if(X<0)X=0;T=a.right;if(T>=M)T=M-1;W=a.bottom;if(W>=Y)W=Y-1}function $b(){V=0;T=M-1;X=0;W=Y-1}function lf(a,f,e,d,g,c){var b;var h;if(f==d)if(e>a){h=e-
a;if(h<1)return;for(b=0;b<h;b++)qb(c,A,a+b,f,g);A.postPaint(a,f,h+1,1)}else{h=a-e;if(h<1)return;for(b=0;b<h;b++)qb(c,A,e+b,f,g);A.postPaint(e,f,h+1,1)}else if(d>f){h=d-f;if(h<1)return;for(b=0;b<h;b++)qb(c,A,a,f+b,g);A.postPaint(a,f,1,h+1)}else{h=f-d;if(h<1)return;for(b=0;b<h;b++)qb(c,A,a,d+b,g);A.postPaint(a,d,1,h+1)}}function Hc(a,f,e,d,g,c){var b=Math.min(a,e);var h=Math.max(a,e);var l=Math.min(f,d);var r=Math.max(f,d);g=ta(g);var m=b>=V&&h<=T&&l>=X&&r<=W;if(!m){if(b>T||h<V||l>W||r<X)return;var k=
0;if(a==e){if(f>d){k=f;f=d;d=k}if(f<X)f=X;if(d>W)d=W}else if(f==d){if(a>e){k=a;a=e;e=k}if(a<V)a=V;if(e>T)e=T}else{var n=Z._line;n.set(a,f,e,d);var p=n.intersection(V,X,T,X);var t=[];if(p)t.push(p.x,p.y);p=n.intersection(T,X,T,W);if(p)t.push(p.x,p.y);p=n.intersection(V,W,T,W);if(p)t.push(p.x,p.y);p=n.intersection(V,X,V,W);if(p)t.push(p.x,p.y);if(t.length==2)if(a>=V&&a<=T&&f>=X&&f<=W)t.push(a,f);else if(e>=V&&e<=T&&d>=X&&d<=W)t.push(e,d);if(t.length!=4)return;a=t[0];f=t[1];e=t[2];d=t[3]}}if(c==12)A.drawLine(a,
f,e,d,g);else if(a==e||f==d)lf(a,f,e,d,g,c);else{var u=Math.abs(e-a);var y=Math.abs(d-f);var B=a;var E=f;var x;var z;var C;var D;var w;var I;var F;var v;if(e>=a){x=1;z=1}else{x=-1;z=-1}if(d>=f){C=1;D=1}else{C=-1;D=-1}if(u>=y){x=0;D=0;I=u;w=u/2>>0;F=y;v=u}else{z=0;C=0;I=y;w=y/2>>0;F=u;v=y}if(v<1)return;for(var H=0;H<=v;H++){qb(c,A,B,E,g);w+=F;if(w>=I){w-=I;B+=x;E+=C}B+=z;E+=D}}b=Math.min(a,e);h=Math.max(a,e);l=Math.min(f,d);r=Math.max(f,d);if(h-b<0)return;if(r-l<0)return;A.postPaint(b,l,h-b+1,r-l+
1)}function ff(a){var f=a.right-a.left+1;var e=a.bottom-a.top+1;if(a.action==0)mf(a.offset,a.left,a.top,f,e);else nf(a.offset,f,e,a.left,a.top)}function mf(a,f,e,d,g){if(d<1||g<1)return;nb.save(f,e,d,g,a,A.getRGBs(f,e,d,g))}function nf(a,f,e,d,g){var c=nb.restore(d,g,f,e,a);if(!c){svGlobal.logger.warn("XXX no matched desktop save.");return}A.setRGBs(d,g,f,e,c,0,f);A.postPaint(d,g,f,e)}function gf(a){var f=a.x;var e=a.y;var d=a.foregroundColor;var g=a.lines;var c=a.dataSize;var b=a.data;var h=new Array(1);
h[0]=Math.floor((g-1)/4)+1;var l=0;var n=0;var m=a.opcode-1;for(var k=0;k<g&&h[0]<c;k++){var q=f;var p=e;if(k%4==0)l=b[n++];if((l&192)==0)l|=192;if((l&64)!=0)f+=Kc(b,h);if((l&128)!=0)e+=Kc(b,h);Hc(q,p,f,e,d,m);l<<=2}}function Ic(a,f,e,d,g,c,b,h,l,n){var m=128;h=ta(h);b=ta(b);if(f>T||e>W)return;var k=f+d-1;if(k>T)k=T;var q=f<V?V:f;var p=k-f+1;var t=e+g-1;if(t>W)t=W;var u=e<X?X:e;var y=t-e+1;if(p<1||y<1)return;var B=u!=e||p!=d||y!=g||q!=f;var E=0;var x=0;var z=A.setRGB;if(!B)if(a==0)for(var C=0;C<g;C++){E=
e+C;for(var D=0;D<d;D++){if(m==0){x++;m=128}if((c[x]&m)!=0)z(f+D,E,h);m>>=1}x++;m=128;if(x==c.length)x=0}else for(C=0;C<g;C++){E=e+C;for(D=0;D<d;D++){if(m==0){x++;m=128}if((c[x]&m)!=0)z(f+D,E,h);else z(f+D,E,b);m>>=1}x++;m=128;if(x==c.length)x=0}else if(a==0)for(C=0;C<y;C++){E=e+C;for(D=0;D<p;D++){if(m==0){x++;m=128}if(f+D>=q&&E>=u)if((c[x]&m)!=0)z(f+D,E,h);m>>=1}x++;m=128;if(x==c.length)x=0}else for(C=0;C<y;C++){E=e+C;for(D=0;D<p;D++){if(m==0){x++;m=128}if(f+D>=q&&e+C>=u)if((c[x]&m)!=0)z(f+D,E,h);
else z(f+D,E,b);m>>=1}x++;m=128;if(x==c.length)x=0}}function df(a,f,e,d,g,c,b,h,l,n,m){c=ta(c);b=ta(b);var k=f+d-1;if(k>T)k=T;if(f<V)f=V;d=k-f+1;var q=e+g-1;if(q>W)q=W;if(e<X)e=X;g=q-e+1;if(d<1||g<1)return;var p=null;switch(n){case 0:p=new Uint32Array(d*g);for(var t=0;t<p.length;t++)p[t]=c;pb(a,A,M,f,e,d,g,p,d,0,0);A.postPaint(f,e,d,g);if(d==1)B.execute("setCaretPos",[f,e]);break;case 2:svGlobal.logger.warn("hatch");break;case 3:var u=m;p=new Uint32Array(d*g);var y=0;for(t=0;t<g;t++)for(var w=0;w<
d;w++){if((u[(t+l)%8]&1<<(w+h)%8)==0)p[y]=c;else p[y]=b;y++}pb(a,A,M,f,e,d,g,p,d,0,0);A.postPaint(f,e,d,g);break;default:svGlobal.logger.warn("Unsupported brush style "+n)}}function Kc(a,f){var e=a[f[0]++]&255;var d=e&128;if((e&64)!=0)e|=~63;else e&=63;if(d!=0)e=e<<8|a[f[0]++]&255;return e}function Lb(a,f,e,d,g,c){if(a>T||f>W)return;var b=a+e-1;if(b>T)b=T;if(a<V)a=V;e=b-a+1;var h=f+d-1;if(h>W)h=W;if(f<X)f=X;d=h-f+1;if(e<1||d<1)return;A.fillRect(a,f,e,d,ta(g));A.postPaint(a,f,e,d)}function Jc(a,f,
e,d,g,c,b,h,l){if(!l)l=0;var n=Jb(a,h);A.setRGBs(f,e,c,b,n,l,d);A.postPaint(f,e,c,b)}function jf(a,f,e,d,g,c,b,h,l,n){if(h*l*d*g<1)return;if(n!=1){A.setRGBs(c,b,h,l,$a(d,g,f,a,e),0,d);A.postPaint(c,b,h,l)}else Jc(Kb(d,g,f,a,e),c,b,d,g,h,l,n)}function zd(a){return hi5.Base64.dec(a,0)}function Ra(a){if(!n)return;svGlobal.logger.warn("closed "+(n.sessionInfo.appInfo?n.sessionInfo.appInfo.numericId:0));var f=dc();if(f&&n.sessionInfo.appInfo&&n.mode==0)sessionStorage[f]=n.sessionInfo.appInfo.session;if(n){var e=
n.mode==0;if(!ga&&e)Yb("connection");var d=e&&(ga||db<n.reconnectTimes)&&db>0&&!Ka;ga=false;xa=false;if(d){db--;n.showMessage(__svi18n.info.reconnecting+" "+(n.reconnectTimes-db)+"/"+n.reconnectTimes,null,3E3);setTimeout(ec,5);svGlobal.logger.info("Reconnecting..."+db);return}}if(Eb){svGlobal.logger.info("Req credential");return}Z=null;if(qa){qa.release();qa=null}nb=null;Fa=null;cb=null;Va=null;ra=null;if(typeof rdp8bulkData!="undefined")rdp8bulkData.release();w=null;Cc=null;Wa=null;Hb=null;Lc=null;
oa=null;if(ja){ja.close();ja=null}if(Pa)hi5.Arrays.release(Pa);if(Qa)hi5.Arrays.release(Qa);oc();if(ma){ma.close();ma=null}if(ha){ha.stop();ha=null}try{if(Ja!=null){Ja.exit();Ja=null}if(n.onclose)n.onclose(Ka);else svGlobal.logger.info("onclose: null");if(B){B.close();B=null}}catch(g){}ea=null;if(Q){Q.onopen=null;Q.onmessage=null;Q.onclose=null;Q.onerror=null;Q=null}Sa=null;vb=null;B=null;if(A){A.release();A=null}if(ua){ua.release();ua=null}n=null;if(!hi5.browser.isChromeApp)window.removeEventListener("unload",
Ra,false);else chrome.runtime.onSuspend.removeListener(Ra);if(window&&window.$rdp)window.$rdp=null}function xb(a,f,e,d,g,c,b){var h=g*e+d;var l=a.setRGB;var n=a.getRGB;for(var m=0;m<b;m++){for(var k=0;k<c;k++){if(a){var q=n(d+k,g+m);l(d+k,g+m,~q&S)}else f[h]=~f[h]&S;h++}h+=e-c}}function of(a,f,e,d,g,c){var b=a.setRGB;for(var h=e;h<e+g;h++)for(var l=d;l<d+c;l++)b(h,l,0)}function pf(a,f,e,d,g,c){var b=a.setRGB;for(var h=e;h<e+g;h++)for(var l=d;l<d+c;l++)b(h,l,S)}function Mc(a,f,e,d,g,c,b,h,l){if(!c)a.moveArea(h,
l,d,g,f-h,e-l);else a.setRGBs(f,e,d,g,c,l*b+h,b)}function pb(a,f,e,d,g,c,b,h,l,n,m){if(c<0|b<0|e<0|l<0)return;switch(a){case 0:of(f,e,d,g,c,b);break;case 1:qf(f,e,d,g,c,b,h,l,n,m);break;case 2:rf(f,e,d,g,c,b,h,l,n,m);break;case 3:xb(f,h,l,n,m,c,b);Mc(f,d,g,c,b,h,l,n,m);break;case 4:xb(f,null,e,d,g,c,b);Nc(f,e,d,g,c,b,h,l,n,m);break;case 5:xb(f,null,e,d,g,c,b);break;case 6:sf(f,e,d,g,c,b,h,l,n,m);break;case 7:tf(f,e,d,g,c,b,h,l,n,m);break;case 8:Nc(f,e,d,g,c,b,h,l,n,m);break;case 9:uf(f,e,d,g,c,b,
h,l,n,m);break;case 10:break;case 11:vf(f,e,d,g,c,b,h,l,n,m);break;case 12:Mc(f,d,g,c,b,h,l,n,m);break;case 13:xb(f,null,e,d,g,c,b);Oc(f,e,d,g,c,b,h,l,n,m);break;case 14:Oc(f,e,d,g,c,b,h,l,n,m);break;case 15:pf(f,e,d,g,c,b);break;default:svGlobal.logger.warn("unsupported opcode: "+a)}}function qb(a,f,e,d,g){if(!f)return;var c=f.getRGB(e,d);switch(a){case 0:f.setRGB(e,d,0);break;case 1:f.setRGB(e,d,~(c|g)&S);break;case 2:f.setRGB(e,d,c&(~g&S));break;case 3:f.setRGB(e,d,~g&S);break;case 4:f.setRGB(e,
d,(~c&g)*S);break;case 5:f.setRGB(e,d,~c&S);break;case 6:f.setRGB(e,d,c^g&S);break;case 7:f.setRGB(e,d,~c&g&S);break;case 8:f.setRGB(e,d,c&(g&S));break;case 9:f.setRGB(e,d,c^~g&S);break;case 10:break;case 11:f.setRGB(e,d,c|~g&S);break;case 12:f.setRGB(e,d,g);break;case 13:f.setRGB(e,d,(~c|g)&S);break;case 14:f.setRGB(e,d,c|g&S);break;case 15:f.setRGB(e,d,S);break;default:svGlobal.logger.warn("unsupported pixel opcode: "+a);f.setRGB(e,d,g)}}function qf(a,f,e,d,g,c,b,h,l,n){var m=n*h+l;var k=a.setRGB;
var q=a.getRGB;for(var p=0;p<c;p++){for(var t=0;t<g;t++)k(e+g,d+c,~(q(e+g,d+c)|b[m])&S);m+=h-g}}function rf(a,f,e,d,g,c,b,h,l,n){var m=n*h+l;var k=a.setRGB;var q=a.getRGB;for(var p=0;p<c;p++){for(var t=0;t<g;t++){var u=q(e+g,d+c);k(e+g,d+c,u&(~b[m]&S));m++}m+=h-g}}function sf(a,f,e,d,g,c,b,h,l,n){var m=n*h+l;var k=a.setRGB;var q=a.getRGB;for(var p=0;p<c;p++){for(var t=0;t<g;t++){var u=q(e+t,d+p);k(e+t,d+p,u^b[m]&S);m++}m+=h-g}}function tf(a,f,e,d,g,c,b,h,l,n){var m=n*h+l;var k=a.setRGB;var q=a.getRGB;
for(var p=0;p<c;p++){for(var t=0;t<g;t++){var u=q(e+t,d+p);k(e+t,d+p,~(u&b[m])&S);m++}m+=h-g}}function Nc(a,f,e,d,g,c,b,h,l,n){var m=n*h+l;var k=a.setRGB;var q=a.getRGB;for(var p=0;p<c;p++){for(var t=0;t<g;t++){var u=q(e+t,d+p);k(e+t,d+p,u&(b[m]&S));m++}m+=h-g}}function uf(a,f,e,d,g,c,b,h,l,n){var m=n*h+l;var k=a.setRGB;var q=a.getRGB;for(var p=0;p<c;p++){for(var t=0;t<g;t++){var u=q(e+t,d+p);k(e+t,d+p,u^~b[m]&S);m++}m+=h-g}}function vf(a,f,e,d,g,c,b,h,l,n){var m=n*h+l;var k=a.setRGB;var q=a.getRGB;
for(var p=0;p<c;p++){for(var t=0;t<g;t++){var u=q(e+t,d+p);k(e+t,d+p,u|~b[m]&S);m++}m+=h-g}}function Oc(a,f,e,d,g,c,b,h,l,n){var m=n*h+l;var k=a.setRGB;var q=a.getRGB;for(var p=0;p<c;p++){for(var t=0;t<g;t++){var u=q(e+t,d+p);k(e+t,d+p,u|b[m]&S);m++}m+=h-g}}function nc(a,f){var e=ra[a];if(e)e=null;ra[a]=f}function hf(a){var f=ra[a];if(f)return f;return null}function Fc(a,f,e,d){switch(f){case 16:wf(a,e,d);break;case 15:xf(a,e,d);break;case 8:e[d]=Z.paletteRdp[0][a];e[d+1]=Z.paletteRdp[1][a];e[d+2]=
Z.paletteRdp[2][a];e[d+3]=255;break;case 32:e[d]=a&255;e[d+1]=a>>8&255;e[d+2]=a>>16&255;e[d+3]=a>>24&255;default:e[d]=a&255;e[d+1]=a>>8&255;e[d+2]=a>>16&255;e[d+3]=255}}function xf(a,f,e){var d=a>>7&248;var g=a>>2&248;var c=a<<3&255;d|=d>>5;g|=g>>5;c|=c>>5;f[e]=d;f[e+1]=g;f[e+2]=c;f[e+3]=255}function wf(a,f,e){var d=a>>8&248;var g=a>>3&252;var c=a<<3&255;d|=d>>5;g|=g>>6;c|=c>>5;f[e]=d;f[e+1]=g;f[e+2]=c;f[e+3]=255}function Jb(a,f){var e=a.length/f>>0;var d=new Uint32Array(e);var g=ta;switch(f){case 1:for(var c=
0;c<e;c++)d[c]=g(a[c]);break;case 2:for(c=0;c<e;c++)d[c]=g(a[c*2+1]<<8|a[c*2]);break;default:for(c=0;c<e;c++)d[c]=g(a[c*f+2]<<16)|a[c*f+1]<<8|a[c*f]}return d}function Kb(a,f,e,d,g){var c=d;var b=-1;var h=0;var l=g;var n=0;var m=e+l;var k=0;var q=0;var p=0;var t=a;var u=-1;var y=0;var A=0;var B=0;var x=0;var z=0;var C=0;var D=4294967295;var w=false;var I=false;var F=false;var v=new Array(a*f);for(v[0]=0;l<m;){y=0;A=c[l++];k=A>>4;switch(k){case 12:case 13:case 14:k-=6;q=A&15;p=16;break;case 15:k=A&
15;if(k<9){q=c[l++];q|=c[l++]<<8}else q=k<11?8:1;p=0;break;default:k>>=1;q=A&31;p=32}if(p!=0){F=k==2||k==7;if(q==0)if(F)q=c[l++]+1;else q=c[l++]+p;else if(F)q<<=3}switch(k){case 0:if(u==k&&!(t==a&&b==-1))w=true;break;case 8:B=c[l++];case 3:x=c[l++];break;case 6:case 7:D=c[l++];k-=5;break;case 9:C=3;k=2;y=3;break;case 10:C=5;k=2;y=5}u=k;for(z=0;q>0;){if(t>=a){t=0;f--;b=h;h=n+f*a}switch(k){case 0:if(w){if(b==-1)v[h+t]=D;else v[h+t]=v[b+t]^D;w=false;q--;t++}if(b==-1){for(;(q&~7)!=0&&t+8<a;)for(var H=
0;H<8;H++){v[h+t]=0;q--;t++}for(;q>0&&t<a;){v[h+t]=0;q--;t++}}else{for(;(q&~7)!=0&&t+8<a;)for(H=0;H<8;H++){v[h+t]=v[b+t];q--;t++}for(;q>0&&t<a;){v[h+t]=v[b+t];q--;t++}}break;case 1:if(b==-1){for(;(q&~7)!=0&&t+8<a;)for(H=0;H<8;H++){v[h+t]=D;q--;t++}for(;q>0&&t<a;){v[h+t]=D;q--;t++}}else{for(;(q&~7)!=0&&t+8<a;)for(H=0;H<8;H++){v[h+t]=v[b+t]^D;q--;t++}for(;q>0&&t<a;){v[h+t]=v[b+t]^D;q--;t++}}break;case 2:if(b==-1){for(;(q&~7)!=0&&t+8<a;)for(H=0;H<8;H++){z<<=1;z=z&255;if(z==0){C=y!=0?y:c[l++];z=1}if((C&
z)!=0)v[h+t]=D;else v[h+t]=0;q--;t++}for(;q>0&&t<a;){z<<=1;z=z&255;if(z==0){C=y!=0?y:c[l++];z=1}if((C&z)!=0)v[h+t]=D;else v[h+t]=0;q--;t++}}else{for(;(q&~7)!=0&&t+8<a;)for(H=0;H<8;H++){z<<=1;z=z&255;if(z==0){C=y!=0?y:c[l++];z=1}if((C&z)!=0)v[h+t]=v[b+t]^D;else v[h+t]=v[b+t];q--;t++}for(;q>0&&t<a;){z<<=1;z=z&255;if(z==0){C=y!=0?y:c[l++];z=1}if((C&z)!=0)v[h+t]=v[b+t]^D;else v[h+t]=v[b+t];q--;t++}}break;case 3:for(;(q&~7)!=0&&t+8<a;)for(H=0;H<8;H++){v[h+t]=x;q--;t++}for(;q>0&&t<a;){v[h+t]=x;q--;t++}break;
case 4:for(;(q&~7)!=0&&t+8<a;)for(H=0;H<8;H++){v[h+t]=c[l++];q--;t++}for(;q>0&&t<a;){v[h+t]=c[l++];q--;t++}break;case 8:for(;(q&~7)!=0&&t+8<a;)for(H=0;H<8;H++){if(I){v[h+t]=x;I=false}else{v[h+t]=B;I=true;q++}q--;t++}for(;q>0&&t<a;){if(I){v[h+t]=x;I=false}else{v[h+t]=B;I=true;q++}q--;t++}break;case 13:for(;(q&~7)!=0&&t+8<a;)for(H=0;H<8;H++){v[h+t]=255;q--;t++}for(;q>0&&t<a;){v[h+t]=255;q--;t++}break;case 14:for(;(q&~7)!=0&&t+8<a;)for(H=0;H<8;H++){v[h+t]=0;q--;t++}for(;q>0&&t<a;){v[h+t]=0;q--;t++}break;
default:q--;t++}}}return v}this.reconnectOnResize=true;this.displayMsg=true;this.appTimeout=1600;this.reconnectTimes=0;this.windowState=3;this.openLink=true;this.setTitle=true;this.audioBuffer=0;this.sessionInfo={domain:"",userName:"",sessionId:0,joinedSessions:[],suppressOutput:false,appInfo:null};this.mode=0;this.remoteAppLogin=true;var ub=false;var Pa={};var Qa={};var lb=null;var n=this;var Ka=false;var Eb=false;var xa=false;var Mb=0;var wa=0;var N=hi5.appcfg||{img:{},toolbar:{fadable:true}};this.setConfig=
function(a){N=a};var bb=typeof w=="object"?w:null;var u=bb?{}:hi5.tool.queryToObj(w.substring(w.indexOf("?")+1));var M=0;var Y=0;var Ia=(Ya||u.color||u.server_bpp||16)|0;var Na=hi5.Arrays.arraycopy;var Ha=hi5.Arrays.fill;var eb=null;var I=null;var ha=null;var Ta=N.updateFix?new tb:null;this.protocol=bb?"":w.substring(0,w.indexOf("://")).toLowerCase();this.setProfiler=function(a){I=a};this.getProfiler=function(){return I};this.gateway=function(){if(bb)return"";var a=w.lastIndexOf("/RDP?");if(a==-1)a=
w.lastIndexOf("/JOIN?");if(a==-1)a=w.lastIndexOf("/PLAY?");var f=w.substring(0,a);return f.replace(/wss\:\/\//ig,"https://").replace(/ws\:\/\//ig,"http://")}();svGlobal.logger.warn("Ver:"+svGlobal.version+" build:"+svGlobal.build);var ya=typeof w=="object"||w.indexOf("/PLAY?")>0;var Pc=!ya&&w.indexOf("invitation=")>0;if(Pc){var Nb=decodeURIComponent(w);var yb=Nb.indexOf(' USERNAME="');if(yb>0){yb+=11;var Qc=Nb.substring(yb,Nb.indexOf('"',yb));w+="&novice="+Qc+"&server="+Qc}w+="&mapClipboard=on"}if(ya){this.mode=
1;if(bb)w="";else{M=640|0;Y=480|0}w+="&touchpad=on";this.reconnectOnResize=false}else if(w.indexOf("/JOIN?")>0||Pc){this.mode=2;this.reconnectOnResize=false}if(ka)M=parseInt(ka);else if(u.width)M=parseInt(u.width);if(fa)Y=parseInt(fa);else if(u.height)Y=parseInt(u.height);if(M==-1)M=screen.width;if(Y==-1)Y=screen.height;if(u.symlink&&u.parameters)hi5.tool.queryToObj(u.parameters,u);if(!u.gateway)w+="&gateway="+encodeURIComponent(n.gateway);if(!u.minWidth&&N.minWidth)rdArgs.minWidth=N.minWidth;if(!u.minHeight&&
N.minHeight)rdArgs.minHeight=N.minHeight;if(u.minWidth)u.minWidth=parseInt(u.minWidth);if(u.minHeight)u.minHeight=parseInt(u.minHeight);if(u.waWidth)u.waWidth=parseInt(u.waWidth);if(u.waHeight)u.waHeight=parseInt(u.waHeight);if(!("useSSL"in u))w+="&useSSL="+(n.protocol=="wss");if(hi5.storage.isAvailable&&!fb(u.shareClipboard))if(pa(u.shareClipboard)||u.shareClipboardId||pa(u.mapClipboard)&&u.shareClipboard==undefined)w+="&shareClipboardId="+(u.shareClipboardId||Ga());if(N){if(N.displayMsg!=undefined)this.displayMsg=
N.displayMsg;else N.displayMsg=this.displayMsg;if(N.appTimeout)this.appTimeout=N.appTimeout;if(N.reconnectOnResize!=undefined)this.reconnectOnResize=N.reconnectOnResize;if(N.reconnectTimes)this.reconnectTimes=N.reconnectTimes;if(N.windowState!=undefined)this.windowState=N.windowState;if(N.openLink!=undefined)this.openLink=N.openLink;if(N.setTitle!=undefined)this.setTitle=N.setTitle;if(N.audioBuffer)this.audioBuffer=N.audioBuffer;if(typeof N.useWSS=="boolean")w=(N.useWSS?"wss":"ws")+w.substring(w.indexOf("://"));
if(typeof N.remoteAppLogin=="boolean"){this.remoteAppLogin=N.remoteAppLogin;ub=!N.remoteAppLogin;svGlobal.logger.warn("remoteAppLogin deprecated, use hideLogin in appcfg.js instead")}if(typeof N.hideLogin=="boolean")ub=N.hideLogin}var db=this.reconnectTimes;this.server=sa();this.port=parseInt(u.port,10);this.loadbalanceToken=N.loadbalanceTokenName?N.loadbalanceTokenName+"="+hi5.tool.uuid():"";this.modifyURL=function(a){if(n.loadbalanceToken)a+="&"+n.loadbalanceToken;return a};this.getURL=function(){return w};
this.getColor=function(){return Ia};var gb=hi5.graphic.Rectangle;var ua=new function(){function a(a){return a&511^a>>>9^a>>>4^a>>>7}function f(a){return a&31^a>>>5^a>>>9}function e(a){var b;b=(a>>>8^a&255)>>>2&15;if(a>>>9!=0)b=~b;b=b&65535;return b%12}function d(a){var b;b=a>>>4&15;return(b^b>>>2^b>>>3)&3}function g(a){a=(a&1431655765)<<1|a>>>1&1431655765;a=(a&858993459)<<2|a>>>2&858993459;a=(a&252645135)<<4|a>>>4&252645135;if(a>>>8==0)return a;a=(a&16711935)<<8|a>>>8&16711935;if(a>>>16==0)return a;
a=(a&65535)<<16|a>>>16&65535;return a}function c(b){var f=A[a(b)];if((f^b)>>>9!=0)return f&511;else return A[B[e(b)]]}function b(a){var b=z[f(a)];if((b^a)>>>5!=0)return b&31;else return z[C[d(a)]]}function h(a,b){var f=a[2]|a[3]<<16;f<<=16;a[2]=f&65535;a[3]=f>>>16&65535;var d=a[0]|a[1]<<16;f|=d>>>16;a[2]=f&65535;a[3]=f>>>16&65535;d=d<<16|b;a[0]=d&65535;a[1]=d>>>16&65535}function l(a,b){var f=a[0];a[0]=a[b];a[b]=f}function n(a,f,d,e){var m=q;var r=p;var v=k;var C=0|0;var A=0;var z=0;var B;var E=0;
var P=f;var J=0|0;var M=0;var na=0;var U=0;var O=0;var ia=0|0;if(I)I.begin("decData6");u=0;t=v;if((e&64)!=0){Na(m,v-32768,m,0,32768);v=32768;k=v;t=32768}if((e&128)!=0){v=0;Ha(m,0,65536,0);Ha(r,0,r.length,0);t=0}if((e&32)!=32){Na(a,0,m,v,d);v+=d;u=v-k;k=v;return 0}U=0;for(var Q=f+d;P<Q;){ia=a[P++];C|=ia<<U;M+=8;U+=8;if(U>=32)break}C=g(C);if(P<Q){J=g(a[P++])&255;na=8}else na=0;for(;M>=8;){A=0;for(O=5;O<=13;O++){if(O==12)continue;ia=g(C&4294967295<<32-O);ia=c(ia);if(O==y[ia])break}C<<=O;M-=O;if(ia<256)m[v++]=
ia&255;else if(ia>256&&ia<289){B=ia-257;U=D[B];A=w[B]-1;if(U!=0)A+=g(C&4294967295<<32-U);h(r,A);C<<=U;M-=U}else if(ia>288&&ia<293){B=ia-289;A=r[B];if(B!=0)l(r,B)}else if(ia==256)break;for(U=32-M;U>0;)if(na<U){ia=J>>>8-na;C|=ia<<32-M-na;M+=na;U-=na;if(P<Q){J=g(a[P++])&255;na=8}else{U=0;na=0}}else if(na>U){C|=J>>>8-U;J<<=U;J&=255;na-=U;M=32;break}else{C|=J>>>8-U;M=32;if(P<Q){J=g(a[P++])&255;na=8}else na=0;break}if(A==0)continue;for(O=2;O<=9;O++){ia=g(C&4294967295<<32-O);ia=b(ia);if(O==x[ia])break}C<<=
O;M-=O;U=N[ia];z=F[ia];if(U!=0)z+=g(C&4294967295<<32-U);C<<=U;M-=U;E=v-A;U=z>A?A:z;for(ia=0;U>0;){m[v++]=m[E++];U--}for(;z>A;){ia=ia>=A?0:ia;m[v++]=m[E+ia++];z--}for(U=32-M;U>0;)if(na<U){ia=J>>>8-na;C|=ia<<32-M-na;M+=na;U-=na;if(P<Q){J=g(a[P++])&255;na=8}else{U=0;na=0}}else if(na>U){C|=J>>>8-U;J<<=U;J&=255;na-=U;M=32;break}else{C|=J>>>8-U;M=32;if(P<Q){J=g(a[P++])&255;na=8}else na=0;break}}if((e&128)!=0)u=v;else u=v-k;k=v;if(I)I.end("decData6");return 0}function m(a,b,f,d){var e;var g=0;var c;var h=
0;var p;var l;var m;var n;var y;var r=(d&1)!=0;var v=q;if(I)I.begin("decData5");if((d&32)==0){t=0;u=f;return 0}if((d&64)!=0)k=0;if((d&128)!=0){for(var x=65536;--x>=0;)v[x]=0;k=0}t=0;u=0;c=k;p=c;n=p;t=n;if(f==0)return 0;f+=h;do{if(g==0){if(h>=f)break;c=a[b+h++]<<24;g=8}if(c>=0){if(g<8){if(h>=f){if(c!=0)return-1;break}c|=a[b+h++]<<24-g;g+=8}if(p>=65536)return-1;v[p++]=c>>>24&255;c<<=8;g-=8;continue}c<<=1;if(--g==0){if(h>=f)return-1;c=a[b+h++]<<24;g=8}if(c>=0){if(g<8){if(h>=f)return-1;c|=a[b+h++]<<24-
g;g+=8}if(p>=65536)return-1;v[p++]=(c>>>24|128)&255;c<<=8;g-=8;continue}c<<=1;if(--g<(r?3:2)){if(h>=f)return-1;c|=a[b+h++]<<24-g;g+=8}if(r)switch(c>>>29){case 7:for(;g<9;g+=8){if(h>=f)return-1;c|=a[b+h++]<<24-g}c<<=3;l=c>>>26;c<<=6;g-=9;break;case 6:for(;g<11;g+=8){if(h>=f)return-1;c|=a[b+h++]<<24-g}c<<=3;l=(c>>>24)+64;c<<=8;g-=11;break;case 5:case 4:for(;g<13;g+=8){if(h>=f)return-1;c|=a[b+h++]<<24-g}c<<=2;l=(c>>>21)+320;c<<=11;g-=13;break;default:for(;g<17;g+=8){if(h>=f)return-1;c|=a[b+h++]<<24-
g}c<<=1;l=(c>>>16)+2368;c<<=16;g-=17}else switch(c>>>30){case 3:if(g<8){if(h>=f)return-1;c|=a[b+h++]<<24-g;g+=8}c<<=2;l=c>>>26;c<<=6;g-=8;break;case 2:for(;g<10;g+=8){if(h>=f)return-1;c|=a[b+h++]<<24-g}c<<=2;l=(c>>>24)+64;c<<=8;g-=10;break;default:for(;g<14;g+=8){if(h>=f)return-1;c|=a[b+h++]<<24-g}l=(c>>>18)+320;c<<=14;g-=14}if(g==0){if(h>=f)return-1;c=a[b+h++]<<24;g=8}m=0;if(c>=0){m=3;c<<=1;g--}else{y=r?14:11;do{c<<=1;if(--g==0){if(h>=f)return-1;c=a[b+h++]<<24;g=8}if(c>=0)break;if(--y==0)return-1}while(true);
m=(r?16:13)-y;c<<=1;if(--g<m)for(;g<m;g+=8){if(h>=f)return-1;c|=a[b+h++]<<24-g}y=m;m=c>>>32-y&~(-1<<y)|1<<y;c<<=y;g-=y}if(p+m>=65536)return-1;e=p-l&(r?65535:8191);do v[p++]=v[e++];while(--m!=0)}while(true);k=p;t=n;u=p-n;if(I)I.end("decData5");return 0}var k=0;var q=new Uint8Array(65536);var p=new Int32Array(8);var t=0;var u=0;var y=[6,6,6,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,9,8,9,9,9,9,8,8,9,9,9,9,9,9,8,9,9,10,9,9,9,9,9,9,9,10,9,10,10,10,9,9,10,9,10,9,10,9,9,9,10,10,9,10,9,9,8,9,9,9,9,10,10,10,9,9,10,10,
10,10,10,10,9,9,10,10,10,10,10,10,10,9,10,10,10,10,10,10,8,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,9,10,10,10,10,10,10,10,9,10,10,10,10,10,10,9,7,9,9,10,9,10,10,10,9,10,10,10,10,10,10,10,9,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,13,10,10,10,10,10,10,11,10,10,10,10,10,10,10,10,10,10,10,10,10,9,10,10,10,10,10,9,10,10,10,10,10,9,10,10,10,9,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,9,10,10,10,10,10,10,10,10,10,10,10,10,10,9,10,8,9,9,10,9,10,10,10,9,10,10,
10,9,9,8,7,13,13,7,7,10,7,7,6,6,6,6,5,6,6,6,5,6,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,8,5,6,7,7];var A=[123,65311,65293,65063,65024,65285,65303,65128,197,65031,65299,65216,65288,65048,65307,65203,65027,162,65090,65296,65035,65026,65169,65305,65152,233,65082,65301,65042,87,65239,65309,65294,65077,65129,65314,65304,65146,65025,65315,65300,65268,65204,65033,65308,65220,65289,65120,65136,65298,65029,65170,65185,65306,65039,65287,65110,65302,65282,65240,65256,65310,65053,59,65535,65286,65535,65137,65161,65535,
65535,65068,65067,65056,65535,65211,65231,65032,65535,65248,65037,65535,65177,65535,65028,65194,65097,65535,65047,65121,65247,65535,65279,65270,65100,65535,65535,65159,65535,65316,65535,65084,65138,65535,65535,65230,65535,65278,65535,65059,65212,65034,65193,65535,65041,65535,65154,65535,65030,65178,65269,65535,65058,65101,65119,65535,65283,65249,65535,65226,65228,65535,65049,65535,65207,65535,65535,65155,65065,65535,65535,65535,65132,65535,65261,65535,65535,65094,65116,65045,65535,65243,65190,65535,
65535,65092,65535,65036,65535,65173,65276,65535,65535,65208,5833,65535,65264,65535,65080,65535,65535,65133,65150,65535,65535,65535,65535,65115,65244,65535,65535,65260,65095,65055,65535,65151,65174,65535,65535,65189,65535,65040,65088,65074,65215,65535,65535,65236,65265,65535,65535,65535,65141,65535,65535,65165,65073,65535,65125,65051,65535,65252,65275,65535,65535,65106,65535,65038,65535,65181,65199,65535,65535,65105,65235,65535,65312,65535,65071,65535,65535,65217,65164,65535,65535,65535,65087,65535,
65535,65142,65535,65274,65107,65061,65535,65124,65253,65535,65535,65198,65535,65043,65535,65160,65182,65535,65091,65535,65535,65188,65171,65535,65535,65535,65085,65535,65535,65259,65241,65535,65044,65114,65535,65064,65149,65535,65535,65130,65535,65535,65281,65222,65224,65535,65535,65205,65535,65535,65535,65172,65144,65535,65535,65535,65187,65535,65535,65242,65112,65535,65054,65093,65258,65535,65131,65535,65535,65079,65535,65535,65535,65148,65206,65535,65535,65272,65535,65535,65535,65223,65179,65535,
65535,65535,65104,65535,65535,65197,65250,65535,65050,65123,65102,65535,65535,65273,65535,65139,65535,65535,65535,65072,65163,65535,65535,65213,65070,256,65535,65262,65234,65535,65535,65535,65196,65535,65535,65180,65156,65535,65060,65103,65271,65535,65535,65251,65122,65535,65535,65535,65535,65162,65140,65535,65535,65086,65535,65535,65535,65233,65214,65535,65535,65069,65535,65098,65267,65535,65535,65245,65118,65046,65535,65096,65192,65535,65195,65175,65535,65535,65232,65535,65535,65229,65209,65535,
65535,65535,65066,65535,65535,65158,65134,65535,65535,65535,65246,65535,65535,65117,65099,65057,65535,65263,65176,65535,65535,65153,65535,65535,65535,65191,65535,65210,65277,65535,65535,65535,65227,65535,65535,65135,65081,65535,65535,65535,65157,65535,268,65254,65127,65052,65535,65108,65202,65535,65535,65183,65535,65535,65535,65113,65201,65535,65218,65535,65535,65078,65266,65535,65535,65238,65143,65535,65535,65535,65075,65535,65535,65167,65109,65062,266,65284,65255,65535,289,65126,65535,65535,65535,
65200,65184,65535,271,65168,65535,65535,65237,65535,65535,65219,65076,65535,65535,65535,65166,65535,273,65145,65089,267];var B=[511,0,508,448,494,347,486,482];var x=[4,2,3,4,3,4,4,5,4,5,5,6,6,7,7,8,7,8,8,9,9,8,9,9,9,9,9,9,9,9,9,9];var z=[4065,4064,4066,4072,14,4069,4068,4074,4081,4067,21,4071,4079,70,4080,4077,4095,4087,4091,25,4093,4084,300,4075,4094,4086,4090,137,4092,4083,4088,4082];var C=[0,4,10,19];var D=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,14,14,15];var w=[1,
2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,32769,49153,65537];var N=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,6,6,8,8,14,14];var F=[2,3,4,5,6,7,8,9,10,12,14,16,18,22,26,30,34,42,50,58,66,82,98,114,130,194,258,514,2,2];var v=new RdpBuffer(q,0,1);this.reset=function(){k=0;q=new Uint8Array(65536);t=0;u=0;v=new RdpBuffer(q,0,1)};this.release=function(){p=null;v=null;q=null};this.getData=function(){v.setPosition(t);v.markEnd(t+u);
return v};this.toPDU=function(){var a=new Uint8Array(65536+8+32);a[0]=29;a[2]=1;a[3]=2;a[4]=k;a[5]=k>>8;a[6]=k>>16;a[7]=k>>24;a.set(q,8);a.set(new Uint8Array(p.buffer),65536+8);return a};this.fromStream=function(a){k=a.getLittleEndian32();var b=a.getPosition();q.set(a.getData().subarray(b,b+65536));a.skipPosition(65536);for(var f=0;f<8;f++)p[f]=a.getLittleEndian32()};this.getDecompressedLength=function(){return u};this.dec=function(a,b,f,d){if((d&15)==2)return n(a,b,f,d);else return m(a,b,f,d)}};
var ve=w.indexOf("nocurosr=on")>0;var da=w.indexOf("startProgram=app")>0;var Fb=w.indexOf("mapDisk=on")>0;var qa=null;if(da)this.reconnectOnResize=false;if(hi5.browser.isTouch)if(Math.max(M,Y)>Math.max(window.innerWidth,window.innerHeight))this.reconnectOnResize=false;this.isRemoteApp=function(){return da};var Q=null;var ga=false;var Oa=false;var ma=new Yd(n.audioBuffer);var A=new Rb(200,200);this.setVolume=function(a){if(ma)ma.setVolume(a)};this.setAudioBuffer=function(a){n.audioBuffer=a;ma.delay=
a;if(Rc)Rc.delay=a};var Rc=null;var ra=new Array;var V=0;var X=0;var T=M-1;var W=Y-1;var kb=null;var ab=0;window.$rdp=this;var Ja=null;var ta=Tb;var $a=Ub;ib(Ia);this.running=function(){return ga};this.setJoinMode=function(a){if(!ga)return;J("8E1"+a)};this.setJoinCloseMode=function(a){if(!ga)return;J("8EB3\t"+a)};this.refuseControl=function(a){if(!ga)return;J("8E3"+a)};this.giveControl=function(a){if(!ga)return;J("8E4"+a)};this.pauseSession=function(a,f){if(!ga)return;J("8EB"+(f?1:0)+"\t"+a)};this.closeSession=
function(a){if(!ga)return;J("8EB2"+"\t"+a)};this.requestControl=function(){if(!ga)return;J("8E2")};this.saveSession=function(a){if(!ga)return;J("8E9"+(a.save?1:0)+"\t"+(a.timeout||0)+"\t"+(a.id||0))};this.allowJoin=function(a,f){if(!ga)return;J("8EA"+a+"\t"+(f?1:0))};var Ob=new function(){function a(){if(e&&e.length>0){var f=e.shift();Ob.sendSingleKey(f.down,f.key);if(e.length>0)setTimeout(a,d);else e=null}}var f={" ":57,"space":57,"pgup":201,"pageup":201,"pgdn":209,"pagedown":209,"end":207,"home":199,
"left":203,"up":200,"right":205,"down":208,"printscreen":183,"insert":210,"del":211,"delete":211,"altgr":184,"windows":219,"windowsright":220,"context":221,"esc":1,"backspace":14,"tab":15,"enter":28,"meta":29,"command":29,"ctrl":29,"shift":42,"alt":56,"capslock":58,"f1":59,"f2":60,"f3":61,"f4":62,"f5":63,"f6":64,"f7":65,"f8":66,"f9":67,"f10":68,"f11":87,"f12":88,"numlock":69,"scrolllock":70,"add":78};this.sendSingleKey=function(a,d){var b=f[d.toLowerCase()];if(b)n.writeScancode(a,b);else{var e=d.length;
if(e==0)return;if(e==1)n.writeKeyCode(a,d.toUpperCase().charCodeAt(0));else if(a)n.writeText(d)}};var e=null;var d=0;this.sendKeyComb=function(f,c){if(!xa)return;var b=f.split("+");var h=b.length;var l=0;if(h==0)return;var n=null;var m=new Array;for(l=0;l<h;l++){var k=b[l];if(k==""&&n=="")k="Add";if(k!="")m.push({"key":k,"down":true});n=k}h=m.length;for(l=h-1;l>=0;l--)m.push({"key":m[l].key,"down":false});if(!c)for(l=0,h=m.length;l<h;l++)Ob.sendSingleKey(m[l].down,m[l].key);else{e=m;d=c;a()}}};this.writeKeyComb=
function(a,f){if(xa)Ob.sendKeyComb(a,f)};this.writeText=function(a,f){if(xa)if(f){var e=0;var d=false;var g=0;for(var c=a.length;g<c;g++){e=a.charCodeAt(g);if(e>64&&e<91)d=true;else{d=false;if(e>96&&e<123)e-=32}if(d)this.writeScancode(true,42);this.writeKeyCode(true,e);this.writeKeyCode(false,e);if(d)this.writeScancode(false,42)}}else J("86"+a)};var Sa=new function f(){this.capsLock=this.numLock=false;this.setJoinMode=n.setJoinMode;this.requestControl=n.requestControl;this.writeKeyComb=n.writeKeyComb;
this.writeText=n.writeText;this.draw=A.draw;this.refresh=function(f,e,c,b){return A.repaint(f,e,c-f+1,b-e+1)};this.getAppMode=function(){return n.mode};this.send=function(f){if(!ga)return;J(f)};this.saveSession=function(f){n.saveSession(f)};this.sendInput=function(f){if(xa&&!A.isPaused()){Zc(f);J(f);if(n.onactivity)n.onactivity(f)}};var e=null;this.getAppInfo=function(){return n.sessionInfo.appInfo};this.onresize=function(f){var g=f.target.svSurface;if(!g)return;var c=g.getFreeSpace();var b=c.width;
var h=c.height;if(da){J("8C6"+61441+"\t"+b+"\t"+h);return}if(n.reconnectOnResize&&ga){var l=function(){svGlobal.logger.warn("w:"+b+" ww:"+M+" h:"+h+" hh:"+Y);n.reconnect(b,h,N.forceReconnect)};if(e){clearTimeout(e);e=0}e=setTimeout(l,333)}};this.onorientationchange=function(f){if(n.reconnectOnResize)n.reconnect(f.innerWidth,f.innerHeight);else if(da){if(!f.svSurface)return;if(n.windowState)J("8C6"+61441+"\t"+f.innerWidth+"\t"+f.innerHeight)}};this.getClipData=qd;this.onfocus=function(f){var e=f.target;
if(da&&e.svSurface&&e.svSurface.railWin){var c=e.svSurface.railWin.getTopWin(B.zOrders);if(!c||!Q)return;var b=e.svSurface.context;if(b&&b!=A.getContext()){A.setContext(null);c.activate(1);svGlobal.logger.info("Activate win:"+c.id)}}};this.getShareFiles=function(f,e){if(Oa&&qa)qa.list(f,e)};this.getFile=function(f){n.reconnectOnResize=false;window.open(n.getFileUrl(f))};this.getFileLink=function(f){return n.modifyURL(za()+"/DOWNLOAD?s="+kb+"&f="+f)};this.getGateway=function(){return w};this.reconnect=
function(f,e,c){if(u.symlink){var b="user="+f+"&pwd="+e;if(c)b+="&domain="+c;w=hi5.tool.replaceQuery(w,"parameters",b)}else{w=hi5.tool.replaceQuery(w,"user",f);w=hi5.tool.replaceQuery(w,"pwd",e);w=hi5.tool.replaceQuery(w,"domain",c)}n.run()};this.sendKeyboardSynchronize=function(f,e,c){if(ya)return;var b=0;if(c)b=b|4;if(e)b=b|2;if(f)b=b|1;J("8E5"+b);Sa.capsLock=c;Sa.numLock=e};this.fromSyncedSurface=function(f){return B.fromSyncedSurface(f)}};var B=function e(){var d=[];d.repaint=function(e,c,b,h){var l=
0;for(var n=d.length;l<n;l++)d[l].repaint(e,c,b,h)};d.addSurface=function(e){d.push(e)};d.hasSurface=function(e){var c=d.length;for(var b=0;b<c;b++)if(d[b].equals(e))return true;return false};d.fromSyncedSurface=function(e){var c=d.length;var b=Date.now();for(var h=0;h<c;h++)if(d[h].isClipSynced(e))return true;return false};d.setSize=function(e,c,b){var h=0;for(var l=d.length;h<l;h++)d[h].setSize(e,c,b)};d.zOrders=new Array;d.drawLicense=function(e){var c=0;for(var b=d.length;c<b;c++)d[c].drawLicense(e)};
d.setReadOnly=function(e,c){var b=0;for(var h=d.length;b<h;b++)d[b].setReadOnly(e,c)};d.setVisible=function(d,e){svGlobal.logger.info("TODO: setVisible")};d.copyToClip=function(e){if(d.length<1)return;d[0].copyToClip(e)};d.setCursor=function(e){var c=0;for(var b=d.length;c<b;c++)d[c].setCursor(e)};d.hide=function(e){var c=0;for(var b=d.length;c<b;c++)if(da)d[c].getWindow().close();else d[c].hide()};d.execute=function(e,c){var b=0;for(var h=d.length;b<h;b++)d[b][e].apply(d[b],c)};d.addWin=function(e){var c=
d.getFocused();if(!c){svGlobal.logger.warn("Focused surface not found!");c=d[d.length-1]}if(!c){svGlobal.logger.warn("No surface available!");return}da=true;if(!c.railWin){c.railWin=new rd;c.onunload=function(){if(N.closeRemoteApp)if(c.railWin)c.railWin.close();if(c.remoteApp)c.remoteApp.close();if(c.railWin){c.railWin.clear();c.railWin=null}d.removeElm(c)}}if(c.context)A.setContext(c.context);c.railWin.addWin(e);if(n.windowState){var b=c.railWin.mainWin==e;if(b)setTimeout(function(){var b=c.getFreeSpace();
J("8C6"+61441+"\t"+b.width+"\t"+b.height);setTimeout(function(){e.exeCommand(61488)},50)},111)}if(hi5.browser.isIE)c.focus()};d.delWin=function(e){var c;for(var b=d.length-1;b>=0;b--){var h=d[b];c=h.railWin;var l=c.getWinById(e);var r=l&&l.appId&&l.appId.toLowerCase().indexOf("runonce")!=-1;if(c.delWin(e)>=0){if(l==c.mainWin)c.mainWin=null;if(!c.hasApp(l.appId)){var m=function(b){return function(){svGlobal.logger.info("Start del:"+Date.now());if(!b.railWin||!b.railWin.isRunning()){if(b.remoteApp)b.remoteApp.close();
d.delSurface(b)}}};var k=n.appTimeout;if(r||c.isNew())k*=10;svGlobal.logger.debug("Prepare del:"+Date.now());setTimeout(m(h),k)}}}};d.popWins=function(e){return d[0]&&d[0].railWin?d[0].railWin.popWins(e):[]};d.getWinById=function(e){var c;var b=0;for(var h=d.length;b<h;b++)if(d[b].railWin){c=d[b].railWin.getWinById(e);if(c)return c}return null};d.onWinChange=function(e){var c;var b=0;for(var h=d.length;b<h;b++)if(d[b].railWin){c=d[b].railWin.getWinById(e.id);if(c)d[b].railWin.onchange(e)}};d.setTitle=
function(e){var c;var b=0;for(var h=d.length;b<h;b++)if(d[b].railWin){c=d[b].railWin.getWinById(e);if(c&&c.titleInfo&&c.isVisible()){sb(c.titleInfo+" - "+sa(),d[b].getWindow());return}}};d.hasApp=function(e){var c=0;for(var b=d.length;c<b;c++)if(d[c].railWin.hasApp(e))return true;return false};d.delSurface=function(e){if(!e||e.railWin&&e.railWin.isRunning())return;svGlobal.logger.info("delete surface...");d.removeElm(e);e.close();if(d.length==0)Ra()};d.getOwnerSurface=function(e){var c=0;for(var b=
d.length;c<b;c++)if(d[c].railWin&&d[c].railWin.hasWin(e))return d[c];return null};d.getFocused=function(){var e=d.length;for(var c=0;c<e;c++)if(d[c].focused)return d[c];return d[e-1]};d.close=function(){var e=0;for(var c=d.length;e<c;e++)if(d[e]){if(d[e].remoteApp)d[e].remoteApp.close();d[e].close();d[e]=null}};return d}();this.getSurfaces=function(){return B};this.hide=function(){if(!B)return;B.hide()};var oa=null;var ja={count:0,names:[],close:function(){var e=ja.names;var d=0;for(var g=e.length;d<
g;d++)if(ja[e[d]].onclose){ja[e[d]].onclose();ja[e[d]]=null}e.length=0;e=null},init:function(e,d,g,c){function b(){this.WAVE_FORMAT_PCM=1;this.WAVE_FORMAT_ADPCM=2;this.WAVE_FORMAT_ALAW=6;this.WAVE_FORMAT_MULAW=7;this.WAVE_FORMAT_GSM=49;this.WAVE_FORMAT_MPEGLAYER3=85;this.WAVE_FORMAT_AAC=41222;this.formatTag=0;this.nChannels=0;this.nSamplesPerSec=0;this.nAvgBytesPerSec=0;this.nBlockAlign=0;this.bitsPerSample=0;this.hasLocalSupport=false;this.cbSize=0;this.extenstion=null;var b=this;this.fromBuffer=
function(d){b.formatTag=d.getLittleEndian16();b.nChannels=d.getLittleEndian16();b.nSamplesPerSec=d.getLittleEndian32();b.nAvgBytesPerSec=d.getLittleEndian32();b.nBlockAlign=d.getLittleEndian16();b.bitsPerSample=d.getLittleEndian16();var e=d.getLittleEndian16();b.cbSize=e;if(e>0){b.extenstion=new Array(e);d.copyToByteArray(b.extenstion,0,d.getPosition(),e);d.skipPosition(e)}};this.toBuffer=function(d){d.setLittleEndian16(b.formatTag);d.setLittleEndian16(b.nChannels);d.setLittleEndian32(b.nSamplesPerSec);
d.setLittleEndian32(b.nAvgBytesPerSec);d.setLittleEndian16(b.nBlockAlign);d.setLittleEndian16(b.bitsPerSample);d.setLittleEndian16(b.cbSize);if(b.cbSize>0)d.setBytes(b.extenstion)};this.getSize=function(){return 18+b.cbSize};this.toString=function(){return"Audio Format, tag="+b.formatTag+" nChannels="+b.nChannels+" nSamplesPerSec="+b.nSamplesPerSec+" nAvgBytesPerSec"+b.nAvgBytesPerSec+" nBlockAlign"+b.nBlockAlign+" bitsPerSample"+b.bitsPerSample+" cbSize="+b.cbSize}}function h(){var b=new n.DynamicChannel;
b.name="TSMF";var d={type:"image/jpeg"};var e=new Array(1);b.process=function(c){var g=c.getPosition();var h;var k=0;var l=0;var m;var n=0;var q=0;var r=0;var u;var v=c.getLittleEndian32();var B=v&1073741823;var w=B>>>30;var I=c.getLittleEndian32();var J=c.getLittleEndian32();switch(B){case 2:if(J==256){var N=c.getLittleEndian32();h=new Uint8Array(16);u=new RdpBuffer(h,0,16);u.setLittleEndian32(2|0);u.setLittleEndian32(I);u.setLittleEndian32(1);u.setLittleEndian32(0);b.send(h)}break;case 0:switch(J){case 257:m=
c.getBytes(16);q=c.getLittleEndian32();break;case 256:g=c.getPosition();var M=c.getLittleEndian32();var va=0;var O=0;for(r=0;r<M;r++){va=c.getLittleEndian32();O=c.getLittleEndian32();l=c.getLittleEndian32();c.skipPosition(O-4)}k=c.getPosition()-g;l=k+8+4;h=new Uint8Array(l);u=new RdpBuffer(h,0,l);u.setLittleEndian32(0|2147483648);u.setLittleEndian32(I);h.set(c.getData().subarray(g,c.getPosition()),8);b.send(h);break;case 261:m=c.getBytes(16);n=c.getLittleEndian32();break;case 264:n=c.getLittleEndian32();
c.skipPosition(4);var Aa=c.getLittleEndian32();var Q;var T;var W=0;var Y=0;var Z=0;var V;var na=0;Q=c.getBytes(16);T=c.getBytes(16);W=c.getLittleEndian32();Y=c.getLittleEndian32();Z=c.getLittleEndian32();V=c.getBytes(16);na=c.getLittleEndian32();c.skipPosition(na);h=new Uint8Array(20);u=new RdpBuffer(h,0,20);u.setLittleEndian32(0|2147483648);u.setLittleEndian32(I);if(hi5.Arrays.equals([118,105,100,115,0,0,16,0,128,0,0,170,0,56,155,113],Q)&&hi5.Arrays.equals([77,74,80,71,0,0,16,0,128,0,0,170,0,56,
155,113],T)&&hi5.Arrays.equals([128,159,88,5,86,195,206,17,191,1,0,170,0,85,89,90],V))u.setLittleEndian32(1);else{u.setLittleEndian32(0);svGlobal.logger.warn("Format is not supported:");svGlobal.logger.warn(Q);svGlobal.logger.warn(T);svGlobal.logger.warn(V)}u.setLittleEndian32(n);b.send(h);break;case 261:m=c.getBytes(16);n=c.getLittleEndian32();break;case 258:m=c.getBytes(16);q=c.getLittleEndian32();Aa=c.getLittleEndian32();c.skipPosition(Aa);break;case 263:m=c.getBytes(16);h=new Uint8Array(16);u=
new RdpBuffer(h,0,16);u.setLittleEndian32(0|2147483648);u.setLittleEndian32(I);u.setLittleEndian32(1);b.send(h);case 277:m=c.getBytes(16);q=c.getLittleEndian32();break;case 262:m=c.getBytes(16);A.flushImgs();A.setImgRect(0,0,0,0);h=new Uint8Array(12);u=new RdpBuffer(h,0,12);u.setLittleEndian32(0|2147483648);u.setLittleEndian32(I);b.send(h);break;case 278:m=c.getBytes(16);var U=c.getLittleEndian32();var X=c.getLittleEndian32();var ia=c.getLittleEndian32();var aa=c.getLittleEndian32();A.setImgRect(U,
X,ia-U,aa-X);break;case 265:m=c.getBytes(16);var ga=c.getLittleEndian64();var ja=c.getLittleEndian32()==1;break;case 266:m=c.getBytes(16);break;case 268:m=c.getBytes(16);break;case 267:m=c.getBytes(16);break;case 269:m=c.getBytes(16);var ka=c.getLittleEndian32();break;case 274:break;case 275:break;case 259:m=c.getBytes(16);q=c.getLittleEndian32();k=c.getLittleEndian32();c.skipPosition(32);k=c.getLittleEndian32();var ma=new Image;g=c.getPosition();e[0]=c.getData().subarray(g,g+k);var S=new Blob(e,
d);ma.src=URL.createObjectURL(S);A.addImg(ma);break;case 270:A.flushImgs();break;case 273:break;case 260:break;case 276:m=c.getBytes(16);k=c.getLittleEndian32();g=c.getPosition()+k;c.skipPosition(8);var da=c.getLittleEndian32();svGlobal.logger.info("window state:"+da);var Sc=c.getLittleEndian32();var ea=c.getLittleEndian32();U=c.getLittleEndian32();X=c.getLittleEndian32();c.skipPosition(8);var fa=c.getLittleEndian32();var ha=c.getLittleEndian32();svGlobal.logger.info("Window rect, left:"+U+" top:"+
X+" w:"+Sc+" h:"+ea+" cl:"+fa+" ct:"+ha);c.setPosition(g);var oa=c.getLittleEndian32();for(g=c.getPosition()+oa;c.getPosition()<g;){var qa=c.getLittleEndian32();var pa=c.getLittleEndian32();var ra=c.getLittleEndian32();var sa=c.getLittleEndian32();svGlobal.logger.info("visible region, l:"+pa+" t:"+qa+" r:"+sa+" b:"+ra)}A.setImgRect(U,X,Sc,ea);break;case 1:case 2:break;default:svGlobal.logger.warn("unknown function:"+J)}break;default:svGlobal.logger.warn("unkown interface:"+B)}};return b}function l(){oa=
new n.DynamicChannel;oa.name="Microsoft::Windows::RDS::DisplayControl";oa.enabled=false;oa.process=function(b){var d=b.getLittleEndian32();var e=b.getLittleEndian32();switch(d){case 5:var c=b.getLittleEndian32();oa.maxMonitorAreaFactorA=b.getLittleEndian32();oa.maxMonitorAreaFactorB=b.getLittleEndian32();oa.enabled=true;svGlobal.logger.warn("Display control maxNumMonitors:"+c+" factorA:"+oa.maxMonitorAreaFactorA+" factorB:"+oa.maxMonitorAreaFactorB);b=new Uint8Array(2);b[0]=146;b[1]=4;Q.send(b.buffer);
case 2:}};oa.applyResolution=function(b,d){if(oa.enabled){var e=new Uint8Array(56);var c=new RdpBuffer(e,0,56);if(b>oa.maxMonitorAreaFactorA)b=oa.maxMonitorAreaFactorA;else b=Za(b);if(d>oa.maxMonitorAreaFactorB)d=oa.maxMonitorAreaFactorB;else d=Za(d);c.setLittleEndian32(2);c.setLittleEndian32(56);c.setLittleEndian32(40);c.setLittleEndian32(1);c.setLittleEndian32(1);c.setLittleEndian32(0);c.setLittleEndian32(0);c.setLittleEndian32(b);c.setLittleEndian32(d);c.setLittleEndian32(b*.26458|0);c.setLittleEndian32(d*
.26458|0);c.setLittleEndian32(b>d?0:90);c.setLittleEndian32(100);c.setLittleEndian32(100);oa.send(e);svGlobal.logger.warn("Display control: "+b+"x"+d)}else svGlobal.logger.warn("Display control disabled.")};return oa}function r(d){var e=false;var c=0;var g=0;var h=0;var k=0;var l=[];var m=new Uint8Array(4);audioPlayback=new n.DynamicChannel;audioPlayback.name="AUDIO_PLAYBACK_DVC";audioPlayback.onclose=function(){};audioPlayback.process=function(n){function q(e){e.skipPosition(14);var c=e.getLittleEndian16();
var g=e.getByte();var h=e.getLittleEndian16();e.skipPosition(1);var k=0;var m=false;l.length=0;for(var n=0;n<c;n++){var r=new b;r.fromBuffer(e);m=r.nSamplesPerSec>=22050&&(r.formatTag==1||r.formatTag==49&&r.nSamplesPerSec==22050&&d==0);if(m)l.push(r)}var t=20;k=l.length;for(n=0;n<k;n++)t=t+l[n].getSize();var u=t+4;var v=new RdpBuffer(new Uint8Array(u),0,u);v.setByte(7);v.setByte(2);v.setLittleEndian16(t);v.setLittleEndian32(1|2);v.setLittleEndian32(4294967295);v.setLittleEndian32(0);v.setLittleEndian16(0);
v.setLittleEndian16(k);v.skipPosition(1);v.setLittleEndian16(h);v.setByte(124);for(n=0;n<k;n++){r=l[n];r.toBuffer(v)}v.markEnd();audioPlayback.send(v);if(h>5){v=new RdpBuffer(new Uint8Array(8),0,8);v.setByte(12);v.skipPosition(1);v.setLittleEndian16(4);v.setLittleEndian16(0);v.setLittleEndian16(0);v.markEnd();audioPlayback.send(v)}}function r(b){var d=b.getLittleEndian16();var e=b.getLittleEndian16();var c=new RdpBuffer(new Uint8Array(8),0,8);c.setByte(6);c.setByte(35);c.setLittleEndian16(4);c.setLittleEndian16(d);
c.setLittleEndian16(e);c.markEnd();audioPlayback.send(c)}function u(){var b=l[h];if(b.formatTag!=aa.tag||b.nSamplesPerSec!=aa.samplePerSec||aa.channels!=b.nChannels){aa.tag=b.formatTag;aa.channels=b.nChannels;aa.samplePerSec=b.nSamplesPerSec;aa.bitsPerSample=b.formatTag==49?8:b.bitsPerSample}}function A(b){g=b.getLittleEndian16();h=b.getLittleEndian16();k=b.getByte();b.skipPosition(3);m[0]=b.getByte();m[1]=b.getByte();m[2]=b.getByte();m[3]=b.getByte();e=true;u()}function v(b,d){var e=new RdpBuffer(new Uint8Array(8),
0,8);e.setByte(5);e.skipPosition(1);e.setLittleEndian16(4);e.setLittleEndian16(b);e.setByte(d);e.skipPosition(1);e.markEnd();audioPlayback.send(e)}function B(b,d){return function(){v(b,d)}}function w(b){e=false;var d=c-8;var h=Date.now();b.copyFromByteArray(m,0,b.getPosition(),4);var p=Gb(b,k,g,d);p=(p-ma.delay)*1E3;var l=g+(Date.now()-h)+p;v(l,k)}function I(b){var d=Date.now();g=b.getLittleEndian16();h=b.getLittleEndian16();k=b.getByte();b.skipPosition(7);u();var e=Gb(b,k,g,0);e=(e-ma.delay)*1E3;
var c=g+(Date.now()-d)+e;v(c,k)}if(e){w(n);return}var J=n.getByte();n.skipPosition(1);c=n.getLittleEndian16();switch(J){case 7:q(n);break;case 6:r(n);break;case 2:A(n);break;case 1:closed=true;break;case 3:var M=n.getLittleEndian16();var N=n.getLittleEndian16();break;case 4:break;case 13:I(n);default:}};return audioPlayback}if(N.disableDVC)return;ja.count=0;ja.names.length=0;var m=new n.DynamicChannel;m.name="ECHO";m.process=function(b){var d=b.getPosition();var e=b.getEnd();var c=e-d;var g=new Uint8Array(c);
g.set(b.getData().subarray(d,e));m.send(g)};n.addDynamicChannel(m);if(e){var k=new n.DynamicChannel;k.name="Microsoft::Windows::RDS::Input";k.process=function(b){var d=b.getLittleEndian16();var e=b.getLittleEndian32();switch(d){case 1:b.skipPosition(4);var c=new RdpBuffer(new Uint8Array(16),0,16);c.setLittleEndian16(2);c.setLittleEndian32(16);c.setLittleEndian32(1|2);c.setLittleEndian32(65536);c.setLittleEndian16(256);c.markEnd();k.send(c);case 5:B.execute("setTouchRemoting",[true]);ja.isTouchReady=
true;svGlobal.logger.info("Touch remoting start");break;case 4:B.execute("setTouchRemoting",[false]);ja.isTouchReady=false;svGlobal.logger.info("Touch remoting suspend")}};n.addDynamicChannel(k)}if(g){svGlobal.logger.warn("Audio input on");var q=new n.DynamicChannel;(function t(){function d(e){var c=e.getLittleEndian32();var g=e.getLittleEndian32();var h=[];var k=[];var l=0;var n=ma.getContext().sampleRate;for(l=0;l<c;l++){var r=new b;r.fromBuffer(e);if(r.formatTag==49&&r.nSamplesPerSec==22050){r.hasLocalSupport=
true;h.push(r)}else if(r.formatTag==1&&r.nSamplesPerSec==n&&r.nChannels==2)k.push(r)}q.send(m);var t=0;g=h.length;if(g==0){h=k;g=k.length;B.directInput=true}for(l=0;l<g;l++)t+=h[l].getSize();var u=new RdpBuffer(new Uint8Array(1024),0,1024);u.setByte(2);u.setLittleEndian32(g);u.setLittleEndian32(t+9);for(l=0;l<g;l++)h[l].toBuffer(u);u.skipPosition(1024-t-9);u.markEnd();q.send(u)}function e(b){var d=new RdpBuffer(new Uint8Array(5),0,5);d.setByte(7);d.setLittleEndian32(b);d.markEnd();q.send(d)}function c(d){var g=
d.getLittleEndian32();var h=d.getLittleEndian32();var k=new b;k.fromBuffer(d);r=true;u=n.reconnectOnResize;n.reconnectOnResize=false;if(!B.onopen)B.onopen=function(b){if(ga){l=b;n.reconnectOnResize=u;e(h);var d=new RdpBuffer(new Uint8Array(5),0,5);d.setByte(4);d.setLittleEndian32(b?0:1);d.markEnd();q.send(d)}};if(!B.ondata)B.ondata=function(b,d){if(l){if(A.length!=d+1){A=new Uint8Array(d+1);A[0]=6}q.send(m);A.set(b,1);q.send(A)}};B.start()}function g(b){var d=b.getLittleEndian32();if(!r){e(d);r=false}}
function h(b){function d(e){u=true;if(n.onopen)n.onopen(true);v=new k;g=e;l=b.createMediaStreamSource(e);var h=n.directInput?1024:4096;m=b.createJavaScriptNode?b.createJavaScriptNode(h,1,1):b.createScriptProcessor(h,1,1);if(n.directInput&&!y)y=new Int16Array(2048);m.onaudioprocess=function(b){if(!c)return;var d=b.inputBuffer.getChannelData(0);if(n.directInput){var e=0;var g=0;for(var h=0;h<1024;h++){g=d[h]*32767;y[e++]=g;y[e++]=g}B.ondata(new Uint8Array(y.buffer),4196)}else x.addData(d,t);d.fill(0)};
var r=b.createBiquadFilter();r.frequency.value=q/2;l.connect(r);r.connect(m);m.connect(b.destination)}function e(){if(!c){if(g&&g.getTracks){var b=g.getTracks()[0];b.stop()}m&&m.disconnect();l&&l.disconnect();u=false}}var c=false;var g=null;var l=null;var m=null;var n=this;var r=b.sampleRate;var q=22050;var t=r/q;var u=false;this.directInput=false;n=this;var y;this.start=function(){if(!u)navigator.getUserMedia({audio:true},d,function(b){u=false;c=false;if(n.onopen)n.onopen(false);svGlobal.logger.warn("Error on getUserMedia: "+
b)});else if(n.onopen)n.onopen(true);c=true};this.stop=function(){c=false};this.close=function(){c=false;if(x)x.reset();v=new k;e()};var x=new function(){function b(d){var l=k/g|0;for(var m=0;m<l;m++){e(d,h);h+=g;k-=g}if(k>0)c=d;else c=null}function d(e){var g=k+e.length;var l=new Float32Array(g);l.set(c.subarray(h));l.set(e,k);h=0;k=g;b(l)}function e(b,d){var c=v.encode(b,d,r,l);l+=c;if(l==m){l=0;n.ondata(r,m)}}var c=null;var g=160;var h=0;var k=0;var l=0;var m=Math.floor(Math.floor(Math.floor(4096/
t)/160)/2)*65;var r=new Uint8Array(m);this.reset=function(){l=0;h=0;k=0;c=null};this.addData=function(e,c){e=$c(e,c);if(k==0){k=e.length;h=0;b(e)}else d(e)}}}function k(){function b(d,e){var c=0;for(var g=0;g<160;g++){c=d[e++];oa[g]=c<0?c*32768:c*32767}}function d(){pa=!pa;var b=0;e();var c=0;if(pa){c=S[0]<<4|S[1]<<10;L[b++]=c>>4;c=c>>5|S[2]<<11;L[b++]=c>>7;c=c>>5|S[3]<<11;c=c>>4|S[4]<<12;L[b++]=c>>6;c=c>>4|S[5]<<12;c=c>>3|S[6]<<13;L[b++]=c>>7;c=c>>3|S[7]<<13;c=c>>7|da[0]<<9;L[b++]=c>>5;c=c>>2|fa[0]<<
14;c=c>>2|ea[0]<<14;c=c>>6|ha[0]<<10;L[b++]=c>>3;c=c>>3|G[0]<<13;L[b++]=c>>8;c=c>>3|G[1]<<13;c=c>>3|G[2]<<13;c=c>>3|G[3]<<13;L[b++]=c>>7;c=c>>3|G[4]<<13;c=c>>3|G[5]<<13;c=c>>3|G[6]<<13;L[b++]=c>>6;c=c>>3|G[7]<<13;c=c>>3|G[8]<<13;L[b++]=c>>8;c=c>>3|G[9]<<13;c=c>>3|G[10]<<13;c=c>>3|G[11]<<13;L[b++]=c>>7;c=c>>3|G[12]<<13;c=c>>7|da[1]<<9;L[b++]=c>>5;c=c>>2|fa[1]<<14;c=c>>2|ea[1]<<14;c=c>>6|ha[1]<<10;L[b++]=c>>3;c=c>>3|G[13]<<13;L[b++]=c>>8;c=c>>3|G[14]<<13;c=c>>3|G[15]<<13;c=c>>3|G[16]<<13;L[b++]=c>>
7;c=c>>3|G[17]<<13;c=c>>3|G[18]<<13;c=c>>3|G[19]<<13;L[b++]=c>>6;c=c>>3|G[20]<<13;c=c>>3|G[21]<<13;L[b++]=c>>8;c=c>>3|G[22]<<13;c=c>>3|G[23]<<13;c=c>>3|G[24]<<13;L[b++]=c>>7;c=c>>3|G[25]<<13;c=c>>7|da[2]<<9;L[b++]=c>>5;c=c>>2|fa[2]<<14;c=c>>2|ea[2]<<14;c=c>>6|ha[2]<<10;L[b++]=c>>3;c=c>>3|G[26]<<13;L[b++]=c>>8;c=c>>3|G[27]<<13;c=c>>3|G[28]<<13;c=c>>3|G[29]<<13;L[b++]=c>>7;c=c>>3|G[30]<<13;c=c>>3|G[31]<<13;c=c>>3|G[32]<<13;L[b++]=c>>6;c=c>>3|G[33]<<13;c=c>>3|G[34]<<13;L[b++]=c>>8;c=c>>3|G[35]<<13;c=
c>>3|G[36]<<13;c=c>>3|G[37]<<13;L[b++]=c>>7;c=c>>3|G[38]<<13;c=c>>7|da[3]<<9;L[b++]=c>>5;c=c>>2|fa[3]<<14;c=c>>2|ea[3]<<14;c=c>>6|ha[3]<<10;L[b++]=c>>3;c=c>>3|G[39]<<13;L[b++]=c>>8;c=c>>3|G[40]<<13;c=c>>3|G[41]<<13;c=c>>3|G[42]<<13;L[b++]=c>>7;c=c>>3|G[43]<<13;c=c>>3|G[44]<<13;c=c>>3|G[45]<<13;L[b++]=c>>6;c=c>>3|G[46]<<13;c=c>>3|G[47]<<13;L[b++]=c>>8;c=c>>3|G[48]<<13;c=c>>3|G[49]<<13;c=c>>3|G[50]<<13;L[b++]=c>>7;c=c>>3|G[51]<<13;L[b]=c>>12;qa=L[b]}else{c=qa<<6|S[0]<<10;L[b++]=c>>6;c=c>>6|S[1]<<10;
L[b++]=c>>8;c=c>>5|S[2]<<11;c=c>>5|S[3]<<11;L[b++]=c>>6;c=c>>4|S[4]<<12;c=c>>4|S[5]<<12;L[b++]=c>>6;c=c>>3|S[6]<<13;c=c>>3|S[7]<<13;L[b++]=c>>8;c=c>>7|da[0]<<9;c=c>>2|fa[0]<<14;L[b++]=c>>7;c=c>>2|ea[0]<<14;c=c>>6|ha[0]<<10;L[b++]=c>>7;c=c>>3|G[0]<<13;c=c>>3|G[1]<<13;c=c>>3|G[2]<<13;L[b++]=c>>6;c=c>>3|G[3]<<13;c=c>>3|G[4]<<13;L[b++]=c>>8;c=c>>3|G[5]<<13;c=c>>3|G[6]<<13;c=c>>3|G[7]<<13;L[b++]=c>>7;c=c>>3|G[8]<<13;c=c>>3|G[9]<<13;c=c>>3|G[10]<<13;L[b++]=c>>6;c=c>>3|G[11]<<13;c=c>>3|G[12]<<13;L[b++]=
c>>8;c=c>>7|da[1]<<9;c=c>>2|fa[1]<<14;L[b++]=c>>7;c=c>>2|ea[1]<<14;c=c>>6|ha[1]<<10;L[b++]=c>>7;c=c>>3|G[13]<<13;c=c>>3|G[14]<<13;c=c>>3|G[15]<<13;L[b++]=c>>6;c=c>>3|G[16]<<13;c=c>>3|G[17]<<13;L[b++]=c>>8;c=c>>3|G[18]<<13;c=c>>3|G[19]<<13;c=c>>3|G[20]<<13;L[b++]=c>>7;c=c>>3|G[21]<<13;c=c>>3|G[22]<<13;c=c>>3|G[23]<<13;L[b++]=c>>6;c=c>>3|G[24]<<13;c=c>>3|G[25]<<13;L[b++]=c>>8;c=c>>7|da[2]<<9;c=c>>2|fa[2]<<14;L[b++]=c>>7;c=c>>2|ea[2]<<14;c=c>>6|ha[2]<<10;L[b++]=c>>7;c=c>>3|G[26]<<13;c=c>>3|G[27]<<13;
c=c>>3|G[28]<<13;L[b++]=c>>6;c=c>>3|G[29]<<13;c=c>>3|G[30]<<13;L[b++]=c>>8;c=c>>3|G[31]<<13;c=c>>3|G[32]<<13;c=c>>3|G[33]<<13;L[b++]=c>>7;c=c>>3|G[34]<<13;c=c>>3|G[35]<<13;c=c>>3|G[36]<<13;L[b++]=c>>6;c=c>>3|G[37]<<13;c=c>>3|G[38]<<13;L[b++]=c>>8;c=c>>7|da[3]<<9;c=c>>2|fa[3]<<14;L[b++]=c>>7;c=c>>2|ea[3]<<14;c=c>>6|ha[3]<<10;L[b++]=c>>7;c=c>>3|G[39]<<13;c=c>>3|G[40]<<13;c=c>>3|G[41]<<13;L[b++]=c>>6;c=c>>3|G[42]<<13;c=c>>3|G[43]<<13;L[b++]=c>>8;c=c>>3|G[44]<<13;c=c>>3|G[45]<<13;c=c>>3|G[46]<<13;L[b++]=
c>>7;c=c>>3|G[47]<<13;c=c>>3|G[48]<<13;c=c>>3|G[49]<<13;L[b++]=c>>6;c=c>>3|G[50]<<13;c=c>>3|G[51]<<13;L[b++]=c>>8}}function e(){var b=0;var d=0;var g=0;var h=120;var k=new Int16Array(50);var l=new Int16Array(160);c(l);x(l,S);N(ba,S,l);var m=ba.dp0;var n=0;var r=0;for(var q=0;q<=3;q++,b+=13){u(l,q*40,k,m,m,h,da,fa,d++);F(k,ha,ea,g++,G,b);for(n=0;n<=39;n++){r=k[5+n]+m[n+h];m[n+h]=r<-32768?-32768:r>32767?32767:r}h+=40}for(n=0;n<120;n++)m[n]=m[160+n]}function c(b){var d=0;var e=0;var g=ba.z1;var h=ba.l_z2;
var k=ba.mp;var n=0;var r=0;var q=0;var t=0;var u=0;var v=0;for(var y=160;y!=0;){y--;t=oa[d++]>>3<<2<<16>>16;n=t-g<<16>>16;g=t;u=n;u<<=15;r=h>>15<<16>>16;q=h-(r<<15)<<16>>16;u+=l(q,32735);v=r*32735;h=m(v,u);v=m(h,16384);r=l(k,-28180);k=v>>15<<16>>16;var x=k+r;b[e++]=x<-32768?-32768:x>32767?32767:x}ba.z1=g;ba.l_z2=h;ba.mp=k}function g(b,c){var d=0;var e=pa?32:33;for(d=0;d<e;d++)b[d+c]=L[d];return e}function h(b,c){if(b==-32768&&c==-32768)return 32767;else return b*c>>15<<16>>16}function l(b,c){if(b==
-32768&&c==-32768)return 32767;else{var d=b*c+16384;d>>=15;return d<<16>>16}}function m(b,c){var d=0;if(b<=0)if(c>=0)return b+c;else{d=-(b+1)-(c+1);return d>=2147483647?-2147483648:-d-2}else if(c<=0)return b+c;else{d=b+c;return d>2147483647?2147483647:d}}function n(b){if(b<0){if(b<=-1073741824)return 0;b=~b}return((b&4294901760)!=0?(b&4278190080)!=0?-1+ra[255&b>>24]:7+ra[255&b>>16]:(b&65280)!=0?15+ra[255&b>>8]:23+ra[255&b])<<16>>16}function r(b,c){if(c>=16)return 0;if(c<=-16)if(b<0)return-1;else return-0;
if(c<0)return q(b,-c);return b<<c<<16>>16}function q(b,c){if(c>=16)if(b<0)return-1;else return-0;if(c<=-16)return 0;if(c<0)return b<<-c<<16>>16;return b>>c<<16>>16}function t(b,c){var d=b;var e=c;var g=0;var h=15;if(b==0)return 0;for(;h!=0;){h--;g=g<<17>>16;d<<=1;if(d>=e){d-=e;g++}}return g<<16>>16}function u(b,c,d,e,g,h,k,l,n){v(b,c,e,h,l,k,n);y(l[n],k[n],e,b,c,g,d,h)}function v(b,c,d,e,g,k,l){var m=0;var r=0;var q=new Int16Array(40);var t=0;var u=0;var y=0;var x=0;var A=0;var D=0;var B=0;for(var C=
0;C<=39;C++){B=b[C+c];B=(B<0?B==-32768?32767:-B:B)<<16>>16;if(B>A)A=B}B=0;if(A==0)D=0;else B=n(A<<16);if(B>6)D=0;else D=6-B<<16>>16;for(C=0;C<=39;C++)q[C]=b[C+c]>>D;t=0;r=40;for(m=40;m<=120;m++){var z=0;var w=1;z=q[0]*d[e-m];z+=q[1]*d[w+e-m];w++;z+=q[2]*d[w+e-m];w++;z+=q[3]*d[w+e-m];w++;z+=q[4]*d[w+e-m];w++;z+=q[5]*d[w+e-m];w++;z+=q[6]*d[w+e-m];w++;z+=q[7]*d[w+e-m];w++;z+=q[8]*d[w+e-m];w++;z+=q[9]*d[w+e-m];w++;z+=q[10]*d[w+e-m];w++;z+=q[11]*d[w+e-m];w++;z+=q[12]*d[w+e-m];w++;z+=q[13]*d[w+e-m];w++;
z+=q[14]*d[w+e-m];w++;z+=q[15]*d[w+e-m];w++;z+=q[16]*d[w+e-m];w++;z+=q[17]*d[w+e-m];w++;z+=q[18]*d[w+e-m];w++;z+=q[19]*d[w+e-m];w++;z+=q[20]*d[w+e-m];w++;z+=q[21]*d[w+e-m];w++;z+=q[22]*d[w+e-m];w++;z+=q[23]*d[w+e-m];w++;z+=q[24]*d[w+e-m];w++;z+=q[25]*d[w+e-m];w++;z+=q[26]*d[w+e-m];w++;z+=q[27]*d[w+e-m];w++;z+=q[28]*d[w+e-m];w++;z+=q[29]*d[w+e-m];w++;z+=q[30]*d[w+e-m];w++;z+=q[31]*d[w+e-m];w++;z+=q[32]*d[w+e-m];w++;z+=q[33]*d[w+e-m];w++;z+=q[34]*d[w+e-m];w++;z+=q[35]*d[w+e-m];w++;z+=q[36]*d[w+e-m];
w++;z+=q[37]*d[w+e-m];w++;z+=q[38]*d[w+e-m];w++;z+=q[39]*d[w+e-m];w++;if(z>t){r=m<<16>>16;t=z}}k[l]=r;t<<=1;t=t>>6-D;u=0;for(C=0;C<=39;C++){var E=0;E=d[C-r+e]>>3<<16>>16;u+=E*E}u<<=1;if(t<=0){g[l]=0;return}if(t>=u){g[l]=3;return}B=n(u);y=t<<B>>16<<16>>16;x=u<<B>>16<<16>>16;for(var F=0;F<=2;F++){if(y<=h(x,ja[F]))break;g[l]=F}}function y(b,c,d,e,g,h,k,m){var n=0;var q=0;var r=0;switch(b){case 0:n=3277;for(q=0;q<=39;q++){h[q+m]=l(n,d[q-c+m]);r=e[q+g]-h[q+m];k[q+5]=r<-32768?-32768:r>32767?32767:r}break;
case 1:n=11469;for(q=0;q<=39;q++){h[q+m]=l(n,d[q-c+m]);r=e[q+g]-h[q+m];k[q+5]=r<-32768?-32768:r>32767?32767:r}break;case 2:n=21299;for(q=0;q<=39;q++){h[q+m]=l(n,d[q-c+m]);r=e[q+g]-h[q+m];k[q+5]=r<-32768?-32768:r>32767?32767:r}break;case 3:n=32767;for(q=0;q<=39;q++){h[q+m]=l(n,d[q-c+m]);r=e[q+g]-h[q+m];k[q+5]=r<-32768?-32768:r>32767?32767:r}}}function x(b,c){D(b);B(c);C(c);z(c)}function A(b,c,d,e,g){for(var h=0;h<g;h++)d[e+h]=b[c+h]}function D(b){var c=0;var d=0;var e=0;var g=0;var h=0;var k=0;var m=
0;for(k=0;k<=159;k++){m=b[k]+0;e=m<-32768?-32768:m>32767?32767:m;if(e>g)g=e}if(g==0)h=0;else h=4-n(g<<16)<<16>>16;if(h>0)switch(h){case 1:for(k=0;k<=159;k++)b[k]=l(b[k],16384);break;case 2:for(k=0;k<=159;k++)b[k]=l(b[k],16384>>1);break;case 3:for(k=0;k<=159;k++)b[k]=l(b[k],16384>>2);break;case 4:for(k=0;k<=159;k++)b[k]=l(b[k],16384>>3)}var q=b;var r=q[d];var t=[0,0,0,0,0,0,0,0,0];A(t,0,R,0,R.length);R[0]+=r*q[d-0];r=q[++d];R[0]+=r*q[d-0];R[1]+=r*q[d-1];r=q[++d];R[0]+=r*q[d-0];R[1]+=r*q[d-1];R[2]+=
r*q[d-2];r=q[++d];R[0]+=r*q[d-0];R[1]+=r*q[d-1];R[2]+=r*q[d-2];R[3]+=r*q[d-3];r=q[++d];R[0]+=r*q[d-0];R[1]+=r*q[d-1];R[2]+=r*q[d-2];R[3]+=r*q[d-3];R[4]+=r*q[d-4];r=q[++d];R[0]+=r*q[d-0];R[1]+=r*q[d-1];R[2]+=r*q[d-2];R[3]+=r*q[d-3];R[4]+=r*q[d-4];R[5]+=r*q[d-5];r=q[++d];R[0]+=r*q[d-0];R[1]+=r*q[d-1];R[2]+=r*q[d-2];R[3]+=r*q[d-3];R[4]+=r*q[d-4];R[5]+=r*q[d-5];R[6]+=r*q[d-6];r=q[++d];R[0]+=r*q[d-0];R[1]+=r*q[d-1];R[2]+=r*q[d-2];R[3]+=r*q[d-3];R[4]+=r*q[d-4];R[5]+=r*q[d-5];R[6]+=r*q[d-6];R[7]+=r*q[d-
7];r=q[++d];for(c=d;c<160;++c){r=q[c];R[0]+=r*q[c-0];R[1]+=r*q[c-1];R[2]+=r*q[c-2];R[3]+=r*q[c-3];R[4]+=r*q[c-4];R[5]+=r*q[c-5];R[6]+=r*q[c-6];R[7]+=r*q[c-7];R[8]+=r*q[c-8]}for(k=0;k<9;k++)R[k]<<=1;if(h>0)for(k=0;k<160;k++)b[k]<<=h}function B(b){var d=new Int16Array(1);var c=0;var e=0;var g=new Int16Array(9);var h=new Int16Array(9);var k=new Int16Array(9);if(R[0]==0){for(e=0;e<8;e++)b[e]=0;return}d[0]=n(R[0]);for(e=0;e<=8;e++)g[e]=R[e]<<d[0]>>16;A(g,0,k,0,7);A(g,0,h,0,8);for(var m=1;m<=8;m++,c++){d[0]=
h[1];d[0]=(d[0]<0?d[0]==-32768?32767:-d[0]:d[0])<<16>>16;if(h[0]<d[0]){for(e=m;e<8;e++)b[e]=0;return}b[c]=t(d[0],h[0]);if(h[1]>0)b[c]=-b[c];if(m==8)return;d[0]=l(h[1],b[c]);var q=h[0]+d[0];h[0]=q<-32768?-32768:q>32767?32767:q;for(var r=1;r<=8-m;r++){d[0]=l(k[r],b[c]);var u=h[r+1]+d[0];h[r]=u<-32768?-32768:u>32767?32767:u;d[0]=l(h[r+1],b[c]);var v=k[r]+d[0];k[r]=v<-32768?-32768:v>32767?32767:v}}}function C(b){var d;for(var c=0;c<8;c++){d=b[c];d=(d<0?d==-32768?32767:-d:d)<<16>>16;if(d<22118)d>>=1;else if(d<
31130)d-=11059;else{d-=26112;d<<=2}b[c]=b[c]<0?-d:d}}function z(b){var d=0;w(20480,0,31,-32,b,d++);w(20480,0,31,-32,b,d++);w(20480,2048,15,-16,b,d++);w(20480,-2560,15,-16,b,d++);w(13964,94,7,-8,b,d++);w(15360,-1792,7,-8,b,d++);w(8534,-341,3,-4,b,d++);w(9036,-1144,3,-4,b,d++)}function w(b,d,c,e,g,k){var l=0;l=h(b<<16>>16,g[k]);var m=l+(d<<16>>16);l=m<-32768?-32768:m>32767?32767:m;var n=l+256;l=n<-32768?-32768:n>32767?32767:n;l=l>>9<<16>>16;g[k]=(l>c?c-e:l<e?0:l-e)<<16>>16}function F(b,d,c,e,g,h){var k=
new Int16Array(13);var l=new Int16Array(13);H(b);I(k,c,e);J(k,g,h,d,e);P(g,l,h,ta);M(c[e],l,b,ta)}function H(b){var d=0;for(var c=0;c<=39;c++){d=8192>>1;d+=b[c+0]*-134+b[c+1]*-374+b[c+3]*2054+b[c+4]*5741+b[c+5]*8192+b[c+6]*5741+b[c+7]*2054+b[c+9]*-374+b[c+10]*-134;d=d>>13<<16>>16;ya[c]=d<-32768?-32768:d>32767?32767:d}}function I(b,d,c){var e=0;var g=0;var h=0;var k;e=0;e+=E(0,1)+E(0,2)+E(0,3)+E(0,4)+E(0,5)+E(0,6)+E(0,7)+E(0,8)+E(0,9)+E(0,10)+E(0,11)+E(0,12);k=e;e+=E(0,0);e<<=1;g=e;e=0;e+=E(1,0)+E(1,
1)+E(1,2)+E(1,3)+E(1,4)+E(1,5)+E(1,6)+E(1,7)+E(1,8)+E(1,9)+E(1,10)+E(1,11)+E(1,12);e<<=1;if(e>g){h=1;g=e}e=0;e+=E(2,0)+E(2,1)+E(2,2)+E(2,3)+E(2,4)+E(2,5)+E(2,6)+E(2,7)+E(2,8)+E(2,9)+E(2,10)+E(2,11)+E(2,12);e<<=1;if(e>g){h=2;g=e}e=k;e+=E(3,12);e<<=1;if(e>g){h=3;g=e}for(var l=0;l<=12;l++)b[l]=ya[h+3*l];d[c]=h}function E(b,d){var c;c=ya[b+3*d]>>2<<16>>16;return c*c}function J(b,d,c,e,g){var k=0;var l=0;var m=0;var n=0;var q=0;var r=0;var t=0;var u=0;var v=0;for(v=0;v<=12;v++){n=b[v];n=n<0?n==-32768?
32767:-n:n;if(n>l)l=n}t=0;n=l>>9<<16>>16;k=0;for(v=0;v<=5;v++){if(n<=0)k|=1;else k|=0;n=n>>1<<16>>16;if(k==0)t++}n=t+5<<16>>16;var w=(l>>n<<16>>16)+(t<<3<<16>>16);m=w<-32768?-32768:w>32767?32767:w;K(m,ta);t=sa;u=ua;q=6-t<<16>>16;r=ka[u];for(v=0;v<=12;v++){n=b[v]<<q<<16>>16;n=h(n,r);n=n>>12<<16>>16;d[v+c]=n+4<<16>>16}ua=u;sa=t;e[g]=m}function K(b,d){var c=0;var e=0;if(b>15)c=(b>>3<<16>>16)-1<<16>>16;e=b-(c<<3)<<16>>16;if(e==0){c=-4;e=7}else{for(;e<=7;){e=(e<<1|1)<<16>>16;c--}e-=8}if(d==ta){sa=c;ua=
e}else{wa=c;xa=e}}function P(b,d,c,e){var g=0;var h=0;var k=0;var m=0;var n=0;var t=0;if(e==ta){h=ma[ua];n=6-sa<<16>>16;k=n<-32768?-32768:n>32767?32767:n}else{h=ma[xa];n=6-wa<<16>>16;k=n<-32768?-32768:n>32767?32767:n}n=k-1;m=r(1,n<-32768?-32768:n>32767?32767:n);za=0;for(var u=0;u<13;u++){g=(b[c++]<<1)-7<<16>>16;g=g<<28>>16;g=l(h,g);t=g+m;g=t<-32768?-32768:t>32767?32767:t;d[za++]=q(g,k)}}function M(b,d,c,e){var g=13;var h=0;var k=0;if(e==ta)k=5;else k=0;switch(b){case 3:c[k++]=0;do{c[k++]=0;c[k++]=
0;c[k++]=d[h++];--g}while(g!=0);break;case 2:do{c[k++]=0;c[k++]=0;c[k++]=d[h++];--g}while(g!=0);break;case 1:do{c[k++]=0;c[k++]=d[h++];c[k++]=0;--g}while(g!=0);break;case 0:do{c[k++]=d[h++];c[k++]=0;c[k++]=0;--g}while(g!=0)}if(e==ta)c[k++]=0}function N(b,d,c){var e=new Int16Array(8);var g=b.j;var h=g;h^=1;b.j=h;var k=b.larpp[g];var l=b.larpp[h];O(d,k);T(l,k,e);V(e);Z(b,e,13,c,0);W(l,k,e);V(e);Z(b,e,14,c,13);X(l,k,e);V(e);Z(b,e,13,c,27);Y(k,e);V(e);Z(b,e,120,c,40)}function O(b,d){var c=0;var e=0;Q(b,
d,e++,c,0,-32,13107);Q(b,d,e++,c,0,-32,13107);Q(b,d,e++,c,2048,-16,13107);Q(b,d,e++,c,-2560,-16,13107);Q(b,d,e++,c,94,-8,19223);Q(b,d,e++,c,-1792,-8,17476);Q(b,d,e++,c,-341,-4,31454);Q(b,d,e++,c,-1144,-4,29708)}function Q(b,d,c,e,g,h,k){var m=b[c]+h;e=(m<-32768?-32768:m>32767?32767:m)<<26>>16;var n=e-(g<<17>>16);e=n<-32768?-32768:n>32767?32767:n;e=l(k,e);var q=e+e;d[c]=q<-32768?-32768:q>32767?32767:q}function T(b,c,d){for(var e=0;e<8;e++){var g=(b[e]>>2<<16>>16)+(c[e]>>2<<16>>16);d[e]=g<-32768?-32768:
g>32767?32767:g;var h=d[e]+(b[e]>>1<<16>>16);d[e]=h<-32768?-32768:h>32767?32767:h}}function W(b,d,c){for(var e=0;e<8;e++){var g=(b[e]>>1<<16>>16)+(d[e]>>1<<16>>16);c[e]=g<-32768?-32768:g>32767?32767:g}}function X(b,d,c){for(var e=0;e<8;e++){var g=(b[e]>>2<<16>>16)+(d[e]>>2<<16>>16);c[e]=g<-32768?-32768:g>32767?32767:g;var h=c[e]+(d[e]>>1<<16>>16);c[e]=h<-32768?-32768:h>32767?32767:h}}function Y(b,d){for(var c=0;c<8;c++)d[c]=b[c]}function V(b){var c=0;var d=0;for(var e=0;e<8;e++)if(b[e]<0){c=(b[e]==
-32768?32767:-b[e])<<16>>16;d=(c>>2<<16>>16)+26112;b[e]=-(c<11059?c<<1:c<20070?c+11059:d<-32768?-32768:d>32767?32767:d)<<16>>16}else{c=b[e];d=(c>>2<<16>>16)+26112;b[e]=(c<11059?c<<1:c<20070?c+11059:d<-32768?-32768:d>32767?32767:d)<<16>>16}}function Z(b,c,d,e,g){var h=b.u;var k=0;var m=0;var n=0;var q=0;var r=0;var t=0;var u=0;for(var v=0;d!=0;){d--;k=q=e[g];for(t=0;t<8;t++){n=h[t];r=c[t];h[t]=q;m=l(r,k);u=n+m;q=u<-32768?-32768:u>32767?32767:u;m=l(r,n);v=k+m;k=v<-32768?-32768:v>32767?32767:v}e[g++]=
k}b.u=h}function aa(){this.dp0=new Int16Array(280);this.z1=0;this.l_z2=0;this.mp=0;this.u=new Int16Array(8);this.larpp=[new Int16Array(8),new Int16Array(8)];this.j=0;this.nrp=40;this.v=new Int16Array(9);this.msr=0}var ga=33;var ja=[6554,16384,26214,32767];var ka=[29128,26215,23832,21846,20165,18725,17476,16384];var ma=[18431,20479,22527,24575,26623,28671,30719,32767];var ba=new aa;var S=new Int16Array(8);var da=new Int16Array(4);var ea=new Int16Array(4);var fa=new Int16Array(4);var ha=new Int16Array(4);
var G=new Int16Array(13*4);var oa=new Int16Array(160);var L=new Uint8Array(ga);var qa=0;this.encode=function(c,e,h,k){b(c,e);d();return g(h,k)};var pa=false;var ra=[8,7,6,6,5,5,5,5,4,4,4,4,4,4,4,4,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];var R=new Int32Array(9);var sa=0;var ua=0;var wa=0;var xa=0;var za=0;var ta=0;var Ba=1;var ya=new Int16Array(40)}q.name="AUDIO_INPUT";q.process=function(b){var e=b.getByte();var h=null;switch(e){case 1:var k=b.getLittleEndian32();h=new RdpBuffer(new Uint8Array(5),0,5);h.setByte(1);h.setLittleEndian32(k);h.markEnd();q.send(h);
break;case 2:d(b);break;case 3:c(b);break;case 7:g(b);break;default:svGlobal.logger.warn("audioInpt: invalid tag:"+e)}};var l=false;q.onclose=function(){l=false;if(B)B.close()};var m=new Uint8Array(1);m[0]=5;var r=false;var u=n.reconnectOnResize;var A=new Uint8Array(0);var v=null;var B=new h(ma.getContext())})();n.addDynamicChannel(q)}n.addDynamicChannel(h());if(!ya)n.addDynamicChannel(l());n.addDynamicChannel(r(c))}};var Va=new Vb;var Fa=new Xb;var Z=new Cb;var nb=new nd;var Ea=0;var cb=new function(){var e=
[];this.set=function(d,g){e[d]=g};this.get=function(d){return e[d]};this.total=function(){return e.length};this.toPDU=function(){var d=2;var g=2;var c=0;var b=0;var h=e.length;for(var l;b<h;b++){l=e[b];if(l){c++;g=g+7+(l.rawData?l.rawData.length:0)}}if(!c)return null;var n=new Uint32Array(g);n[0]=100728861;n[1]=c;for(b=0;b<h;b++){l=e[b];if(l){n[d++]=l.cache_idx|l.bpp<<16;n[d++]=l.hotX|l.hotY<<16;n[d++]=l.width|l.height<<16;n[d++]=l.xorSize;n[d++]=l.andSize;n[d++]=l.distance;n[d++]=l.rawData.length;
n.set(l.rawData,d);d+=l.rawData.length}}return n};this.fromStream=function(d){var g=d.getPosition();var c=new Uint32Array(d.getData().buffer,g);var b=c[0];var h=0;var l=0;var n=0;var m=0;var k=0;var q=0;var p=0;var t=0;var u=0;var w=0;var A=0;var B;var x;for(g=1;h<b;h++){l=c[g]&65535;n=c[g++]>>16;m=c[g]&65535;k=c[g++]>>16;q=c[g]&65535;p=c[g++]>>16;t=c[g++];u=c[g++];w=c[g++];A=c[g++];B=new Uint32Array(A);B.set(c.subarray(g,g+A));g+=A;x=new Ib(l,B,m,k,q,p,n,t,u);if(w){x.distance=w;x.init()}e[l]=x}}};
this.getFileUrl=function(e){return n.modifyURL(za()+"/DOWNLOAD?s="+kb+"&f="+e)};this.exeAppCmd=function(e){var d=B.getFocused();if(d)d.exeCommand(e)};this.reconnect=function(e,d,g){g=g||false;if(!ga&&!g)return false;if(u.minWidth&&e<u.minWidth)e=u.minWidth;if(u.minHeight&&d<u.minHeight)d=u.minHeight;e=Za(e);d=Za(d);if(!g&&Math.abs(e-M)<4&&Math.abs(d-Y)<4)return false;if(oa&&oa.enabled)oa.applyResolution(e,d);else ac(e,d);return true};this.notify=function(e,d){e="8E6"+e;if(d)e+="\t"+d.join(";");J(e)};
this.getUploadManager=function(){return qa};this.addSurface=function(e){if(B.hasSurface(e))return;if(!ub)A.setContext(e.context);if(B.indexOf(e)!=-1&&e.railWin)return;if(ya)e.setPlayerMode();if(u.mouseMoveEmu)e.mouseMoveEmu=pa(u.mouseMoveEmu);e.setSize(50,50,"hidden");var d=e.getFreeSpace();if(M==0)M=d.width;if(Y==0)Y=d.height;Sb();A=hb(M,Y);jb(M,Y);e.setConfig(N);B.addSurface(e);e.setSize(M,Y,da?"hidden":null);e.setController(Sa);e.setFastCopy(pa(u.fastCopy));e.setTouchpad(pa(u.touchpad));e.setClipboard(pa(u.mapClipboard));
if(Fb)bc(e);if(u.invitation){B.setReadOnly(true);btn=hi5.$("requestControl");if(btn)btn.disabled=false}e.run(parseInt(u.keyboard||1033,10))};this.getRunninApps=this.getRunningApps=function(){var e=[];var d=0;for(var g=B.length;d<g;d++){if(!B[d].railWin.getMain(B.zOrders))continue;e.push(B[d].railWin.getMain(B.zOrders)["titleInfo"])}return e};this.startApp=function(e,d,g){J("8C2"+e+"\t"+d+"\t"+g);var c=B[B.length-1];if(c)c.remoteApp=new cc(e,d,g)};this.startExitingApp=function(e){var d=B.popWins(e);
var g=d.length;for(var c=g-1;c>=0;c--)B.addWin(d[c])};this.VirtualChannel=function(){return new Db(143)};this.GatewayChannel=function(){return new Db(28)};this.DynamicChannel=function(){return new Db(64)};this.addChannel=function(e){Pa[e.name]=e};this.addGatewayChannel=function(e){Qa[e.name]=e};this.addDynamicChannel=function(e){ja.names.push(e.name);ja[e.name]=e;ja.count++};if(pa(u.smartCard)){var rb=new n.GatewayChannel;var Pb=null;rb.name="SCARDSTB";rb.onopen=function(){Pb=document.getElementById(hi5.appcfg.clientAppletId||
"clientApplet")};rb.process=function(e){var d=null;if(Pb){var g=e.getPosition();var c=hi5.Base64.enc(e.getData(),e.getEnd()-g,g);try{c=Pb.deviceControl(c);d=hi5.Base64.dec(c,0)}catch(h){svGlobal.logger.warn(h)}}if(!d)d=[0];var b=new hi5.DataBuffer(d);b.markEnd(d.length);rb.send(b)};n.addGatewayChannel(rb)}this.run=function(){ec();if(ma.supportWebAudio)ma.iOSFix()};this.getDesktop=function(){return A};this.mouseDown=function(e,d,g){if(xa)J("80"+e+"\t"+d+"\t"+g)};this.mouseMove=function(e,d){if(xa)J("82"+
e+"\t"+d)};this.mouseUp=function(e,d,g){if(xa)J("81"+e+"\t"+d+"\t"+g)};this.writeKeyCode=function(e,d){if(xa)J("8B"+(e?0:49152)+"\t"+d)};this.writeScancode=function(e,d){if(xa){if(typeof e=="number"){J("84"+"0\t"+e);J("84"+"49152\t"+e);return}J("84"+(e?0:49152)+"\t"+d)}};this.writeRawInput=function(e){if(xa)J(e)};var ea=new RdpBuffer([],0,0);this.suppressOutput=function(e){if(!n.sessionInfo.suppressOutput)return false;if(e==undefined)e=true;var d=new Uint8Array(e?3:11);d[0]=146;d[1]=3;d[2]=e?1:0;
if(!e){d[3]=V;d[4]=V>>8;d[5]=X;d[6]=X>>8;d[7]=T;d[8]=T>>8;d[9]=W;d[10]=W>>8}Q.send(d.buffer);return true};this.refreshOutput=function(e,d,g,c){var b=new Uint8Array(g?11:3);b[0]=146;b[1]=3;b[2]=2;if(g){b[3]=e;b[4]=e>>8;b[5]=d;b[6]=d>>8;b[7]=g;b[8]=g>>8;b[9]=c;b[10]=c>>8}Q.send(b.buffer)};this.sendPing=function(e){var d=e?2+e.length:2;var g=new Uint8Array(d);g[0]=146;g[1]=0;if(e)g.set(e,2);Q.send(g.buffer)};this.startPing=function(e,d){d=d||0;if(!ha)ha=new hi5.tool.ResponseMonitor(function(){if(ga)n.sendPing()},
function(){if(ga&&n.onnoresponse)return n.onnoresponse()});ha.setInterval(e,d);var g=new Uint8Array(4);g[0]=146;g[1]=2;g[2]=e;g[3]=d;Q.send(g.buffer);ha.check()};this.stopPing=function(){if(ha)ha.stop()};var Ba=null;var pc=0;this.play=function(){J("F3")};this.pause=function(){J("F2")};this.scan=function(e){J("F4"+(e?"1":"0"))};this.seek=function(e){var d=B.getFocused();if(d&&ga){J("F4"+(e?"1":"0")+"\t"+(e/d.getScale()|0));A.pause(true)}};var aa={tag:0,channels:0,bitsPerSample:0,samplePerSec:22050,
toStream:function(e){e.setLittleEndian16(this.tag);e.setLittleEndian16(this.channels);e.setLittleEndian16(this.bitsPerSample);e.setLittleEndian32(this.samplePerSec)},fromStream:function(e){this.tag=e.getLittleEndian16();this.channels=e.getLittleEndian16();this.bitsPerSample=e.getLittleEndian16();this.samplePerSec=e.getLittleEndian32()}};var rc=false;this.showMessage=function(e,d,g){if(!n.displayMsg||!e)return;var c=d||B.getFocused();if(c)c.showMessage(e,g);else hi5.notifications.notify({"msg":e,"timeout":g||
0})};var vb=new ke;var Wa=new oe;var Cc=new te;var Lc=new pe;var Hb=Lc.process;var Fe=[1,2,1,0,0,0,0,1,1,2,1,1,0,2,3,1,2,2,2,2,1,2,1,0,2,1,2,3];var ob={readVar4Bytes:function(e){var d=e.getByte();var g=(d&192)>>6;var c=0;switch(g){case 0:c=d&63;break;case 1:c=(d&63)<<8;c|=e.getByte();break;case 2:c=(d&63)<<16;d=e.getByte();c|=d<<8;d=e.getByte();c|=d;break;case 3:c=(d&63)<<24;d=e.getByte();c|=d<<16;d=e.getByte();c|=d<<8;d=e.getByte();c|=d}return c},readVar2Bytes:function(e){var d=e.getByte();if((d&
128)!=0)return(d&127)<<8|e.getByte();else return d}};this.close=function(){Ka=true;svGlobal.logger.info("closing...");if(Q&&Q.readyState!=WebSocket.CLOSING&&Q.readyState!=WebSocket.CLOSED)try{for(;Q&&Q.readyState!=WebSocket.CLOSING&&Q.readyState!=WebSocket.CLOSED;){if(!ya&&Q.readyState==WebSocket.OPEN)J("85-1");Q.close()}}finally{Ra()}else Ra()};if(!hi5.browser.isChromeApp)window.addEventListener("unload",Ra,false);else chrome.runtime.onSuspend.addListener(Ra);var S=16777215}
if(!svGlobal.Rdp)svGlobal.Rdp=Rdp;var RdpBuffer=hi5.DataBuffer;
